
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>David Gaines | GD!</title>
    <meta name="description" content="A personal portfolio website for Creative Director David Gaines."/>
    <!-- Redirect for SPA on 404/reload handling -->
    <script>
      (function() {
        const path = window.location.pathname;
        const hash = window.location.hash;
        if (path && path !== '/' && !hash) {
          window.location.replace('/#' + path + window.location.search);
        }
      })();
    </script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='10' fill='%230f172a' /><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='50' font-weight='900' fill='%23f8fafc'>GD!</text></svg>" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
              'brand-primary': 'var(--accent-color, #0891b2)', 
              'brand-secondary': 'var(--accent-secondary-color, #f0f9ff)', 
              'base-dark': 'var(--hero-bg-color, #0f172a)',
              'base-medium': '#1e293b', 
              'base-light': '#334155', 
              'text-primary': 'var(--hero-text-color, #f8fafc)',
              'text-secondary': '#cbd5e1', 
              'text-tertiary': '#94a3b8', 
              'body-headings': 'var(--body-headings-color, #1e293b)',
              'body-text': 'var(--body-text-color, #475569)',
              'tag-bg': 'var(--project-tag-bg-color, #1e293b)',
              'tag-text': 'var(--project-tag-text-color, #f8fafc)',
              'page-background': 'var(--page-background-color, #ffffff)',
            },
            animation: {
              'infinite-scroll-left': 'infinite-scroll-left 60s linear infinite',
            },
            keyframes: {
              'infinite-scroll-left': { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
            }
          }
        }
      }
    </script>
    <style>
      body.hide-cursor, body.hide-cursor * { cursor: none; }
      .header-with-blur::before {
        content: ''; position: absolute; inset: 0; z-index: -1;
        background-color: rgba(var(--header-bg-color-rgb, 15, 23, 42), 0.95);
        backdrop-filter: blur(12px);
      }
      .logo-dragging, .project-dragging, .block-dragging {
        opacity: 0.5; transform: scale(1.02); box-shadow: 0 0 20px rgba(8, 145, 178, 0.7); background: #1e293b; border: 2px solid #0891b2;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
      .mask-gradient {
        mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
      }
    </style>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KN0LN28WLD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KN0LN28WLD');
      function trackPageView() {
        if (typeof gtag !== 'function') { return; }
        const pagePath = window.location.hash.substring(1) || '/';
        gtag('event', 'page_view', { page_path: pagePath, page_location: window.location.href, page_title: document.title });
      }
      window.addEventListener('load', trackPageView);
      window.addEventListener('hashchange', trackPageView);
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "react": "https://esm.sh/react@18.2.0",
          "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
          "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
          "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
      }
    </script>
</head>
<body class="bg-base-dark text-text-primary font-sans antialiased selection:bg-brand-primary selection:text-white">
<div id="root"></div>

<script type="text/babel" data-type="module">
import React, { useState, useEffect, createContext, useContext, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot } from 'firebase/firestore';

// --- Constants & Defaults ---
const HERO_PROJECTS_DEFAULT = [
  {
    id: 'sample-project',
    title: 'Sample Project',
    client: 'Client Name',
    tags: ['Strategy', 'Design'],
    heroImage: { url: '', alt: '' },
    homePageTitle: 'Sample Project',
    homePageSubtitle: 'A brief description.',
    contentBlocks: [
      { type: 'hero', data: { images: [{url: '', alt: ''}], style: 'single' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'Challenge', body: 'Description of the challenge.' } }
    ]
  }
];

const ABOUT_ME_DEFAULT = {
  name: 'David Gaines',
  title: 'Creative Director',
  logoText: 'GD!',
  headerIcon: { url: '', alt: '' },
  heroImage: { url: '', alt: '' },
  introStatement: "A highly accomplished Creative Leader...",
  heroIntro: "A creative leader translating complex brand strategy...",
  philosophy: [{ title: 'Strategy First', text: 'Design without strategy is art.' }],
  obsessions: ['Typography', 'Minimalism'],
  travelLog: [{ text: 'Tokyo', completed: true }],
  quotes: [],
  favorites: { movies: [], shows: [], podcasts: [], audiobooks: [] },
  panorama: { url: '', alt: '' },
  inspirationGrid: [],
  socialLinks: [],
  email: 'dave@gainesdg.com',
  phone: '555.555.5555',
  accentColor: '#0891b2',
  accentSecondaryColor: '#f0f9ff',
  headerBackgroundColor: '#0f172a',
  heroBackgroundColor: '#0f172a',
  heroTextColor: '#f8fafc',
  pageBackgroundColor: '#ffffff',
  bodyHeadingsColor: '#1e293b',
  bodyTextColor: '#475569',
  projectTagBackgroundColor: '#1e293b',
  projectTagTextColor: '#f8fafc',
  seoTitle: 'David Gaines Portfolio',
  seoDescription: 'Creative Director Portfolio',
  useMonochromeLogos: true,
};

// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyDAaX8so7wzwuhuWHeNN8CXWfHnXx9dREQ",
  authDomain: "port-82839.firebaseapp.com",
  projectId: "port-82839",
  storageBucket: "port-82839.firebasestorage.app",
  messagingSenderId: "463866065220",
  appId: "1:463866065220:web:775b841f67d43b64e8a711"
};
let app, auth, db;
try {
  app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
} catch (e) { console.error("Firebase init error", e); }

// --- Contexts ---
const CursorHoverStateContext = createContext();
const CursorHoverDispatchContext = createContext();

const CursorHoverProvider = ({ children }) => {
  const [hoverState, setHoverState] = useState({ isHovering: false });
  return (
    <CursorHoverStateContext.Provider value={hoverState}>
      <CursorHoverDispatchContext.Provider value={setHoverState}>
        {children}
      </CursorHoverDispatchContext.Provider>
    </CursorHoverStateContext.Provider>
  );
};

const ContentContext = createContext();
const useContent = () => useContext(ContentContext);

const ContentProvider = ({ children }) => {
  const [heroProjects, setHeroProjects] = useState(HERO_PROJECTS_DEFAULT);
  const [aboutMe, setAboutMe] = useState(ABOUT_ME_DEFAULT);
  const [clientLogos, setClientLogos] = useState([]);
  const [brandLogos, setBrandLogos] = useState([]);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() => {
    // CSS Variables Injection
    const r = document.documentElement;
    r.style.setProperty('--accent-color', aboutMe.accentColor);
    r.style.setProperty('--accent-secondary-color', aboutMe.accentSecondaryColor);
    r.style.setProperty('--header-bg-color-rgb', hexToRgb(aboutMe.headerBackgroundColor));
    r.style.setProperty('--hero-bg-color', aboutMe.heroBackgroundColor);
    r.style.setProperty('--hero-text-color', aboutMe.heroTextColor);
    r.style.setProperty('--page-background-color', aboutMe.pageBackgroundColor);
    r.style.setProperty('--body-headings-color', aboutMe.bodyHeadingsColor);
    r.style.setProperty('--body-text-color', aboutMe.bodyTextColor);
    r.style.setProperty('--project-tag-bg-color', aboutMe.projectTagBackgroundColor);
    r.style.setProperty('--project-tag-text-color', aboutMe.projectTagTextColor);
  }, [aboutMe]);

  useEffect(() => {
    const load = (key, setter) => {
      const stored = localStorage.getItem(key);
      if (stored) setter(JSON.parse(stored));
    };
    load('heroProjects', setHeroProjects);
    load('aboutMe', setAboutMe);
    load('clientLogos', setClientLogos);
    load('brandLogos', setBrandLogos);
    
    if (auth) onAuthStateChanged(auth, u => setIsAuthenticated(!!u));
    // Firebase listeners would typically go here for live updates
  }, []);

  const save = (key, data) => {
    localStorage.setItem(key, JSON.stringify(data));
    if (db && isAuthenticated) setDoc(doc(db, 'content', key), { data }).catch(e => console.error("Save error", e));
  };

  return (
    <ContentContext.Provider value={{
      heroProjects, updateHeroProjects: (d) => { setHeroProjects(d); save('heroProjects', d); },
      aboutMe, updateAboutMe: (d) => { setAboutMe(d); save('aboutMe', d); },
      clientLogos, brandLogos, updateLogos: (c, b) => { setClientLogos(c); setBrandLogos(b); save('clientLogos', c); save('brandLogos', b); },
      isAuthenticated,
      resetToDefaults: () => {
         setHeroProjects(HERO_PROJECTS_DEFAULT); save('heroProjects', HERO_PROJECTS_DEFAULT);
         setAboutMe(ABOUT_ME_DEFAULT); save('aboutMe', ABOUT_ME_DEFAULT);
         alert("Reset complete. Reload to see changes.");
      }
    }}>
      {children}
    </ContentContext.Provider>
  );
};

// --- Helpers ---
function hexToRgb(hex) {
  if(!hex) return '15, 23, 42';
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '15, 23, 42';
}

const useRouter = () => {
  const [path, setPath] = useState(window.location.hash.substring(1) || '/');
  useEffect(() => {
    const handler = () => setPath(window.location.hash.substring(1) || '/');
    window.addEventListener('hashchange', handler);
    return () => window.removeEventListener('hashchange', handler);
  }, []);
  return { path };
};

// --- Icons ---
const MenuIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16m-7 6h7" /></svg>;
const CloseIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
const ArrowLeftIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;

// --- Components ---
const CustomCursor = () => {
  const hoverState = useContext(CursorHoverStateContext);
  const [pos, setPos] = useState({ x: -100, y: -100 });
  useEffect(() => {
    const move = (e) => setPos({ x: e.clientX, y: e.clientY });
    window.addEventListener('mousemove', move);
    return () => window.removeEventListener('mousemove', move);
  }, []);
  
  if (typeof window !== 'undefined' && window.innerWidth < 768) return null;

  return (
    <div className="pointer-events-none fixed inset-0 z-[9999]">
      <div 
        className="absolute w-3 h-3 bg-brand-primary rounded-full transform -translate-x-1/2 -translate-y-1/2 transition-transform duration-100 ease-out"
        style={{ left: pos.x, top: pos.y, transform: `translate(-50%, -50%) scale(${hoverState?.isHovering ? 0.5 : 1})` }}
      />
      <div 
        className="absolute w-8 h-8 border border-text-tertiary rounded-full transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 ease-out"
        style={{ left: pos.x, top: pos.y, transform: `translate(-50%, -50%) scale(${hoverState?.isHovering ? 1.5 : 1})` }}
      />
    </div>
  );
};

const Header = () => {
  const { aboutMe } = useContent();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isContactOpen, setIsContactOpen] = useState(false);

  return (
    <header className="fixed top-0 left-0 right-0 z-50 transition-all duration-300 header-with-blur">
      <div className="container mx-auto px-6 h-24 flex items-center justify-between">
        <a href="#/" className="flex items-center gap-2 group z-50" onClick={(e) => { e.preventDefault(); window.location.hash = '/'; }}>
          {aboutMe.headerIcon?.url && <img src={aboutMe.headerIcon.url} alt="icon" className="w-8 h-8 object-contain" />}
          <span className="text-2xl font-black text-white tracking-tighter group-hover:text-brand-primary transition-colors">{aboutMe.logoText || 'GD!'}</span>
        </a>
        <nav className="hidden md:flex items-center gap-12">
          <a href="#/" className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors">Home</a>
          <a href="#/about" className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors">About</a>
          <div className="relative group" onMouseEnter={() => setIsContactOpen(true)} onMouseLeave={() => setIsContactOpen(false)}>
            <button className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors py-2">Contact</button>
            <div className={`absolute top-0 right-[-100px] w-[400px] bg-brand-primary transform transition-all duration-500 ease-in-out origin-top ${isContactOpen ? 'scale-y-100 opacity-100' : 'scale-y-0 opacity-0'} pt-24 pb-12 px-8 -z-10 shadow-2xl rounded-bl-3xl`}>
              <div className="flex flex-col gap-4 text-right">
                <a href={`mailto:${aboutMe.email}`} className="text-xl font-bold text-white hover:opacity-80 block">{aboutMe.email}</a>
                <a href={`tel:${aboutMe.phone}`} className="text-xl font-bold text-white hover:opacity-80 block">{aboutMe.phone}</a>
              </div>
            </div>
          </div>
        </nav>
        <button className="md:hidden z-50 text-white" onClick={() => setIsMenuOpen(!isMenuOpen)}>
          {isMenuOpen ? <CloseIcon className="w-8 h-8" /> : <MenuIcon className="w-8 h-8" />}
        </button>
      </div>
      {isMenuOpen && (
        <div className="fixed inset-0 bg-base-dark z-40 flex flex-col items-center justify-center gap-8 md:hidden">
          <a href="#/" onClick={() => setIsMenuOpen(false)} className="text-2xl font-bold text-white">Home</a>
          <a href="#/about" onClick={() => setIsMenuOpen(false)} className="text-2xl font-bold text-white">About</a>
          <a href={`mailto:${aboutMe.email}`} className="text-xl text-brand-primary">{aboutMe.email}</a>
        </div>
      )}
    </header>
  );
};

const Footer = () => {
  const { aboutMe } = useContent();
  return (
    <footer className="bg-base-dark text-white pt-20 pb-12 border-t border-base-light/10">
      <div className="container mx-auto px-6">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-12 items-start text-center md:text-left">
          <div>
            <h4 className="text-2xl font-black tracking-tight mb-2">David Gaines</h4>
            <p className="text-text-tertiary text-sm">{aboutMe.title}</p>
          </div>
          <div className="flex flex-col items-center gap-2">
            <a href={`mailto:${aboutMe.email}`} className="text-lg font-bold hover:text-brand-primary transition-colors">{aboutMe.email}</a>
            <a href={`tel:${aboutMe.phone}`} className="text-lg font-bold hover:text-brand-primary transition-colors">{aboutMe.phone}</a>
          </div>
          <div className="flex justify-center md:justify-end gap-6">
             {aboutMe.socialLinks?.map((link, i) => (
               <a key={i} href={link.linkUrl} target="_blank" rel="noopener noreferrer" className="text-white hover:text-brand-primary transition-colors transform hover:scale-110">
                 {link.iconUrl ? <img src={link.iconUrl} alt="social" className="h-6 w-6" /> : <span className="uppercase text-xs font-bold border border-white px-2 py-1 rounded">LINK</span>}
               </a>
             ))}
          </div>
        </div>
        <div className="mt-16 flex justify-between items-end border-t border-base-light/10 pt-8">
           <p className="text-text-tertiary text-xs">Â© 2025 David Gaines. All rights reserved.</p>
           <a href="#/admin" onClick={(e) => { e.preventDefault(); window.location.hash = '/admin'; }} className="text-base-dark hover:text-base-dark cursor-default text-[10px]">Admin</a>
        </div>
      </div>
    </footer>
  );
};

// --- Renderers ---
const HeroBlock = ({ data }) => {
  const images = data.images || [];
  if (!images.length) return null;
  const isMobile = window.innerWidth < 768;
  
  if (isMobile && images.length > 1) {
    return (
      <div className="container mx-auto px-4 max-w-7xl my-8 overflow-x-auto flex gap-4 snap-x">
        {images.map((img, i) => (
          <div key={i} className="min-w-[90%] snap-center aspect-video relative overflow-hidden rounded-lg">
            {img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="bg-gray-200 absolute inset-0" />}
          </div>
        ))}
      </div>
    );
  }

  const gridClass = images.length === 3 ? 'grid-cols-1 md:grid-cols-3' : images.length === 2 ? 'grid-cols-1 md:grid-cols-2' : 'grid-cols-1';
  return (
    <div className={`grid ${gridClass} gap-4 container mx-auto px-4 max-w-7xl my-8`}>
      {images.map((img, i) => (
         <div key={i} className="aspect-video relative overflow-hidden rounded-lg shadow-xl">
           {img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="bg-gray-200 absolute inset-0" />}
         </div>
      ))}
    </div>
  );
};

const PanoImageBlock = ({ data }) => {
  const { image, height } = data;
  const h = height || '250';
  return (
    <div className="container mx-auto px-4 max-w-7xl my-12">
      <div className="relative w-full overflow-hidden rounded-lg shadow-lg" style={{ height: `${h}px` }}>
        {image?.url ? <img src={image.url} alt={image.alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500">No Image</div>}
      </div>
    </div>
  );
};

const TitleBlock = ({ project }) => (
  <div className="container mx-auto px-4 max-w-5xl text-center my-16">
    <h1 className="text-4xl md:text-7xl font-black text-body-headings mb-4 leading-none">{project.title}</h1>
    <h2 className="text-xl md:text-3xl font-bold text-brand-primary mb-8">{project.client}</h2>
    <div className="flex flex-wrap justify-center gap-3">
      {project.tags.map((tag, i) => (
        <span key={i} className="px-5 py-2 rounded-full text-xs font-bold uppercase tracking-wider bg-tag-bg text-tag-text">{tag}</span>
      ))}
    </div>
  </div>
);

const TextBlock = ({ data }) => (
  <div className="container mx-auto px-4 max-w-3xl my-16">
    {data.heading && <h3 className="text-3xl font-bold text-body-headings mb-6">{data.heading}</h3>}
    <div className="prose prose-xl text-body-text leading-relaxed" dangerouslySetInnerHTML={{ __html: data.body }} />
  </div>
);

const TextWithImagesBlock = ({ data }) => {
  const { heading, body, images = [], align = 'right', layout = 'square' } = data;
  const aspectRatio = layout === 'tall' ? 'aspect-[2/3]' : layout === 'extratall' ? 'aspect-[1/2]' : 'aspect-square';
  return (
    <div className="container mx-auto px-4 max-w-6xl my-16">
      <div className={`flex flex-col md:flex-row gap-12 items-start ${align === 'left' ? 'md:flex-row-reverse' : ''}`}>
        <div className="flex-1">
          {heading && <h3 className="text-3xl font-bold text-body-headings mb-6">{heading}</h3>}
          <div className="prose prose-xl text-body-text" dangerouslySetInnerHTML={{ __html: body }} />
        </div>
        <div className="w-full md:w-1/3 flex flex-col gap-6">
           {images.map((img, i) => (
             <div key={i} className={`w-full relative overflow-hidden rounded-lg shadow-md ${aspectRatio}`}>
               {img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 bg-gray-200" />}
             </div>
           ))}
        </div>
      </div>
    </div>
  );
};

// --- Pages ---
const HomePage = () => {
  const { heroProjects, aboutMe, clientLogos, brandLogos } = useContent();
  const setHoverState = useContext(CursorHoverDispatchContext);

  return (
    <div className="min-h-screen bg-base-dark text-white">
      <section className="min-h-[90vh] flex flex-col justify-center px-6 pt-32 relative overflow-hidden" style={{ backgroundColor: 'var(--hero-bg-color)' }}>
        <div className="container mx-auto relative z-10">
          <h1 className="text-[12vw] leading-[0.9] font-black tracking-tighter mb-8" style={{ color: 'var(--hero-text-color)' }}>
            {aboutMe.name.split(' ').map((word, i) => <span key={i} className="block">{word}</span>)}
          </h1>
          <div className="max-w-2xl ml-auto mt-12 border-t border-white/20 pt-8">
            <h2 className="text-xl md:text-2xl font-medium leading-relaxed text-text-secondary">{aboutMe.heroIntro}</h2>
          </div>
        </div>
      </section>
      <section className="pt-48 pb-24 bg-white text-base-dark">
        <div className="container mx-auto px-4">
           <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-24">
             {heroProjects.map((project) => (
               <a key={project.id} href={`#/project/${project.id}`} className="project-card group block cursor-none"
                  onMouseEnter={() => setHoverState({ isHovering: true })}
                  onMouseLeave={() => setHoverState({ isHovering: false })}>
                 <div className="aspect-[4/3] overflow-hidden rounded-lg mb-6 relative bg-gray-100">
                   {project.homePageImage?.url ? <img src={project.homePageImage.url} alt={project.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" /> : null}
                 </div>
                 <h3 className="text-3xl font-bold mb-2">{project.homePageTitle || project.title}</h3>
                 <p className="text-text-tertiary text-lg">{project.homePageSubtitle}</p>
                 <div className="flex gap-2 mt-4">
                    {project.tags.slice(0, 3).map(t => <span key={t} className="text-xs font-bold uppercase border border-gray-200 px-2 py-1 rounded text-gray-500">{t}</span>)}
                 </div>
               </a>
             ))}
           </div>
        </div>
      </section>
      <section className="py-24 bg-white text-base-dark overflow-hidden">
        <div className="container mx-auto px-6 mb-12">
           <h3 className="text-sm font-bold text-gray-400 uppercase tracking-widest mb-8">Clients</h3>
           <div className="flex gap-12 overflow-hidden whitespace-nowrap mask-gradient">
              <div className="animate-infinite-scroll-left flex gap-16 items-center">
                 {[...clientLogos, ...clientLogos].map((logo, i) => (
                    <img key={i} src={logo} className={`h-12 w-auto object-contain ${aboutMe.useMonochromeLogos ? 'filter grayscale brightness-50 opacity-70' : ''}`} alt="client" />
                 ))}
              </div>
           </div>
        </div>
         <div className="container mx-auto px-6">
           <h3 className="text-sm font-bold text-gray-400 uppercase tracking-widest mb-8">Brands</h3>
           <div className="flex gap-12 overflow-hidden whitespace-nowrap mask-gradient">
              <div className="animate-infinite-scroll-left flex gap-16 items-center">
                 {[...brandLogos, ...brandLogos].map((logo, i) => (
                    <img key={i} src={logo} className={`h-12 w-auto object-contain ${aboutMe.useMonochromeLogos ? 'filter grayscale brightness-50 opacity-70' : ''}`} alt="brand" />
                 ))}
              </div>
           </div>
        </div>
      </section>
    </div>
  );
};

const AboutPage = () => {
  const { aboutMe } = useContent();
  return (
    <div className="min-h-screen bg-page-background text-body-text pt-32 pb-24">
       <div className="container mx-auto px-6">
         <div className="grid grid-cols-1 md:grid-cols-2 gap-16 mb-24">
           <div>
             <h1 className="text-4xl md:text-6xl font-black text-body-headings mb-8">{aboutMe.pageHeadings?.aboutTitle || 'About Me'}</h1>
             <div className="prose prose-lg text-body-text" dangerouslySetInnerHTML={{ __html: aboutMe.introStatement }} />
           </div>
           <div className="aspect-[4/5] rounded-lg overflow-hidden bg-gray-200">
             {aboutMe.heroImage?.url && <img src={aboutMe.heroImage.url} alt="Portrait" className="w-full h-full object-cover" />}
           </div>
         </div>
         
         <div className="border-t border-gray-200 py-16">
            <h2 className="text-2xl font-bold text-body-headings mb-8">{aboutMe.pageHeadings?.philosophySubtitle || 'Philosophy'}</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
               {aboutMe.philosophy.map((item, i) => (
                 <div key={i}>
                   <h3 className="font-bold text-brand-primary mb-2">{item.title}</h3>
                   <p>{item.text}</p>
                 </div>
               ))}
            </div>
         </div>
         
         <div className="border-t border-gray-200 py-16">
            <h2 className="text-2xl font-bold text-body-headings mb-8">{aboutMe.pageHeadings?.bucketListTitle || 'Bucket List'}</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
               {aboutMe.travelLog.map((item, i) => (
                 <div key={i} className="flex items-center gap-4">
                    <div className={`w-4 h-4 border border-gray-400 ${item.completed ? 'bg-brand-primary border-brand-primary' : ''}`} />
                    <span className={item.completed ? 'line-through text-gray-400' : ''}>{item.text}</span>
                 </div>
               ))}
            </div>
         </div>
       </div>
    </div>
  );
};

const CaseStudyDetailPage = ({ projectId }) => {
  const { heroProjects } = useContent();
  const project = heroProjects.find(p => p.id === projectId);
  
  useEffect(() => { window.scrollTo(0, 0); }, [projectId]);

  if (!project) return <div className="min-h-screen pt-32 text-center">Project not found</div>;

  return (
    <div className="min-h-screen bg-page-background pt-24 pb-32">
       {project.contentBlocks?.map((block, i) => {
          switch(block.type) {
             case 'hero': return <HeroBlock key={i} data={block.data} />;
             case 'title': return <TitleBlock key={i} project={project} />;
             case 'text': return <TextBlock key={i} data={block.data} />;
             case 'textWithImages': return <TextWithImagesBlock key={i} data={block.data} />;
             case 'panoImage': return <PanoImageBlock key={i} data={block.data} />;
             default: return null;
          }
       })}
       <div className="container mx-auto px-6 mt-24 pt-12 border-t border-gray-200">
          <a href="#/" className="flex items-center gap-2 font-bold text-body-headings hover:text-brand-primary"><ArrowLeftIcon className="w-4 h-4" /> Back to Home</a>
       </div>
    </div>
  );
};

// --- Admin ---
const ProjectBuilder = ({ initialProject, onSave, onCancel }) => {
  const [project, setProject] = useState(initialProject);
  const [editingBlockIndex, setEditingBlockIndex] = useState(null);
  
  // Drag Sort for Blocks
  const dragItem = useRef();
  const dragOverItem = useRef();
  const onDragStart = (e, i) => { dragItem.current = i; };
  const onDragEnter = (e, i) => { dragOverItem.current = i; };
  const onDragEnd = () => {
     const copy = [...project.contentBlocks];
     const item = copy[dragItem.current];
     copy.splice(dragItem.current, 1);
     copy.splice(dragOverItem.current, 0, item);
     dragItem.current = null; dragOverItem.current = null;
     setProject({...project, contentBlocks: copy});
  };

  const addBlock = (type) => {
     let data = {};
     if (type === 'panoImage') data = { image: {url: '', alt: ''}, height: '250' };
     else if (type === 'hero') data = { images: [{url: '', alt: ''}], style: 'single' };
     else if (type === 'text') data = { heading: '', body: '' };
     setProject({...project, contentBlocks: [...(project.contentBlocks||[]), {type, data}]});
  };

  return (
    <div className="min-h-screen bg-base-dark text-white p-8 pt-32">
       {editingBlockIndex !== null && <BlockEditorModal block={project.contentBlocks[editingBlockIndex]} onSave={(d) => {
          const blocks = [...project.contentBlocks];
          blocks[editingBlockIndex].data = d;
          setProject({...project, contentBlocks: blocks});
          setEditingBlockIndex(null);
       }} onClose={() => setEditingBlockIndex(null)} />}
       
       <div className="container mx-auto flex gap-8">
          <div className="flex-1">
             <div className="bg-base-medium p-6 rounded mb-8">
                <h2 className="text-xl font-bold mb-4">Project Details</h2>
                <input className="w-full bg-base-dark border border-gray-700 p-2 rounded mb-2 text-white" value={project.title} onChange={e => setProject({...project, title: e.target.value})} placeholder="Title" />
                <input className="w-full bg-base-dark border border-gray-700 p-2 rounded mb-2 text-white" value={project.client} onChange={e => setProject({...project, client: e.target.value})} placeholder="Client" />
             </div>
             
             <div className="space-y-2">
                {project.contentBlocks?.map((block, i) => (
                   <div key={i} draggable onDragStart={(e) => onDragStart(e, i)} onDragEnter={(e) => onDragEnter(e, i)} onDragEnd={onDragEnd} className="bg-base-medium p-4 rounded border border-gray-700 flex justify-between items-center cursor-move hover:bg-gray-800">
                      <span className="font-mono text-brand-primary">{block.type}</span>
                      <div className="flex gap-2">
                         <button onClick={() => setEditingBlockIndex(i)} className="text-xs bg-blue-600 px-2 py-1 rounded">Edit</button>
                         <button onClick={() => {
                            const blocks = [...project.contentBlocks];
                            blocks.splice(i, 1);
                            setProject({...project, contentBlocks: blocks});
                         }} className="text-xs bg-red-600 px-2 py-1 rounded">Delete</button>
                      </div>
                   </div>
                ))}
             </div>
             
             <div className="flex justify-end gap-4 mt-8">
                <button onClick={onCancel} className="text-gray-400">Cancel</button>
                <button onClick={() => onSave(project)} className="bg-green-600 px-6 py-2 rounded font-bold">Save Project</button>
             </div>
          </div>
          
          <div className="w-64">
             <div className="bg-base-medium p-4 rounded sticky top-32">
                <h3 className="font-bold mb-4">Add Content Block</h3>
                <div className="flex flex-col gap-2">
                   <button onClick={() => addBlock('hero')} className="text-left p-2 bg-base-dark rounded hover:bg-gray-700 text-sm">Hero Section</button>
                   <button onClick={() => addBlock('title')} className="text-left p-2 bg-base-dark rounded hover:bg-gray-700 text-sm">Title Block</button>
                   <button onClick={() => addBlock('text')} className="text-left p-2 bg-base-dark rounded hover:bg-gray-700 text-sm">Text Block</button>
                   <button onClick={() => addBlock('textWithImages')} className="text-left p-2 bg-base-dark rounded hover:bg-gray-700 text-sm">Text + Images</button>
                   <button onClick={() => addBlock('panoImage')} className="text-left p-2 bg-brand-primary rounded hover:bg-blue-600 text-sm font-bold">Pano Image</button>
                </div>
             </div>
          </div>
       </div>
    </div>
  );
};

const BlockEditorModal = ({ block, onSave, onClose }) => {
   const [data, setData] = useState(block.data);
   
   return (
     <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-8">
        <div className="bg-base-medium w-full max-w-2xl p-6 rounded-lg shadow-2xl overflow-y-auto max-h-[90vh]">
           <h3 className="text-xl font-bold mb-6 capitalize">Edit {block.type}</h3>
           
           <div className="space-y-6">
              {block.type === 'panoImage' && (
                 <>
                   <div>
                     <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Image URL <span className="text-brand-primary">(Rec: 2000px wide)</span></label>
                     <input value={data.image?.url || ''} onChange={e => setData({...data, image: {...data.image, url: e.target.value}})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white" />
                   </div>
                   <div>
                     <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Height</label>
                     <select value={data.height || '250'} onChange={e => setData({...data, height: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white">
                        <option value="100">100px</option>
                        <option value="125">125px</option>
                        <option value="200">200px</option>
                        <option value="250">250px</option>
                        <option value="300">300px</option>
                     </select>
                   </div>
                 </>
              )}
              {block.type === 'text' && (
                 <>
                   <input value={data.heading || ''} onChange={e => setData({...data, heading: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white font-bold" placeholder="Heading" />
                   <textarea value={data.body || ''} onChange={e => setData({...data, body: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white h-48" placeholder="Content..." />
                 </>
              )}
               {block.type === 'hero' && (
                   <div>
                       <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Images (Add 1, 2, or 3)</label>
                       {data.images?.map((img, i) => (
                           <div key={i} className="flex gap-2 mb-2">
                               <input value={img.url} onChange={e => {
                                   const newImages = [...data.images];
                                   newImages[i].url = e.target.value;
                                   setData({...data, images: newImages});
                               }} className="flex-1 bg-base-dark border border-gray-700 p-2 rounded text-white" placeholder="URL" />
                               <button onClick={() => {
                                   const newImages = [...data.images];
                                   newImages.splice(i, 1);
                                   setData({...data, images: newImages});
                               }} className="text-red-500">X</button>
                           </div>
                       ))}
                       <button onClick={() => setData({...data, images: [...(data.images||[]), {url: '', alt: ''}]})} className="text-brand-primary text-sm">+ Add Image</button>
                   </div>
               )}
               {block.type === 'textWithImages' && (
                   <>
                       <textarea value={data.body || ''} onChange={e => setData({...data, body: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white h-32" placeholder="Body Text" />
                       <div>
                           <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Layout</label>
                           <select value={data.layout || 'square'} onChange={e => setData({...data, layout: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white">
                               <option value="square">Square</option>
                               <option value="tall">Tall</option>
                               <option value="extratall">Extra Tall</option>
                           </select>
                       </div>
                        <button onClick={() => setData({...data, images: [...(data.images||[]), {url: '', alt: ''}]})} className="text-brand-primary text-sm mt-4">+ Add Side Image</button>
                   </>
               )}
           </div>

           <div className="flex justify-end gap-4 mt-8 pt-4 border-t border-gray-700">
              <button onClick={onClose} className="text-gray-400">Cancel</button>
              <button onClick={() => onSave(data)} className="bg-brand-primary px-6 py-2 rounded font-bold">Save Changes</button>
           </div>
        </div>
     </div>
   );
};

const AdminPage = () => {
  const { heroProjects, updateHeroProjects } = useContent();
  const [editingProject, setEditingProject] = useState(null);
  const dragItem = useRef();
  const dragOverItem = useRef();
  
  const onDragStart = (e, index) => { dragItem.current = index; };
  const onDragEnter = (e, index) => { dragOverItem.current = index; };
  const onDragEnd = () => {
      const copy = [...heroProjects];
      const item = copy[dragItem.current];
      copy.splice(dragItem.current, 1);
      copy.splice(dragOverItem.current, 0, item);
      dragItem.current = null; dragOverItem.current = null;
      updateHeroProjects(copy);
  };

  if(editingProject) return <ProjectBuilder initialProject={editingProject} onSave={(p) => {
      const updated = heroProjects.map(x => x.id === p.id ? p : x);
      if(!heroProjects.find(x => x.id === p.id)) updated.push(p);
      updateHeroProjects(updated);
      setEditingProject(null);
  }} onCancel={() => setEditingProject(null)} />;

  return (
    <div className="min-h-screen bg-base-dark text-white p-8 pt-32">
       <div className="container mx-auto max-w-4xl">
          <h1 className="text-4xl font-bold mb-8">Admin Dashboard</h1>
          <button onClick={() => setEditingProject({ id: `new-${Date.now()}`, title: 'New', contentBlocks: [] })} className="bg-brand-primary px-4 py-2 rounded mb-4 font-bold">+ New Project</button>
          <div className="space-y-2">
             {heroProjects.map((p, i) => (
                <div key={p.id} draggable onDragStart={(e) => onDragStart(e, i)} onDragEnter={(e) => onDragEnter(e, i)} onDragEnd={onDragEnd} className="bg-base-medium p-4 rounded flex justify-between items-center cursor-move hover:bg-gray-800">
                   <span>{p.title}</span>
                   <button onClick={() => setEditingProject(p)} className="text-sm bg-base-dark px-3 py-1 rounded">Edit</button>
                </div>
             ))}
          </div>
       </div>
    </div>
  );
};

const MainApp = () => {
  const { path } = useRouter();
  if (path === '/admin') return <AdminPage />;
  if (path.startsWith('/project/')) return <><Header /><CaseStudyDetailPage projectId={path.split('/')[2]} /><Footer /><CustomCursor /></>;
  if (path === '/about') return <><Header /><AboutPage /><Footer /><CustomCursor /></>;
  return <><Header /><HomePage /><Footer /><CustomCursor /></>;
};

const App = () => (
  <ContentProvider>
    <CursorHoverProvider>
      <MainApp />
    </CursorHoverProvider>
  </ContentProvider>
);

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
