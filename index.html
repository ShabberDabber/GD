
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>David Gaines | Creative Director Portfolio</title>
    <meta name="description" content="A personal portfolio website for Creative Director David Gaines."/>
    <script>
      (function() {
        const path = window.location.pathname;
        const hash = window.location.hash;
        if (path && path !== '/' && !hash) {
          window.location.replace('/#' + path + window.location.search);
        }
      })();
    </script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='10' fill='%230f172a' /><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Inter, sans-serif' font-size='50' font-weight='900' fill='%23f8fafc'>GD!</text></svg>" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
      body.hide-cursor, body.hide-cursor * { cursor: none; }
      .text-textured { color: var(--accent-color, #0891b2); }
      .header-with-blur::before {
        content: ''; position: absolute; inset: 0; z-index: -1;
        background-color: rgba(var(--header-bg-color-rgb, 15, 23, 42), 0.8);
        backdrop-filter: blur(12px);
      }
      .logo-dragging, .project-dragging, .block-dragging {
        opacity: 0.5; transform: scale(1.02); box-shadow: 0 0 20px rgba(8, 145, 178, 0.7); background: #1e293b;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
              'brand-primary': 'var(--accent-color, #0891b2)', 
              'brand-secondary': 'var(--accent-secondary-color, #f0f9ff)', 
              'base-dark': 'var(--hero-bg-color, #0f172a)',
              'base-medium': '#1e293b', 
              'base-light': '#334155', 
              'text-primary': 'var(--hero-text-color, #f8fafc)',
              'text-secondary': '#cbd5e1', 
              'text-tertiary': '#94a3b8', 
              'body-headings': 'var(--body-headings-color, #1e293b)',
              'body-text': 'var(--body-text-color, #475569)',
              'tag-bg': 'var(--project-tag-bg-color, #1e293b)',
              'tag-text': 'var(--project-tag-text-color, #f8fafc)',
            },
            animation: {
              'fade-in-up': 'fade-in-up 0.6s ease-out forwards',
              'infinite-scroll-left': 'infinite-scroll-left 60s linear infinite',
              'infinite-scroll-right': 'infinite-scroll-right 60s linear infinite',
            },
            keyframes: {
              'fade-in-up': { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
              'infinite-scroll-left': { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
              'infinite-scroll-right': { '0%': { transform: 'translateX(-50%)' }, '100%': { transform: 'translateX(0)' } },
            }
          }
        }
      }
    </script>
    <script type="importmap">
    {
      "imports": {
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react": "https://esm.sh/react@18.2.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KN0LN28WLD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KN0LN28WLD');
      function trackPageView() {
        if (typeof gtag !== 'function') { return; }
        const pagePath = window.location.hash.substring(1) || '/';
        gtag('event', 'page_view', { page_path: pagePath, page_location: window.location.href, page_title: document.title });
      }
      window.addEventListener('load', trackPageView);
      window.addEventListener('hashchange', trackPageView);
    </script>
</head>
<body class="bg-base-dark text-text-primary font-sans antialiased selection:bg-brand-primary selection:text-white">
<div id="root"></div>
<script type="text/babel" data-type="module">
import React, { useState, useEffect, createContext, useContext, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot } from 'firebase/firestore';

// --- Constants & Defaults ---
const CLIENT_LOGOS = ['https://logo.clearbit.com/google.com', 'https://logo.clearbit.com/nike.com', 'https://logo.clearbit.com/apple.com'];
const BRAND_LOGOS = ['https://logo.clearbit.com/sony.com', 'https://logo.clearbit.com/spotify.com', 'https://logo.clearbit.com/tesla.com'];

const HERO_PROJECTS = [
  {
    id: 'aura-app',
    title: 'Aura Health',
    client: 'Mindful Tech',
    tags: ['Product Design', 'Strategy'],
    heroImage: { url: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1200', alt: 'App Interface' },
    homePageTitle: 'Aura Health',
    homePageSubtitle: 'Redefining mental wellness through design.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=800', alt: 'Aura' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1200', alt: 'Hero' }], style: 'single' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'Challenge', body: 'To create a calming experience.' } }
    ]
  }
];

const ABOUT_ME = {
  name: 'David Gaines',
  title: 'Creative Director',
  logoText: 'GD!',
  headerIcon: { url: '', alt: '' },
  heroImage: { url: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=800', alt: 'Portrait' },
  introStatement: "A highly accomplished Creative Leader...",
  heroIntro: "A creative leader translating complex brand strategy...",
  philosophy: [{ title: 'Strategy First', text: 'Design without strategy is art.' }],
  obsessions: ['Typography', 'Minimalism'],
  travelLog: [{ text: 'Tokyo', completed: true }],
  quotes: [],
  favorites: { movies: [], shows: [], podcasts: [], audiobooks: [] },
  panorama: { url: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1600', alt: 'Pano' },
  inspirationGrid: [],
  socialLinks: [],
  email: 'dave@gainesdg.com',
  phone: '949.463.1867',
  accentColor: '#0891b2',
  accentSecondaryColor: '#f0f9ff',
  headerBackgroundColor: '#0f172a',
  heroBackgroundColor: '#0f172a',
  heroTextColor: '#f8fafc',
  pageBackgroundColor: '#ffffff',
  bodyHeadingsColor: '#1e293b',
  bodyTextColor: '#475569',
  projectTagBackgroundColor: '#1e293b',
  projectTagTextColor: '#f8fafc',
  seoTitle: 'David Gaines Portfolio',
  seoDescription: 'Creative Director Portfolio',
  useMonochromeLogos: true,
  pageHeadings: { aboutTitle: 'About Me', philosophySubtitle: 'Philosophy', obsessionsTitle: 'Obsessed With', bucketListTitle: 'Bucket List', mediaDietTitle: 'Media Diet', mediaDietMovies: 'Movies', mediaDietShows: 'Shows', mediaDietPodcasts: 'Podcasts', mediaDietAudiobooks: 'Audiobooks' }
};

// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyDAaX8so7wzwuhuWHeNN8CXWfHnXx9dREQ",
  authDomain: "port-82839.firebaseapp.com",
  projectId: "port-82839",
  storageBucket: "port-82839.firebasestorage.app",
  messagingSenderId: "463866065220",
  appId: "1:463866065220:web:775b841f67d43b64e8a711"
};
let app, auth, db;
try {
  app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
} catch (e) { console.error("Firebase init error", e); }

// --- Contexts ---
const CursorHoverStateContext = createContext();
const CursorHoverDispatchContext = createContext();

const CursorHoverProvider = ({ children }) => {
  const [hoverState, setHoverState] = useState({ isHovering: false, text: undefined });
  return (
    <CursorHoverStateContext.Provider value={hoverState}>
      <CursorHoverDispatchContext.Provider value={setHoverState}>
        {children}
      </CursorHoverDispatchContext.Provider>
    </CursorHoverStateContext.Provider>
  );
};

const ContentContext = createContext();
const useContent = () => useContext(ContentContext);

const ContentProvider = ({ children }) => {
  const [heroProjects, setHeroProjects] = useState(HERO_PROJECTS);
  const [aboutMe, setAboutMe] = useState(ABOUT_ME);
  const [clientLogos, setClientLogos] = useState(CLIENT_LOGOS);
  const [brandLogos, setBrandLogos] = useState(BRAND_LOGOS);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() => {
    // Local Load
    const localP = localStorage.getItem('heroProjects');
    if (localP) setHeroProjects(JSON.parse(localP));
    const localA = localStorage.getItem('aboutMe');
    if (localA) setAboutMe(JSON.parse(localA));
    const localC = localStorage.getItem('clientLogos');
    if (localC) setClientLogos(JSON.parse(localC));
    const localB = localStorage.getItem('brandLogos');
    if (localB) setBrandLogos(JSON.parse(localB));

    if (db) {
       // Firebase listeners would go here
       // Simplified for stability in this turn
    }
    if (auth) onAuthStateChanged(auth, u => setIsAuthenticated(!!u));
  }, []);

  useEffect(() => {
    document.documentElement.style.setProperty('--accent-color', aboutMe.accentColor);
    document.documentElement.style.setProperty('--accent-secondary-color', aboutMe.accentSecondaryColor);
    document.documentElement.style.setProperty('--header-bg-color-rgb', hexToRgb(aboutMe.headerBackgroundColor));
    document.documentElement.style.setProperty('--hero-bg-color', aboutMe.heroBackgroundColor);
    document.documentElement.style.setProperty('--hero-text-color', aboutMe.heroTextColor);
    document.documentElement.style.setProperty('--page-background-color', aboutMe.pageBackgroundColor);
    document.documentElement.style.setProperty('--body-headings-color', aboutMe.bodyHeadingsColor);
    document.documentElement.style.setProperty('--body-text-color', aboutMe.bodyTextColor);
    document.documentElement.style.setProperty('--project-tag-bg-color', aboutMe.projectTagBackgroundColor);
    document.documentElement.style.setProperty('--project-tag-text-color', aboutMe.projectTagTextColor);
  }, [aboutMe]);

  const save = (key, data) => {
    localStorage.setItem(key, JSON.stringify(data));
    if (db && isAuthenticated) setDoc(doc(db, 'content', key), { data }).catch(console.error);
  };

  return (
    <ContentContext.Provider value={{
      heroProjects, updateHeroProjects: (d) => { setHeroProjects(d); save('heroProjects', d); },
      aboutMe, updateAboutMe: (d) => { setAboutMe(d); save('aboutMe', d); },
      clientLogos, brandLogos, updateLogos: (c, b) => { setClientLogos(c); setBrandLogos(b); save('clientLogos', c); save('brandLogos', b); },
      isAuthenticated, resetToDefaults: () => { 
        setHeroProjects(HERO_PROJECTS); save('heroProjects', HERO_PROJECTS);
        setAboutMe(ABOUT_ME); save('aboutMe', ABOUT_ME);
        alert("Reset complete");
      }
    }}>
      {children}
    </ContentContext.Provider>
  );
};

// --- Helpers ---
function hexToRgb(hex) {
  if(!hex) return '15, 23, 42';
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '15, 23, 42';
}

const useRouter = () => {
  const [path, setPath] = useState(window.location.hash.substring(1) || '/');
  useEffect(() => {
    const handler = () => setPath(window.location.hash.substring(1) || '/');
    window.addEventListener('hashchange', handler);
    return () => window.removeEventListener('hashchange', handler);
  }, []);
  return { path };
};

// --- Icons ---
const ArrowUpRightIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 17L17 7M7 7h10v10" /></svg>;
const ArrowLeftIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
const ArrowRightIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
const MenuIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16m-7 6h7" /></svg>;
const CloseIcon = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;

// --- UI Components ---
const CustomCursor = () => {
  const hoverState = useContext(CursorHoverStateContext);
  const [pos, setPos] = useState({ x: -100, y: -100 });
  useEffect(() => {
    const move = (e) => setPos({ x: e.clientX, y: e.clientY });
    window.addEventListener('mousemove', move);
    return () => window.removeEventListener('mousemove', move);
  }, []);
  
  if (window.innerWidth < 768) return null;

  return (
    <div className="pointer-events-none fixed inset-0 z-[9999]">
      <div 
        className="absolute w-3 h-3 bg-brand-primary rounded-full transform -translate-x-1/2 -translate-y-1/2 transition-transform duration-100 ease-out"
        style={{ left: pos.x, top: pos.y, transform: `translate(-50%, -50%) scale(${hoverState?.isHovering ? 0.5 : 1})` }}
      />
      <div 
        className="absolute w-8 h-8 border border-text-tertiary rounded-full transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 ease-out"
        style={{ left: pos.x, top: pos.y, transform: `translate(-50%, -50%) scale(${hoverState?.isHovering ? 1.5 : 1})` }}
      />
    </div>
  );
};

const Header = () => {
  const { aboutMe } = useContent();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isContactOpen, setIsContactOpen] = useState(false);

  return (
    <header className="fixed top-0 left-0 right-0 z-50 transition-all duration-300 header-with-blur">
      <div className="container mx-auto px-6 h-24 flex items-center justify-between">
        <a href="#/" className="flex items-center gap-2 group z-50" onClick={(e) => { e.preventDefault(); window.location.hash = '/'; }}>
          {aboutMe.headerIcon?.url && <img src={aboutMe.headerIcon.url} alt="icon" className="w-8 h-8 object-contain" />}
          <span className="text-2xl font-black text-white tracking-tighter group-hover:text-brand-primary transition-colors">{aboutMe.logoText || 'GD!'}</span>
        </a>

        {/* Desktop Nav */}
        <nav className="hidden md:flex items-center gap-12">
          <a href="#/" className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors">Home</a>
          <a href="#/about" className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors">About</a>
          <div 
            className="relative group"
            onMouseEnter={() => setIsContactOpen(true)}
            onMouseLeave={() => setIsContactOpen(false)}
          >
            <button className="text-sm font-bold tracking-widest uppercase text-white hover:text-brand-primary transition-colors py-2">
              Contact
            </button>
            <div 
              className={`absolute top-0 right-[-100px] w-[400px] bg-brand-primary transform transition-all duration-500 ease-in-out origin-top ${isContactOpen ? 'scale-y-100 opacity-100' : 'scale-y-0 opacity-0'} pt-24 pb-12 px-8 -z-10 shadow-2xl rounded-bl-3xl`}
            >
              <div className="flex flex-col gap-4 text-right">
                <a href={`mailto:${aboutMe.email}`} className="text-xl font-bold text-white hover:opacity-80 block">{aboutMe.email}</a>
                <a href={`tel:${aboutMe.phone}`} className="text-xl font-bold text-white hover:opacity-80 block">{aboutMe.phone}</a>
              </div>
            </div>
          </div>
        </nav>

        {/* Mobile Menu Toggle */}
        <button className="md:hidden z-50 text-white" onClick={() => setIsMenuOpen(!isMenuOpen)}>
          {isMenuOpen ? <CloseIcon className="w-8 h-8" /> : <MenuIcon className="w-8 h-8" />}
        </button>
      </div>

      {/* Mobile Nav */}
      {isMenuOpen && (
        <div className="fixed inset-0 bg-base-dark z-40 flex flex-col items-center justify-center gap-8 md:hidden">
          <a href="#/" onClick={() => setIsMenuOpen(false)} className="text-2xl font-bold text-white">Home</a>
          <a href="#/about" onClick={() => setIsMenuOpen(false)} className="text-2xl font-bold text-white">About</a>
          <a href={`mailto:${aboutMe.email}`} className="text-xl text-brand-primary">{aboutMe.email}</a>
        </div>
      )}
    </header>
  );
};

const Footer = () => {
  const { aboutMe } = useContent();
  return (
    <footer className="bg-base-dark text-white pt-20 pb-12 border-t border-base-light/10">
      <div className="container mx-auto px-6">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-12 items-start text-center md:text-left">
          <div>
            <h4 className="text-2xl font-black tracking-tight mb-2">David Gaines</h4>
            <p className="text-text-tertiary text-sm">{aboutMe.title}</p>
          </div>
          <div className="flex flex-col items-center gap-2">
            <a href={`mailto:${aboutMe.email}`} className="text-lg font-bold hover:text-brand-primary transition-colors">{aboutMe.email}</a>
            <a href={`tel:${aboutMe.phone}`} className="text-lg font-bold hover:text-brand-primary transition-colors">{aboutMe.phone}</a>
          </div>
          <div className="flex justify-center md:justify-end gap-6">
             {aboutMe.socialLinks?.map((link, i) => (
               <a key={i} href={link.linkUrl} target="_blank" rel="noopener noreferrer" className="text-white hover:text-brand-primary transition-colors transform hover:scale-110">
                 {/* Placeholder for icons based on link.iconUrl */}
                 <span className="uppercase text-xs font-bold border border-white px-2 py-1 rounded">{link.iconUrl}</span>
               </a>
             ))}
          </div>
        </div>
        <div className="mt-16 flex justify-between items-end border-t border-base-light/10 pt-8">
           <p className="text-text-tertiary text-xs">Â© 2025 David Gaines. All rights reserved.</p>
           <a href="#/admin" onClick={(e) => { e.preventDefault(); window.location.hash = '/admin'; }} className="text-base-dark hover:text-base-dark cursor-default text-[10px]">Admin</a>
        </div>
      </div>
    </footer>
  );
};

// --- Block Renderers ---

const HeroBlock = ({ data }) => {
  const images = data.images || [];
  // Mobile Carousel / Desktop Grid
  if (images.length === 0) return null;
  
  if (images.length === 2) {
    return (
       <div className="grid grid-cols-1 md:grid-cols-2 gap-4 container mx-auto px-4 max-w-7xl my-8">
         {images.map((img, i) => (
           <div key={i} className="aspect-video relative overflow-hidden rounded-lg">
             <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" />
           </div>
         ))}
       </div>
    );
  }
  
  if (images.length === 3) {
     return (
       <div className="grid grid-cols-1 md:grid-cols-3 gap-4 container mx-auto px-4 max-w-7xl my-8">
         {images.map((img, i) => (
           <div key={i} className="aspect-video relative overflow-hidden rounded-lg">
             <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" />
           </div>
         ))}
       </div>
    );
  }

  // Single default
  return (
    <div className="container mx-auto px-4 max-w-7xl my-8">
      <div className="aspect-video relative overflow-hidden rounded-lg shadow-2xl">
        <img src={images[0].url} alt={images[0].alt} className="absolute inset-0 w-full h-full object-cover" />
      </div>
    </div>
  );
};

const TitleBlock = ({ project }) => (
  <div className="container mx-auto px-4 max-w-4xl text-center my-16">
    <h1 className="text-4xl md:text-6xl lg:text-7xl font-black text-body-headings mb-4 tracking-tight leading-none whitespace-nowrap overflow-hidden text-ellipsis">{project.title}</h1>
    <h2 className="text-xl md:text-2xl font-bold text-brand-primary mb-8">{project.client}</h2>
    <div className="flex flex-wrap justify-center gap-3">
      {project.tags.map((tag, i) => (
        <span key={i} className="px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider bg-tag-bg text-tag-text">
          {tag}
        </span>
      ))}
    </div>
  </div>
);

const TextBlock = ({ data }) => (
  <div className="container mx-auto px-4 max-w-3xl my-16">
    {data.heading && <h3 className="text-2xl font-bold text-body-headings mb-6">{data.heading}</h3>}
    <div className="prose prose-lg text-body-text leading-relaxed" dangerouslySetInnerHTML={{ __html: data.body }} />
  </div>
);

const PanoImageBlock = ({ data }) => {
  const { image, height = '250' } = data;
  const heightClasses = {
    '100': 'h-[100px]',
    '125': 'h-[125px]',
    '200': 'h-[200px]',
    '250': 'h-[250px]',
    '300': 'h-[300px]'
  };
  const hClass = heightClasses[height] || 'h-[250px]';

  return (
    <div className="container mx-auto px-4 max-w-7xl my-12">
      <div className={`relative w-full ${hClass} overflow-hidden rounded-lg shadow-lg`}>
        {image?.url ? (
          <img src={image.url} alt={image.alt} className="w-full h-full object-cover" />
        ) : (
          <div className="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 font-mono text-sm">NO IMAGE SET</div>
        )}
      </div>
    </div>
  );
};

const TextWithImagesBlock = ({ data }) => {
  const { heading, body, images = [], align = 'right', layout = 'square' } = data;
  // Layout logic for image aspect ratios
  const aspectRatio = layout === 'tall' ? 'aspect-[2/3]' : layout === 'extratall' ? 'aspect-[1/2]' : 'aspect-square';
  
  return (
    <div className="container mx-auto px-4 max-w-6xl my-16">
      <div className={`flex flex-col md:flex-row gap-12 items-start ${align === 'left' ? 'md:flex-row-reverse' : ''}`}>
        <div className="flex-1">
          {heading && <h3 className="text-2xl font-bold text-body-headings mb-6">{heading}</h3>}
          <div className="prose prose-lg text-body-text" dangerouslySetInnerHTML={{ __html: body }} />
        </div>
        <div className="w-full md:w-1/3 flex flex-col gap-6">
           {images.map((img, i) => (
             <div key={i} className={`w-full relative overflow-hidden rounded-lg shadow-md ${aspectRatio}`}>
               {img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 bg-gray-200" />}
             </div>
           ))}
        </div>
      </div>
    </div>
  );
};

// --- Page Components ---

const CaseStudyDetailPage = ({ projectId }) => {
  const { heroProjects } = useContent();
  const project = heroProjects.find(p => p.id === projectId);
  
  useEffect(() => { window.scrollTo(0, 0); }, [projectId]);

  if (!project) return <div className="min-h-screen bg-page-background flex items-center justify-center text-body-headings">Project not found</div>;

  const renderBlock = (block, index) => {
    switch (block.type) {
      case 'hero': return <HeroBlock key={index} data={block.data} />;
      case 'title': return <TitleBlock key={index} project={project} />;
      case 'text': return <TextBlock key={index} data={block.data} />;
      case 'textWithImages': return <TextWithImagesBlock key={index} data={block.data} />;
      case 'panoImage': return <PanoImageBlock key={index} data={block.data} />;
      // Fallback for other blocks if needed
      default: return null;
    }
  };

  return (
    <div className="min-h-screen pt-24 pb-32" style={{ backgroundColor: 'var(--page-background-color)' }}>
      <div className="h-12 w-full" style={{ backgroundColor: 'var(--page-background-color)' }}></div> {/* Top spacer */}
      {project.contentBlocks?.map((block, i) => renderBlock(block, i))}
      
      {/* Navigation */}
      <div className="container mx-auto px-6 mt-32 border-t border-gray-200 pt-16 flex justify-between">
         <a href="#/" className="text-body-headings font-bold hover:text-brand-primary flex items-center gap-2"><ArrowLeftIcon className="w-4 h-4" /> Back to Home</a>
      </div>
    </div>
  );
};

const HomePage = () => {
  const { heroProjects, aboutMe, clientLogos, brandLogos, updateHeroProjects } = useContent();
  const setHoverState = useContext(CursorHoverDispatchContext);

  // Drag and Drop Logic
  const dragItem = useRef();
  const dragOverItem = useRef();

  const handleDragStart = (e, position) => {
    dragItem.current = position;
    e.target.closest('.project-card').classList.add('project-dragging');
  };
  const handleDragEnter = (e, position) => {
    dragOverItem.current = position;
  };
  const handleDragEnd = (e) => {
    e.target.closest('.project-card').classList.remove('project-dragging');
    const copy = [...heroProjects];
    const itemContent = copy[dragItem.current];
    copy.splice(dragItem.current, 1);
    copy.splice(dragOverItem.current, 0, itemContent);
    dragItem.current = null;
    dragOverItem.current = null;
    updateHeroProjects(copy);
  };

  return (
    <div className="min-h-screen bg-base-dark text-white">
      {/* Hero */}
      <section className="min-h-[90vh] flex flex-col justify-center px-6 pt-32 relative overflow-hidden" style={{ backgroundColor: 'var(--hero-bg-color)' }}>
        <div className="container mx-auto relative z-10">
          <h1 className="text-[12vw] leading-[0.9] font-black tracking-tighter mb-8" style={{ color: 'var(--hero-text-color)' }}>
            {aboutMe.name.split(' ').map((word, i) => <span key={i} className="block">{word}</span>)}
          </h1>
          <div className="max-w-2xl ml-auto mt-12 border-t border-white/20 pt-8">
            <h2 className="text-xl md:text-2xl font-medium leading-relaxed text-text-secondary">{aboutMe.heroIntro}</h2>
          </div>
        </div>
      </section>

      {/* Projects */}
      <section className="py-32 bg-white text-base-dark">
        <div className="container mx-auto px-4">
           <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-24">
             {heroProjects.map((project, index) => (
               <a 
                 key={project.id}
                 href={`#/project/${project.id}`}
                 className="project-card group block cursor-none"
                 onMouseEnter={() => setHoverState({ isHovering: true, text: '' })} // Removed VIEW text
                 onMouseLeave={() => setHoverState({ isHovering: false, text: undefined })}
                 draggable // Allow drag if admin enabled? Only enabled in admin actually. Keeping structure simple here.
               >
                 <div className="aspect-[4/3] overflow-hidden rounded-lg mb-6 relative">
                   <img src={project.homePageImage?.url || project.heroImage?.url} alt={project.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                 </div>
                 <h3 className="text-3xl font-bold mb-2">{project.homePageTitle || project.title}</h3>
                 <p className="text-text-tertiary text-lg">{project.homePageSubtitle}</p>
                 <div className="flex gap-2 mt-4">
                    {project.tags.slice(0, 3).map(t => <span key={t} className="text-xs font-bold uppercase border border-gray-200 px-2 py-1 rounded text-gray-500">{t}</span>)}
                 </div>
               </a>
             ))}
           </div>
        </div>
      </section>

      {/* Partners */}
      <section className="py-24 bg-white text-base-dark overflow-hidden">
        <div className="container mx-auto px-6 mb-12">
           <h3 className="text-sm font-bold text-gray-400 uppercase tracking-widest mb-8">Clients</h3>
           <div className="flex gap-12 overflow-hidden whitespace-nowrap mask-gradient">
              <div className="animate-infinite-scroll-left flex gap-16 items-center">
                 {[...clientLogos, ...clientLogos].map((logo, i) => (
                    <img key={i} src={logo} className={`h-8 w-auto object-contain ${aboutMe.useMonochromeLogos ? 'filter grayscale brightness-50 opacity-70' : ''}`} alt="client" />
                 ))}
              </div>
           </div>
        </div>
         <div className="container mx-auto px-6">
           <h3 className="text-sm font-bold text-gray-400 uppercase tracking-widest mb-8">Brands</h3>
           <div className="flex gap-12 overflow-hidden whitespace-nowrap mask-gradient">
              <div className="animate-infinite-scroll-left flex gap-16 items-center">
                 {[...brandLogos, ...brandLogos].map((logo, i) => (
                    <img key={i} src={logo} className={`h-8 w-auto object-contain ${aboutMe.useMonochromeLogos ? 'filter grayscale brightness-50 opacity-70' : ''}`} alt="brand" />
                 ))}
              </div>
           </div>
        </div>
      </section>
    </div>
  );
};

// --- Admin Components ---
const AdminPage = () => {
  const { heroProjects, updateHeroProjects, resetToDefaults } = useContent();
  const [editingProject, setEditingProject] = useState(null);
  const [activeTab, setActiveTab] = useState('projects');

  // Simple drag sort for projects
  const dragItem = useRef();
  const dragOverItem = useRef();
  
  const onDragStart = (e, index) => { dragItem.current = index; };
  const onDragEnter = (e, index) => { dragOverItem.current = index; };
  const onDragEnd = () => {
      const copy = [...heroProjects];
      const item = copy[dragItem.current];
      copy.splice(dragItem.current, 1);
      copy.splice(dragOverItem.current, 0, item);
      dragItem.current = null; dragOverItem.current = null;
      updateHeroProjects(copy);
  };

  if (editingProject) {
     return <ProjectBuilder 
        initialProject={editingProject} 
        onSave={(p) => {
           const updated = heroProjects.map(prj => prj.id === p.id ? p : prj);
           if(!heroProjects.find(x => x.id === p.id)) updated.push(p);
           updateHeroProjects(updated);
           setEditingProject(null);
        }}
        onCancel={() => setEditingProject(null)}
     />;
  }

  return (
    <div className="min-h-screen bg-base-dark text-white p-8 pt-32">
      <div className="container mx-auto max-w-5xl">
        <h1 className="text-4xl font-bold mb-8">Admin Dashboard</h1>
        <div className="flex gap-4 mb-8 border-b border-gray-700 pb-4">
          <button onClick={() => setActiveTab('projects')} className={`px-4 py-2 rounded ${activeTab === 'projects' ? 'bg-brand-primary' : 'bg-base-medium'}`}>Projects</button>
          <button onClick={() => setActiveTab('danger')} className={`px-4 py-2 rounded ${activeTab === 'danger' ? 'bg-red-600' : 'bg-base-medium'}`}>Danger Zone</button>
        </div>

        {activeTab === 'projects' && (
          <div className="space-y-4">
            <button onClick={() => setEditingProject({ id: `new-${Date.now()}`, title: 'New Project', contentBlocks: [] })} className="bg-brand-primary px-6 py-3 rounded font-bold mb-4">+ Add New Project</button>
            <div className="space-y-2">
               {heroProjects.map((p, index) => (
                 <div key={p.id} 
                      draggable 
                      onDragStart={(e) => onDragStart(e, index)}
                      onDragEnter={(e) => onDragEnter(e, index)}
                      onDragEnd={onDragEnd}
                      className="bg-base-medium p-4 rounded flex justify-between items-center cursor-move hover:bg-gray-800 transition-colors"
                 >
                    <span>{p.title}</span>
                    <div className="flex gap-2">
                       <button onClick={() => setEditingProject(p)} className="text-sm bg-base-dark px-3 py-1 rounded">Edit</button>
                    </div>
                 </div>
               ))}
            </div>
          </div>
        )}

        {activeTab === 'danger' && (
          <div className="bg-red-900/30 border border-red-500 p-6 rounded">
             <h3 className="text-red-500 font-bold mb-2">Reset Content</h3>
             <p className="text-sm mb-4">This will overwrite all your current data with the template defaults. This cannot be undone.</p>
             <button onClick={resetToDefaults} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Reset Content to Template Defaults</button>
          </div>
        )}
      </div>
    </div>
  );
};

const ProjectBuilder = ({ initialProject, onSave, onCancel }) => {
  const [project, setProject] = useState(initialProject);
  const [editingBlockIndex, setEditingBlockIndex] = useState(null);

  const addBlock = (type) => {
    let data = {};
    if (type === 'panoImage') data = { image: { url: '', alt: '' }, height: '250' };
    else if (type === 'text') data = { heading: 'Heading', body: 'Content goes here.' };
    
    setProject({ ...project, contentBlocks: [...(project.contentBlocks || []), { type, data }] });
  };
  
  const updateBlock = (index, newData) => {
     const updated = [...project.contentBlocks];
     updated[index].data = newData;
     setProject({ ...project, contentBlocks: updated });
     setEditingBlockIndex(null);
  };
  
  const removeBlock = (index) => {
     const updated = [...project.contentBlocks];
     updated.splice(index, 1);
     setProject({ ...project, contentBlocks: updated });
  };

  return (
    <div className="min-h-screen bg-base-dark text-white p-8 pt-32">
      {editingBlockIndex !== null && (
        <BlockEditorModal 
           block={project.contentBlocks[editingBlockIndex]} 
           onSave={(data) => updateBlock(editingBlockIndex, data)} 
           onClose={() => setEditingBlockIndex(null)} 
        />
      )}
      
      <div className="container mx-auto flex gap-8">
        {/* Main Content */}
        <div className="flex-1 space-y-8">
           <div className="bg-base-medium p-6 rounded">
              <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Project Title</label>
              <input value={project.title} onChange={e => setProject({...project, title: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white" />
           </div>

           <div className="space-y-4">
              {project.contentBlocks?.map((block, i) => (
                 <div key={i} className="bg-base-medium p-4 rounded border border-gray-700 flex justify-between items-center">
                    <span className="font-mono text-sm text-brand-primary">{block.type}</span>
                    <div className="flex gap-2">
                       <button onClick={() => setEditingBlockIndex(i)} className="text-xs bg-blue-600 px-2 py-1 rounded">Edit</button>
                       <button onClick={() => removeBlock(i)} className="text-xs bg-red-600 px-2 py-1 rounded">Delete</button>
                    </div>
                 </div>
              ))}
           </div>
           
           <div className="flex justify-between pt-8">
              <button onClick={onCancel} className="text-gray-400">Cancel</button>
              <button onClick={() => onSave(project)} className="bg-green-600 px-8 py-3 rounded font-bold">Save Project</button>
           </div>
        </div>

        {/* Sidebar */}
        <div className="w-64 space-y-4">
           <div className="bg-base-medium p-4 rounded sticky top-32">
              <h3 className="font-bold mb-4">Add Content Block</h3>
              <div className="space-y-2 flex flex-col">
                 <button onClick={() => addBlock('hero')} className="bg-base-dark hover:bg-gray-700 p-2 rounded text-left text-sm">Hero Section</button>
                 <button onClick={() => addBlock('title')} className="bg-base-dark hover:bg-gray-700 p-2 rounded text-left text-sm">Title Block</button>
                 <button onClick={() => addBlock('text')} className="bg-base-dark hover:bg-gray-700 p-2 rounded text-left text-sm">Text Block</button>
                 <button onClick={() => addBlock('textWithImages')} className="bg-base-dark hover:bg-gray-700 p-2 rounded text-left text-sm">Text + Images</button>
                 <button onClick={() => addBlock('panoImage')} className="bg-brand-primary hover:bg-blue-600 p-2 rounded text-left text-sm font-bold">Pano Image</button>
              </div>
           </div>
        </div>
      </div>
    </div>
  );
};

const BlockEditorModal = ({ block, onSave, onClose }) => {
   const [data, setData] = useState(block.data);
   
   return (
     <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-8">
        <div className="bg-base-medium w-full max-w-2xl p-6 rounded-lg shadow-2xl overflow-y-auto max-h-[90vh]">
           <h3 className="text-xl font-bold mb-6 capitalize">Edit {block.type}</h3>
           
           <div className="space-y-6">
              {block.type === 'panoImage' && (
                 <>
                   <div>
                     <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Image URL <span className="text-brand-primary">(Rec: 2000px wide)</span></label>
                     <input value={data.image?.url || ''} onChange={e => setData({...data, image: {...data.image, url: e.target.value}})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white" />
                   </div>
                   <div>
                     <label className="block text-xs font-bold uppercase text-gray-500 mb-1">Height</label>
                     <select value={data.height || '250'} onChange={e => setData({...data, height: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white">
                        <option value="100">100px</option>
                        <option value="125">125px</option>
                        <option value="200">200px</option>
                        <option value="250">250px</option>
                        <option value="300">300px</option>
                     </select>
                   </div>
                 </>
              )}
              {block.type === 'text' && (
                 <>
                   <input value={data.heading} onChange={e => setData({...data, heading: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white font-bold" placeholder="Heading" />
                   <textarea value={data.body} onChange={e => setData({...data, body: e.target.value})} className="w-full bg-base-dark border border-gray-700 p-2 rounded text-white h-48" placeholder="Content..." />
                 </>
              )}
              {/* Other block forms omitted for brevity but logic is similar */}
           </div>

           <div className="flex justify-end gap-4 mt-8 pt-4 border-t border-gray-700">
              <button onClick={onClose} className="text-gray-400">Cancel</button>
              <button onClick={() => onSave(data)} className="bg-brand-primary px-6 py-2 rounded font-bold">Save Changes</button>
           </div>
        </div>
     </div>
   );
};

// --- App Root ---
const MainApp = () => {
  const { path } = useRouter();
  const parts = path.split('/');
  
  if (path === '#/admin') return <AdminPage />;
  if (parts[1] === 'project') return <><Header /><CaseStudyDetailPage projectId={parts[2]} /><Footer /><CustomCursor /></>;
  return <><Header /><HomePage /><Footer /><CustomCursor /></>;
};

const App = () => (
  <ContentProvider>
    <CursorHoverProvider>
      <MainApp />
    </CursorHoverProvider>
  </ContentProvider>
);

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>