<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>David Gaines | Creative Director Portfolio</title>
    <meta name="description" content="A personal portfolio website for Creative Director David Gaines, showcasing impact, strategy, leadership, and adaptability through curated case studies and recent work."/>
    <script>
      (function() {
        const path = window.location.pathname;
        const hash = window.location.hash;
        if (path && path !== '/' && !hash) {
          window.location.replace('/#' + path + window.location.search);
        }
      })();
    </script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='10' fill='%230f172a' /><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Inter, sans-serif' font-size='50' font-weight='900' fill='%23f8fafc'>GD!</text></svg>" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
      body.hide-cursor, body.hide-cursor * {
        cursor: none;
      }
      .text-textured {
        background-image: url('https://images.unsplash.com/photo-1564288819588-6db0b59c4a84?q=80&w=1000&auto=format&fit=crop');
        background-size: cover;
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
      }
      /* Style for the sticky header to enable cursor blend effect */
      .header-with-blur::before {
        content: '';
        position: absolute;
        inset: 0;
        z-index: -1;
        background-color: rgba(var(--header-bg-color-rgb, 15, 23, 42), 0.8);
        -webkit-backdrop-filter: blur(12px); /* Corresponds to backdrop-blur-lg */
        backdrop-filter: blur(12px);
      }
      .logo-dragging {
        opacity: 0.5;
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(8, 145, 178, 0.7);
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              'brand-primary': 'var(--accent-color, #0891b2)', 
              'brand-secondary': 'var(--accent-secondary-color, #f0f9ff)', 
              'base-dark': '#0f172a', // Slate 900
              'base-medium': '#1e293b', // Slate 800
              'base-light': '#334155', // Slate 700
              'text-primary': 'var(--hero-text-color, #f8fafc)',
              'text-secondary': '#cbd5e1', // Slate 300
              'text-tertiary': '#94a3b8', // Slate 400
              'body-headings': 'var(--body-headings-color, #1e293b)',
              'body-text': 'var(--body-text-color, #475569)',
              'tag-bg': 'var(--project-tag-bg-color)',
              'tag-text': 'var(--project-tag-text-color)',
            },
            animation: {
              'fade-in-up': 'fade-in-up 0.6s ease-out forwards',
              'infinite-scroll-left': 'infinite-scroll-left 60s linear infinite',
              'infinite-scroll-right': 'infinite-scroll-right 60s linear infinite',
            },
            keyframes: {
              'fade-in-up': {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              'infinite-scroll-left': {
                '0%': { transform: 'translateX(0)' },
                '100%': { transform: 'translateX(-50%)' },
              },
              'infinite-scroll-right': {
                '0%': { transform: 'translateX(-50%)' },
                '100%': { transform: 'translateX(0)' },
              },
            }
          }
        }
      }
    </script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
{
  "imports": {
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
  }
}
</script>
</head>
  <body class="bg-base-dark text-text-primary font-sans">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
import React from 'react';
import ReactDOM from 'react-dom/client';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot } from 'firebase/firestore';

const { useState, useEffect, createContext, useContext, useRef, Component } = React;

// --- Inlined from constants.ts ---
const CLIENT_LOGOS = [
    'https://logo.clearbit.com/transistor.fm', 'https://logo.clearbit.com/reform.app', 'https://logo.clearbit.com/tuple.app', 'https://logo.clearbit.com/savvycal.com', 'https://logo.clearbit.com/statamic.com', 'https://logo.clearbit.com/google.com', 'https://logo.clearbit.com/laravel.com', 'https://logo.clearbit.com/miragejs.com', 'https://logo.clearbit.com/workcation.com', 'https://logo.clearbit.com/microsoft.com', 'https://logo.clearbit.com/vercel.com', 'https://logo.clearbit.com/github.com', 'https://logo.clearbit.com/meta.com', 'https://logo.clearbit.com/intel.com', 'https://logo.clearbit.com/sentry.io', 'https://logo.clearbit.com/mailchimp.com', 'https://logo.clearbit.com/notion.so', 'https://logo.clearbit.com/atlassian.com', 'https://logo.clearbit.com/asana.com', 'https://logo.clearbit.com/loom.com', 'https://logo.clearbit.com/framer.com', 'https://logo.clearbit.com/figma.com', 'https://logo.clearbit.com/dribbble.com', 'https://logo.clearbit.com/hubspot.com', 'https://logo.clearbit.com/shopify.com', 'https://logo.clearbit.com/intercom.com', 'https://logo.clearbit.com/slack.com', 'https://logo.clearbit.com/stripe.com', 'https://logo.clearbit.com/airbnb.com', 'https://logo.clearbit.com/netflix.com',
];
const BRAND_LOGOS = [
    'https://logo.clearbit.com/sony.com', 'https://logo.clearbit.com/nike.com', 'https://logo.clearbit.com/cocacola.com', 'https://logo.clearbit.com/netflix.com', 'https://logo.clearbit.com/spotify.com', 'https://logo.clearbit.com/playstation.com', 'https://logo.clearbit.com/nintendo.com', 'https://logo.clearbit.com/lego.com', 'https://logo.clearbit.com/redbull.com', 'https://logo.clearbit.com/starbucks.com', 'https://logo.clearbit.com/disney.com', 'https://logo.clearbit.com/amazon.com', 'https://logo.clearbit.com/apple.com', 'https://logo.clearbit.com/tesla.com', 'https://logo.clearbit.com/mcdonalds.com',
];
const HERO_PROJECTS = [
  {
    id: 'aura-health',
    title: 'Aura Health & Wellness App',
    client: 'Mindful Technologies',
    tags: ['UI/UX Design', 'Mobile App', 'Health & Wellness', 'Branding'],
    heroImage: { url: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=1200&auto=format&fit=crop', alt: 'A serene mobile app interface for a wellness application.' },
    homePageTitle: 'Aura: Mindful Wellness',
    homePageSubtitle: 'Crafting a calming, user-centric mobile experience for mental well-being.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1498837167922-ddd27525d352?q=80&w=800&auto=format&fit=crop', alt: 'A person meditating in a peaceful, natural environment.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?q=80&w=1200&auto=format&fit=crop', alt: 'Aura App Meditation Screen' }], style: 'single' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Challenge', body: 'Design and launch Aura, a new mobile app aimed at making mindfulness and meditation accessible to a wider audience. The goal was to create a sanctuary-like digital space that reduces stress, not adds to it, standing out in a crowded market of wellness apps.' } },
      { type: 'stats', data: { stats: [{ value: '500K+', label: 'Downloads in Year One' }, { value: '4.8 ★', label: 'Average App Store Rating' }, { value: 'Featured', label: 'by Apple as App of the Day' }] } },
      { type: 'textWithImages', data: { heading: 'A Human-Centered Approach', body: 'Our process began with deep user research into anxiety triggers and relaxation techniques. This informed a minimalist UI with a soothing color palette, gentle animations, and intuitive navigation. We focused on creating guided meditation journeys that were easy to follow for beginners while still offering depth for experienced users.', images: [{ url: 'https://images.unsplash.com/photo-1512486130939-2c4f79935e4f?q=80&w=800&auto=format&fit=crop', alt: 'Wireframes and sketches of the Aura app' }], imagePosition: 'right', imageLayout: 'singleTall' } },
      { type: 'quote', data: { quotes: [{ text: 'Using Aura feels like a deep breath in a chaotic world. It’s beautifully designed and genuinely helpful.', author: 'User Review' }], style: 'single' } },
      { type: 'carousel', data: { images: [{ url: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?q=80&w=800&auto=format&fit=crop', alt: 'Aura app guided breathing exercise' }, { url: 'https://images.unsplash.com/photo-1599301859914-0a6b4a5e0f7e?q=80&w=800&auto=format&fit=crop', alt: 'Aura app sleep stories interface' }, { url: 'https://images.unsplash.com/photo-1605320922883-500b3f790a3c?q=80&w=800&auto=format&fit=crop', alt: 'Aura app progress tracking screen' }] } },
    ]
  },
  {
    id: 'quantum-leap-ai',
    title: 'QuantumLeap AI SaaS Platform',
    client: 'Cognitive Dynamics Inc.',
    tags: ['B2B', 'SaaS', 'AI', 'Brand Identity', 'Web Design'],
    heroImage: { url: 'https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?q=80&w=1200&auto=format&fit=crop', alt: 'A sophisticated dashboard for an AI SaaS platform shown on a laptop.' },
    homePageTitle: 'QuantumLeap AI',
    homePageSubtitle: 'Designing the brand and UI for a next-generation enterprise AI platform.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1620712943543-2858200f745a?q=80&w=800&auto=format=fit&crop', alt: 'Abstract visualization of an artificial intelligence network.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=800&auto=format&fit=crop', alt: 'QuantumLeap data visualization dashboard' }, { url: 'https://images.unsplash.com/photo-1614064548237-02f0d1467812?q=80&w=800&auto=format&fit=crop', alt: 'QuantumLeap machine learning model builder' }], style: 'duo' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Mission', body: 'Develop a powerful and intuitive brand identity and user interface for QuantumLeap, an AI platform designed to help enterprises make sense of massive datasets. The challenge was to communicate immense technical power while ensuring the product felt accessible and manageable to data scientists and business analysts alike.' } },
      { type: 'imageGrid', data: { images: [{ url: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?q=80&w=600&auto=format&fit=crop', alt: 'Data stream visualization' }, { url: 'https://images.unsplash.com/photo-1633409361618-c73427e4e206?q=80&w=600&auto=format&fit=crop', alt: 'AI model training interface' }, { url: 'https://images.unsplash.com/photo-1573164713988-8665fc963095?q=80&w=600&auto=format&fit=crop', alt: 'Collaborative AI project workspace' }] } },
      { type: 'text', data: { heading: 'Simplifying Complexity', body: 'The design system, built on a dark-mode-first philosophy, uses a vibrant, futuristic color palette to highlight key data points and actions. We created a modular dashboard system that allows users to customize their workspace, and developed a library of data visualization components that could present complex information in a clear, digestible format.' } },
      { type: 'stats', data: { stats: [{ value: '40%', label: 'Faster Data Analysis' }, { value: '300+', label: 'Enterprise Clients' }, { value: '$50M', label: 'Series A Funding' }] } }
    ]
  },
  {
    id: 'journeyman-gear',
    title: 'Journeyman Travel Gear',
    client: 'Odyssey Outfitters',
    tags: ['E-commerce', 'Art Direction', 'Lifestyle', 'Retail'],
    heroImage: { url: 'https://images.unsplash.com/photo-1501555088652-021faa106b9b?q=80&w=1200&auto=format&fit=crop', alt: 'A durable travel backpack in a rugged, mountainous landscape.' },
    homePageTitle: 'Journeyman Gear',
    homePageSubtitle: 'Building a direct-to-consumer brand for durable, modern travel gear.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1522069169874-c58ec4b76be5?q=80&w=800&auto=format&fit=crop', alt: 'A person looking out over a stunning travel destination.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1551632811-561732d1e306?q=80&w=1200&auto=format&fit=crop', alt: 'A hiker with a Journeyman backpack overlooking a mountain range.' }], style: 'single' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Brand Vision', body: 'Create Journeyman, a new e-commerce brand for travelers who demand both rugged durability and minimalist design. The brand needed to inspire adventure while showcasing the premium quality and thoughtful features of its products.' } },
      { type: 'imageRow', data: { images: [{ url: 'https://images.unsplash.com/photo-1559181567-c3190ca9959b?q=80&w=1920&auto=format&fit=crop', alt: 'Product shots of the Journeyman gear' }], style: 'singleWide' } },
      { type: 'quote', data: { quotes: [{ text: 'Journeyman gear is the perfect companion for the modern explorer. Built to last, designed to impress.', author: 'Wanderlust Magazine' }], style: 'single' } },
      { type: 'textWithImages', data: { heading: 'Art Direction & E-commerce', body: 'We established an art direction that contrasts the clean, minimal product design with raw, epic landscapes. The e-commerce experience was built to be highly visual, with large-format photography, video content, and interactive modules that highlighted key features like waterproof zippers and modular compartments. A streamlined checkout process ensured a frictionless path to purchase.', images: [{ url: 'https://images.unsplash.com/photo-1604754742629-0e58855135f6?q=80&w=800&auto=format&fit=crop', alt: 'Detail shot of the backpack\'s waterproof material' }, { url: 'https://images.unsplash.com/photo-1572293498184-17635a11a1d9?q=80&w=800&auto=format=fit&crop', alt: 'Close up of the bag\'s custom hardware' }], imagePosition: 'left', imageLayout: 'stackTwoSquare' } },
    ]
  },
  {
    id: 'echo-acoustics',
    title: 'Echo High-Fidelity Audio',
    client: 'Resonance Labs',
    tags: ['Product Design', 'Branding', 'CPG', 'Luxury'],
    heroImage: { url: 'https://images.unsplash.com/photo-1518731967223-a2629c41a4a3?q=80&w=1200&auto=format&fit=crop', alt: 'A sleek, minimalist high-fidelity speaker in a modern living room.' },
    homePageTitle: 'Echo Acoustics',
    homePageSubtitle: 'Launching a new brand of premium, minimalist audio equipment.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1593902341396-e24c47d337a2?q=80&w=800&auto=format=fit&crop', alt: 'Close-up detail of a high-end speaker.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1620986341238-bbc8429e1f54?q=80&w=800&auto=format&fit=crop', alt: 'Front view of the Echo speaker' }, { url: 'https://images.unsplash.com/photo-1620986341204-3755b4142f38?q=80&w=800&auto=format&fit=crop', alt: 'Side profile of the Echo speaker' }, { url: 'https://images.unsplash.com/photo-1620986341290-002a5f78b7b2?q=80&w=800&auto=format&fit=crop', alt: 'Detail of the Echo speaker controls' }], style: 'trio' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Concept', body: 'Introduce Echo, a new player in the high-fidelity audio market. The brand strategy was to merge superior acoustic engineering with a minimalist, Scandinavian-inspired design aesthetic, appealing to audiophiles who also value interior design.' } },
      { type: 'textWithImages', data: { heading: 'Precision in Sound & Design', body: 'The brand identity is built on clean lines, geometric shapes, and a monochrome palette. Product photography emphasizes texture and form, highlighting materials like brushed aluminum and natural wood. The launch website was designed as an immersive gallery, showcasing the speakers as functional works of art.', images: [{ url: 'https://images.unsplash.com/photo-1589138096954-a3f8a939f8a3?q=80&w=800&auto=format&fit=crop', alt: 'The Echo speaker in a beautifully designed home' }], imagePosition: 'right', imageLayout: 'singleExtraTall' } },
      { type: 'quote', data: { quotes: [{ text: 'Echo speakers sound as good as they look, and they look incredible.', author: 'Design Milk' }, { text: 'A triumph of minimalist design and acoustic perfection.', author: 'Hi-Fi World' }], style: 'duo' } },
      { type: 'image', data: { image: { url: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1200&auto=format&fit=crop', alt: 'The full Echo product line including headphones.' }, size: 'medium', caption: 'The Echo ecosystem, designed for a seamless audio experience.' } },
    ]
  },
  {
    id: 'civic-connect',
    title: 'CivicConnect Urban Planning',
    client: 'Metropolis Foundation',
    tags: ['Public Sector', 'Social Impact', 'Data Visualization', 'Web Platform'],
    heroImage: { url: 'https://images.unsplash.com/photo-1549880181-56a44cf4a9a5?q=80&w=1200&auto=format&fit=crop', alt: 'An aerial view of a complex city interchange, representing urban planning.' },
    homePageTitle: 'CivicConnect Platform',
    homePageSubtitle: 'A digital platform to foster community engagement in urban development.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1479839672679-a46483c0f748?q=80&w=800&auto=format&fit=crop', alt: 'A vibrant city street with people and activity.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?q=80&w=1200&auto=format&fit=crop', alt: 'A community meeting for urban planning.' }], style: 'single' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Goal', body: 'Create CivicConnect, a web platform to bridge the gap between city planners and residents. The tool needed to visualize complex urban development projects, gather public feedback, and make civic engagement more accessible and transparent.' } },
      { type: 'stats', data: { stats: [{ value: '+400%', label: 'Increase in Public Feedback' }, { value: '15+', label: 'Municipalities Adopted' }, { value: 'Award', label: 'for Digital Democracy' }] } },
      { type: 'image', data: { image: { url: 'https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?q=80&w=1200&auto=format&fit=crop', alt: 'The CivicConnect platform dashboard shown on a laptop and tablet.' }, size: 'medium', caption: 'The platform features interactive maps, surveys, and project timelines.' } },
      { type: 'text', data: { heading: 'Informing and Empowering', body: 'The UI/UX was designed for ultimate clarity, using interactive maps, data visualizations, and simple language to explain zoning changes, infrastructure projects, and environmental impacts. A key feature was the feedback module, which allowed residents to comment directly on project plans and upvote ideas from their neighbors, fostering a truly collaborative planning process.' } },
    ]
  },
  {
    id: 'retrograde-game',
    title: 'Retrograde Video Game Launch',
    client: 'PixelHeart Studios',
    tags: ['Entertainment', 'Game Design', 'Pixel Art', 'Digital'],
    heroImage: { url: 'https://images.unsplash.com/photo-1555864449-41a94235be48?q=80&w=1200&auto=format&fit=crop', alt: 'A person intensely playing a video game on a controller.' },
    homePageTitle: 'Retrograde Game Launch',
    homePageSubtitle: 'Launching a new indie game with a nostalgic pixel art aesthetic.',
    homePageImage: { url: 'https://images.unsplash.com/photo-1580234811497-9df7fd2f357e?q=80&w=800&auto=format&fit=crop', alt: 'Close-up of a classic arcade game joystick and buttons.' },
    contentBlocks: [
      { type: 'hero', data: { images: [{ url: 'https://images.unsplash.com/photo-1612036782180-6f0b6cd84627?q=80&w=800&auto=format&fit=crop', alt: 'Promotional art for the game Retrograde' }, { url: 'https://images.unsplash.com/photo-1636654211181-7098bb4f9715?q=80&w=800&auto=format&fit=crop', alt: 'A character from the game Retrograde' }, { url: 'https://images.unsplash.com/photo-1636654211287-350756da528a?q=80&w=800&auto=format&fit=crop', alt: 'A scene from the game Retrograde' }], style: 'trio' } },
      { type: 'title', data: {} },
      { type: 'text', data: { heading: 'The Game', body: 'Retrograde is a love letter to 16-bit gaming, combining classic pixel art with modern game mechanics. The launch campaign needed to capture the hearts of nostalgic gamers while also appealing to a new generation of players.' } },
      { type: 'carousel', data: { images: [{ url: 'https://images.unsplash.com/photo-1639946231645-3d4b6840455a?q=80&w=1200&auto=format&fit=crop', alt: 'Gameplay screenshot 1' }, { url: 'https://images.unsplash.com/photo-1636654211234-a657e2a4a758?q=80&w=1200&auto=format&fit=crop', alt: 'Gameplay screenshot 2' }, { url: 'https://images.unsplash.com/photo-1636654211287-350756da528a?q=80&w=1200&auto=format&fit=crop', alt: 'Gameplay screenshot 3' }] } },
      { type: 'text', data: { heading: 'Digital-First Campaign', body: 'We built a vibrant online presence with a retro-themed website, animated trailers, and a strong social media campaign focused on community engagement. We partnered with gaming influencers for early access streams and ran a contest for fans to design their own pixel art characters, building a dedicated fanbase before the game even launched.' } },
      { type: 'quote', data: { quotes: [{ text: 'Retrograde is a pixel-perfect masterpiece of nostalgia and innovation.', author: 'IGN' }, { text: 'The game I didn\'t know I was waiting for. An instant classic.', author: 'Kotaku' }], style: 'duo' } }
    ]
  }
];
const ABOUT_ME = {
  name: 'David Gaines', title: 'Creative Director & Brand Strategist', logoText: 'GD!', headerIcon: { url: '', alt: 'Site Icon' }, heroImage: { url: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=800&auto=format=fit&crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D', alt: 'A portrait of David Gaines, Creative Director' }, introStatement: "A highly accomplished Creative Leader with 20+ years of experience solving complex marketing challenges by leading and mentoring creative teams. Committed to elevating craft standards and translating brand strategy into high-impact digital-first concepts.", heroIntro: "A creative leader translating complex brand strategy into high-impact, pixel-perfect design across digital, print, and retail experiences.", philosophy: [{ title: 'Strategy-Driven Creative', text: 'I believe great creative is driven by strategic insight, not just aesthetics. My process begins with understanding the business challenge to ensure every design choice has a purpose and delivers measurable results.' }, { title: 'Mentorship & Team Building', text: "My role as a leader is to mentor the next generation of creatives. I focus on building collaborative, empowered teams where talent can thrive and produce their best work." }, { title: 'Bridging Complexity and User Experience', text: "I specialize in bridging complicated technical requirements with compelling user experiences, translating product features into emotional connections that resonate with audiences." },], obsessions: ['Swiss Typography', 'Japanese Denim', 'Vintage Synthesizers', 'Perfect Espresso', 'Mid-Century Furniture', 'Film Photography'], travelLog: [{ text: 'Tokyo, Japan', completed: true }, { text: 'Reykjavik, Iceland', completed: false }, { text: 'Berlin, Germany', completed: true }, { text: 'Kyoto, Japan', completed: false }, { text: 'Mexico City', completed: false }, { text: 'Copenhagen, Denmark', completed: false }, { text: 'Buenos Aires', completed: false }, { text: 'Seoul, South Korea', completed: false }, { text: 'Lisbon, Portugal', completed: false }], quotes: [{ text: "Good design is as little design as possible.", author: "Dieter Rams" }, { text: "The details are not the details. They make the design.", author: "Charles Eames" }], favorites: { movies: ['Blade Runner 2049', 'Arrival', 'Grand Budapest Hotel'], shows: ['Severance', 'The Bear', 'Succession'], podcasts: ['99% Invisible', 'Design Matters', 'How I Built This'], audiobooks: ['The Creative Act', 'Steve Jobs', 'Kitchen Confidential'] }, panorama: { url: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=2000&auto=format&fit=crop', alt: 'A beautiful panoramic landscape for visual inspiration' }, inspirationGrid: [{ url: 'https://images.unsplash.com/photo-1513364776144-60967b0f800f?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 1' }, { url: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 2' }, { url: 'https://images.unsplash.com/photo-1497215728101-856f4ea42174?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 3' }, { url: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 4' }, { url: 'https://images.unsplash.com/photo-1605106702842-01a887a31122?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 5' }, { url: 'https://images.unsplash.com/photo-1502945015378-0e284ca1a5be?q=80&w=1200&auto=format&fit=crop', alt: 'Inspiration image 6' }], resumeUrl: '#', socialLinks: [{ iconUrl: 'linkedin', linkUrl: 'https://linkedin.com/in/davidrgaines' }], email: 'dave@gainesdg.com', phone: '949.463.1867', 
  // Color Palette
  accentColor: '#0891b2', 
  accentSecondaryColor: '#f0f9ff', 
  headerBackgroundColor: '#0f172a', 
  heroBackgroundColor: '#0f172a', 
  heroTextColor: '#f8fafc', 
  pageBackgroundColor: '#ffffff',
  bodyHeadingsColor: '#1e293b',
  bodyTextColor: '#475569',
  projectTagBackgroundColor: '#1e293b',
  // SEO
  seoTitle: 'David Gaines | Creative Director Portfolio', seoDescription: 'A personal portfolio website for Creative Director David Gaines, showcasing impact, strategy, leadership, and adaptability through curated case studies and recent work.',
  // Logos
  useMonochromeLogos: false,
  // Page Headings (About Page)
  pageHeadings: {
    aboutTitle: 'About Me <span class="text-brand-primary">&</span> <br/>The Process',
    philosophySubtitle: 'Strategy first. <br/> Design second.',
    obsessionsTitle: 'Obsessed With',
    bucketListTitle: 'Bucket List',
    mediaDietTitle: 'Media Diet',
    mediaDietMovies: 'Movies',
    mediaDietShows: 'Shows',
    mediaDietPodcasts: 'Podcasts',
    mediaDietAudiobooks: 'Audiobooks',
  },
};

// --- Inlined from lib/firebase.ts ---
const firebaseConfig = { apiKey: "AIzaSyDAaX8so7wzwuhuWHeNN8CXWfHnXx9dREQ", authDomain: "port-82839.firebaseapp.com", projectId: "port-82839", storageBucket: "port-82839.firebasestorage.app", messagingSenderId: "463866065220", appId: "1:463866065220:web:775b841f67d43b64e8a711" };
const isConfigured = firebaseConfig.apiKey && !firebaseConfig.apiKey.startsWith("PASTE_");
let app = null, auth = null, db = null;
if (isConfigured) {
  try {
    app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    db = getFirestore(app);
  } catch (error) {
    console.error("Firebase initialization failed.", error);
  }
}

// --- Inlined from components/ui/CustomCursor.tsx ---
const CursorHoverStateContext = createContext(undefined);
const CursorHoverDispatchContext = createContext(undefined);

const CursorHoverProvider = ({ children }) => {
  const [hoverState, setHoverState] = useState({ isHovering: false, text: undefined });
  return (
    <CursorHoverStateContext.Provider value={hoverState}>
        <CursorHoverDispatchContext.Provider value={setHoverState}>
            {children}
        </CursorHoverDispatchContext.Provider>
    </CursorHoverStateContext.Provider>
  );
};

const CustomCursor = () => {
    const hoverState = useContext(CursorHoverStateContext);
    const { isHovering, text } = hoverState || {};
    const [position, setPosition] = useState({ x: -100, y: -100 });

    useEffect(() => {
        const handleMouseMove = (e) => {
            setPosition({ x: e.clientX, y: e.clientY });
        };
        const handleMouseLeave = () => {
          setPosition({ x: -100, y: -100 });
        }
        window.addEventListener('mousemove', handleMouseMove);
        document.documentElement.addEventListener('mouseleave', handleMouseLeave);

        return () => {
            window.removeEventListener('mousemove', handleMouseMove);
            document.documentElement.removeEventListener('mouseleave', handleMouseLeave);
        };
    }, []);

    const hasText = !!text;
    const scale = hasText ? 1.2 : (isHovering ? 0.5 : 0);

    return (
        <div className="custom-cursor-container pointer-events-none fixed inset-0 z-[9999] hidden md:block">
            <div 
                className="absolute w-8 h-8 rounded-full bg-white flex items-center justify-center transition-transform duration-200 ease-out"
                style={{ 
                    top: `${position.y}px`, 
                    left: `${position.x}px`, 
                    transform: `translate(-50%, -50%) scale(${scale})`,
                    willChange: 'transform' 
                }}
            >
              {hasText && <span className="text-[7px] font-bold text-base-dark tracking-widest uppercase">{text}</span>}
            </div>
            <div 
                className={`absolute w-2 h-2 rounded-full bg-brand-primary transition-transform duration-200 ease-out`} 
                style={{ 
                    left: `${position.x}px`, 
                    top: `${position.y}px`, 
                    transform: `translate(-50%, -50%) scale(${isHovering || hasText ? 0 : 1})`, 
                    willChange: 'transform' 
                }} 
            />
        </div>
    );
};

// --- Inlined from hooks/useRouter.ts ---
const useRouter = () => {
  const setHoverState = useContext(CursorHoverDispatchContext);
  const [path, setPath] = useState(window.location.hash || '#/');

  useEffect(() => {
    const onHashChange = () => {
      setPath(window.location.hash || '#/');
      window.scrollTo(0, 0);
      // Reset cursor state on navigation to prevent leaks
      if (setHoverState) {
        setHoverState({ isHovering: false, text: undefined });
      }
    };
    window.addEventListener('hashchange', onHashChange);
    window.scrollTo(0, 0);
    return () => window.removeEventListener('hashchange', onHashChange);
  }, [setHoverState]);

  return { path };
};


// --- Inlined from context/ContentContext.tsx ---
const ContentContext = createContext(undefined);
const useContent = () => {
  const context = useContext(ContentContext);
  if (!context) throw new Error('useContent must be used within a ContentProvider');
  return context;
};
const ContentProvider = ({ children }) => {
  const [heroProjects, setHeroProjects] = useState(HERO_PROJECTS);
  const [aboutMe, setAboutMe] = useState(ABOUT_ME);
  const [clientLogos, setClientLogos] = useState(CLIENT_LOGOS);
  const [brandLogos, setBrandLogos] = useState(BRAND_LOGOS);
  const [isFirebaseActive, setIsFirebaseActive] = useState(false);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  
  const toImageObject = (data, defaultAlt = '') => {
    if (typeof data === 'string') return { url: data, alt: defaultAlt };
    if (typeof data === 'object' && data !== null && data.url) return { url: data.url, alt: data.alt || defaultAlt };
    return { url: '', alt: '' };
  };
  
  const toImageArray = (data) => {
      if (!Array.isArray(data)) return [];
      return data.map((item, index) => toImageObject(item, `Image ${index + 1}`));
  };

  const toSocialLinkArray = (data) => {
    if (!Array.isArray(data)) return [];
    return data.map(item => ({
        iconUrl: item.iconUrl || '',
        linkUrl: item.linkUrl || '',
    }));
  };

  const mergeAboutMeData = (partialData) => {
    let travelLog = partialData.travelLog;
    if (Array.isArray(travelLog) && travelLog.length > 0 && typeof travelLog[0] === 'string') {
        travelLog = travelLog.map(text => ({ text, completed: false }));
    }
    
    // Legacy image data migration
    if (partialData.headerIconUrl) {
      partialData.headerIcon = toImageObject(partialData.headerIconUrl, 'Site Icon');
      delete partialData.headerIconUrl;
    }
    if (partialData.heroImage) partialData.heroImage = toImageObject(partialData.heroImage, 'Portrait of David Gaines');
    if (partialData.panoramaImage) {
        partialData.panorama = toImageObject(partialData.panoramaImage, 'Inspiring panoramic landscape');
        delete partialData.panoramaImage;
    }
    if (partialData.inspirationGrid) partialData.inspirationGrid = toImageArray(partialData.inspirationGrid);
    
    // Legacy linkedInUrl migration
    if (partialData.linkedInUrl && (!partialData.socialLinks || partialData.socialLinks.length === 0)) {
        partialData.socialLinks = [{ iconUrl: 'linkedin', linkUrl: partialData.linkedInUrl }];
        delete partialData.linkedInUrl;
    }
    
    // Legacy color name migration
    if (partialData.brandPrimary) { partialData.accentColor = partialData.brandPrimary; delete partialData.brandPrimary; }
    if (partialData.brandSecondary) { partialData.accentSecondaryColor = partialData.brandSecondary; delete partialData.brandSecondary; }
    if (partialData.headerBgColor) { partialData.headerBackgroundColor = partialData.headerBgColor; delete partialData.headerBgColor; }
    if (partialData.heroBgColor) { partialData.heroBackgroundColor = partialData.heroBgColor; delete partialData.heroBgColor; }
    if (partialData.textPrimaryColor) { partialData.heroTextColor = partialData.textPrimaryColor; delete partialData.textPrimaryColor; }
    if (partialData.bgLightColor) { partialData.pageBackgroundColor = partialData.bgLightColor; delete partialData.bgLightColor; }
    if (partialData.useSingleColorLogos !== undefined) { partialData.useMonochromeLogos = partialData.useSingleColorLogos; delete partialData.useSingleColorLogos; }
    if (partialData.logoSingleColor) { delete partialData.logoSingleColor; }


    return {
      ...ABOUT_ME,
      ...partialData,
      headerIcon: toImageObject(partialData.headerIcon || ABOUT_ME.headerIcon, 'Site Icon'),
      heroImage: toImageObject(partialData.heroImage || ABOUT_ME.heroImage, 'Portrait of David Gaines'),
      panorama: toImageObject(partialData.panorama || ABOUT_ME.panorama, 'Inspiring panoramic landscape'),
      inspirationGrid: toImageArray(partialData.inspirationGrid || ABOUT_ME.inspirationGrid),
      philosophy: Array.isArray(partialData.philosophy) ? partialData.philosophy : ABOUT_ME.philosophy,
      obsessions: Array.isArray(partialData.obsessions) ? partialData.obsessions : ABOUT_ME.obsessions,
      travelLog: Array.isArray(travelLog) && travelLog.every(i => typeof i === 'object') ? travelLog : ABOUT_ME.travelLog,
      quotes: Array.isArray(partialData.quotes) ? partialData.quotes : ABOUT_ME.quotes,
      favorites: (typeof partialData.favorites === 'object' && partialData.favorites !== null) ? { ...ABOUT_ME.favorites, ...partialData.favorites } : ABOUT_ME.favorites,
      pageHeadings: (typeof partialData.pageHeadings === 'object' && partialData.pageHeadings !== null) ? { ...ABOUT_ME.pageHeadings, ...partialData.pageHeadings } : ABOUT_ME.pageHeadings,
      socialLinks: toSocialLinkArray(partialData.socialLinks || ABOUT_ME.socialLinks),
      useMonochromeLogos: typeof partialData.useMonochromeLogos === 'boolean' ? partialData.useMonochromeLogos : ABOUT_ME.useMonochromeLogos,
    };
  };
  
  const mergeHeroProjectsData = (projectsData) => {
    if (!Array.isArray(projectsData)) return HERO_PROJECTS;
    return projectsData.map(p => {
        const defaultProject = HERO_PROJECTS.find(dp => dp.id === p.id) || {};
        
        // Ensure contentBlocks and their inner images are properly formatted
        const contentBlocks = Array.isArray(p.contentBlocks) ? p.contentBlocks.map(block => {
            if (!block.data) return block;
            const newBlockData = { ...block.data };
            if (newBlockData.image) newBlockData.image = toImageObject(newBlockData.image);
            if (newBlockData.images) newBlockData.images = toImageArray(newBlockData.images);
            return { ...block, data: newBlockData };
        }) : defaultProject.contentBlocks;
        
        return {
            ...defaultProject,
            ...p,
            heroImage: toImageObject(p.heroImage, `${p.title} hero image`),
            homePageImage: p.homePageImage ? toImageObject(p.homePageImage, `${p.homePageTitle || p.title} homepage image`) : null,
            contentBlocks,
        }
    })
  }


  useEffect(() => {
    try {
      const storedProjects = localStorage.getItem('heroProjects');
      if (storedProjects) { const parsed = JSON.parse(storedProjects); if (Array.isArray(parsed)) setHeroProjects(mergeHeroProjectsData(parsed)); }
      const storedAboutMe = localStorage.getItem('aboutMe');
      if (storedAboutMe) { const parsed = JSON.parse(storedAboutMe); if (typeof parsed === 'object' && parsed !== null) setAboutMe(mergeAboutMeData(parsed)); }
      const storedClientLogos = localStorage.getItem('clientLogos');
      if (storedClientLogos) { const parsed = JSON.parse(storedClientLogos); if (Array.isArray(parsed)) setClientLogos(parsed); }
      const storedBrandLogos = localStorage.getItem('brandLogos');
      if (storedBrandLogos) { const parsed = JSON.parse(storedBrandLogos); if (Array.isArray(parsed)) setBrandLogos(parsed); }
    } catch (error) {
      console.error("Failed to parse localStorage data.", error);
      localStorage.clear();
    }

    if (auth) onAuthStateChanged(auth, (user) => setIsAuthenticated(!!user));

    if (db) {
      setIsFirebaseActive(true);
      const unsubProjects = onSnapshot(doc(db, 'content', 'heroProjects'), (doc) => {
        const data = doc.data()?.data;
        if (doc.exists() && Array.isArray(data)) setHeroProjects(mergeHeroProjectsData(data));
      });
      const unsubAbout = onSnapshot(doc(db, 'content', 'aboutMe'), (doc) => {
        const data = doc.data()?.data;
        if (doc.exists() && typeof data === 'object' && data !== null) setAboutMe(mergeAboutMeData(data));
      });
      const unsubLogos = onSnapshot(doc(db, 'content', 'logos'), (doc) => {
        if (doc.exists()) {
          const data = doc.data();
          if (Array.isArray(data.clientLogos)) setClientLogos(data.clientLogos);
          if (Array.isArray(data.brandLogos)) setBrandLogos(data.brandLogos);
        }
      });
      return () => { unsubProjects(); unsubAbout(); unsubLogos(); };
    }
  }, []);
  
  useEffect(() => {
    document.documentElement.style.setProperty('--accent-color', aboutMe.accentColor || '#0891b2');
    document.documentElement.style.setProperty('--accent-secondary-color', aboutMe.accentSecondaryColor || '#f0f9ff');
    document.documentElement.style.setProperty('--hero-background-color', aboutMe.heroBackgroundColor || '#0f172a');
    document.documentElement.style.setProperty('--hero-text-color', aboutMe.heroTextColor || '#f8fafc');
    document.documentElement.style.setProperty('--page-background-color', aboutMe.pageBackgroundColor || '#ffffff');
    document.documentElement.style.setProperty('--body-headings-color', aboutMe.bodyHeadingsColor || '#1e293b');
    document.documentElement.style.setProperty('--body-text-color', aboutMe.bodyTextColor || '#475569');
    document.documentElement.style.setProperty('--project-tag-bg-color', aboutMe.projectTagBackgroundColor || '#1e293b');
    document.documentElement.style.setProperty('--project-tag-text-color', aboutMe.pageBackgroundColor || '#ffffff');

    const setMetaTag = (attr, key, value) => {
        let element = document.querySelector(`meta[${attr}='${key}']`);
        if (!element) {
            element = document.createElement('meta');
            element.setAttribute(attr, key);
            document.head.appendChild(element);
        }
        element.setAttribute('content', value || '');
    };

    document.title = aboutMe.seoTitle || 'David Gaines | Creative Director Portfolio';
    setMetaTag('name', 'description', aboutMe.seoDescription);
    
    // --- OG & Twitter Tags ---
    const pageUrl = window.location.origin;
    const ogImage = aboutMe.heroImage?.url || '';
    
    setMetaTag('property', 'og:title', aboutMe.seoTitle);
    setMetaTag('property', 'og:description', aboutMe.seoDescription);
    setMetaTag('property', 'og:type', 'website');
    setMetaTag('property', 'og:url', pageUrl);
    setMetaTag('property', 'og:image', ogImage);
    
    setMetaTag('name', 'twitter:card', 'summary_large_image');
    setMetaTag('name', 'twitter:title', aboutMe.seoTitle);
    setMetaTag('name', 'twitter:description', aboutMe.seoDescription);
    setMetaTag('name', 'twitter:image', ogImage);

    const hexToRgb = (hex) => {
        let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;
    };
    const headerRgb = hexToRgb(aboutMe.headerBackgroundColor || '#0f172a');
    if (headerRgb) {
        document.documentElement.style.setProperty('--header-bg-color-rgb', `${headerRgb.r}, ${headerRgb.g}, ${headerRgb.b}`);
    }

  }, [aboutMe]);

  const persist = async (key, data, firestoreCollection = 'content') => {
    localStorage.setItem(key, JSON.stringify(data));
    if (db && isAuthenticated) {
      try {
        await setDoc(doc(db, firestoreCollection, key), { data });
      } catch (e) {
        console.error("Error saving to Firebase", e);
      }
    }
  };

  const updateAboutMe = (data) => { setAboutMe(data); persist('aboutMe', data); };
  const updateHeroProjects = (projects) => { setHeroProjects(projects); persist('heroProjects', projects); };
  
  const updateLogos = (newClientLogos, newBrandLogos) => {
    setClientLogos(newClientLogos);
    setBrandLogos(newBrandLogos);
    
    localStorage.setItem('clientLogos', JSON.stringify(newClientLogos));
    localStorage.setItem('brandLogos', JSON.stringify(newBrandLogos));

    if (db && isAuthenticated) {
        const docRef = doc(db, 'content', 'logos');
        setDoc(docRef, { clientLogos: newClientLogos, brandLogos: newBrandLogos })
            .catch(e => console.error("Error saving logos to Firebase", e));
    }
  };

  const resetToDefaults = () => {
    if (confirm('Are you sure? This will replace ALL content with the latest template. If you are logged in, this change will be saved to the server and overwrite any customizations.')) {
      // Use the existing update functions which handle state, localStorage, and Firebase persistence
      updateHeroProjects(HERO_PROJECTS);
      updateAboutMe(ABOUT_ME);
      updateLogos(CLIENT_LOGOS, BRAND_LOGOS);
      alert("Content has been reset to the default template. Your changes have been saved.");
    }
  };

  return (
    <ContentContext.Provider value={{ heroProjects, aboutMe, clientLogos, brandLogos, updateAboutMe, updateHeroProjects, updateLogos, resetToDefaults, isFirebaseActive }}>
      {children}
    </ContentContext.Provider>
  );
};

// --- Inlined Components ---
const ArrowUpRightIcon = ({ className = "h-6 w-6" }) => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}><path strokeLinecap="round" strokeLinejoin="round" d="M4.5 19.5 19.5 4.5M19.5 4.5v15M19.5 4.5h-15" /></svg>);
const LinkedInIcon = ({ className = "h-6 w-6" }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.25 6.5 1.75 1.75 0 016.5 8.25zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93-.98 0-1.62.67-1.62 1.93V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.38 1.02 3.38 3.54z"></path></svg>);

const Header = () => {
  const setHoverState = useContext(CursorHoverDispatchContext);
  const { path } = useRouter();
  const { aboutMe } = useContent();
  const [isContactOpen, setIsContactOpen] = useState(false);
  const [isMobileContactOpen, setIsMobileContactOpen] = useState(false);
  const contactTimeoutRef = useRef(null);

  const mobileDropdownRef = useRef(null);
  const mobileContactButtonRef = useRef(null);

  // Effect to handle clicking outside the mobile contact dropdown
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (
        isMobileContactOpen &&
        mobileDropdownRef.current && !mobileDropdownRef.current.contains(event.target) &&
        (!mobileContactButtonRef.current || !mobileContactButtonRef.current.contains(event.target))
      ) {
        setIsMobileContactOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [isMobileContactOpen]);

  const handleContactEnter = () => {
    if (contactTimeoutRef.current) {
      clearTimeout(contactTimeoutRef.current);
    }
    setIsContactOpen(true);
  };

  const handleContactLeave = () => {
    contactTimeoutRef.current = setTimeout(() => {
      setIsContactOpen(false);
    }, 150);
  };

  const handleHomeClick = (e) => { e.preventDefault(); window.location.hash = '#/'; };
  const handleAboutClick = (e) => { e.preventDefault(); window.location.hash = '#/about'; };

  return (
    <header className="sticky top-0 z-50 header-with-blur">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 relative">
        <nav>
            <div className="flex items-center justify-between h-16">
              <div className="flex-shrink-0">
                <a 
                  href="#/" 
                  onClick={handleHomeClick} 
                  className="flex items-center text-sm font-medium uppercase tracking-wider transition-all duration-300 hover:scale-105 text-text-secondary hover:text-text-primary"
                  onMouseEnter={() => setHoverState({ isHovering: true })} 
                  onMouseLeave={() => setHoverState({ isHovering: false })}
                >
                  {aboutMe.headerIcon?.url && <img src={aboutMe.headerIcon.url} alt={aboutMe.headerIcon.alt} className="h-6 mr-3" />}
                  <span className={`${path === '#/' || path === '' ? 'text-brand-primary' : ''}`}>{aboutMe.logoText}</span>
                </a>
              </div>
              <div className="hidden md:block">
                <div className="ml-10 flex items-baseline space-x-4">
                  <a href="#/" onClick={handleHomeClick} className={`relative px-3 py-2 text-sm font-medium transition-colors uppercase tracking-wider ${path === '#/' || path === '' ? 'text-brand-primary' : 'text-text-secondary hover:text-text-primary'}`} onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })}>Home{(path === '#/' || path === '') && (<span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-0.5 bg-brand-primary rounded-full"></span>)}</a>
                  <a href="#/about" onClick={handleAboutClick} className={`relative px-3 py-2 text-sm font-medium transition-colors uppercase tracking-wider ${path === '#/about' ? 'text-brand-primary' : 'text-text-secondary hover:text-text-primary'}`} onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })}>About{path === '#/about' && (<span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-0.5 bg-brand-primary rounded-full"></span>)}</a>
                  
                  <div 
                    className="relative"
                    onMouseEnter={handleContactEnter}
                    onMouseLeave={handleContactLeave}
                  >
                    <div 
                      className={`relative px-3 py-2 text-sm font-medium transition-colors uppercase tracking-wider cursor-pointer ${isContactOpen ? 'text-brand-primary' : 'text-text-secondary hover:text-text-primary'}`}
                      onMouseEnter={() => setHoverState({ isHovering: true })}
                      onMouseLeave={() => setHoverState({ isHovering: false })}
                    >
                      Contact
                      {isContactOpen && (<span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-0.5 bg-brand-primary rounded-full"></span>)}
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </nav>
        <div
          onMouseEnter={handleContactEnter}
          onMouseLeave={handleContactLeave}
          style={{ backgroundColor: aboutMe.accentColor }}
          className={`absolute top-0 right-4 w-56 transition-transform duration-300 ease-out z-40 shadow-lg rounded-b-lg
            ${isContactOpen ? 'translate-y-0' : '-translate-y-full'}`
          }
        >
          <div className="pt-20 pb-6 px-6 text-right space-y-2">
            <a href={`mailto:${aboutMe.email}`} className="block text-sm text-brand-secondary hover:text-white transition-colors" role="menuitem" onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })}>
              {aboutMe.email}
            </a>
            <a href={`tel:${aboutMe.phone.replace(/[^0-9+]/g, '')}`} className="block text-sm text-brand-secondary hover:text-white transition-colors" role="menuitem" onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })}>
              {aboutMe.phone}
            </a>
          </div>
        </div>
      </div>
      
      {isMobileContactOpen && (
        <div ref={mobileDropdownRef} className="md:hidden absolute w-full bg-base-dark/95 backdrop-blur-md shadow-lg border-b border-base-light animate-fade-in-up" style={{ animationDuration: '300ms' }}>
          <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div className="flex flex-col items-center justify-center gap-4">
              <a href={`mailto:${aboutMe.email}`} className="text-white hover:text-brand-secondary transition-colors text-sm font-medium uppercase tracking-wider">{aboutMe.email}</a>
              <a href={`tel:${aboutMe.phone.replace(/[^0-9+]/g, '')}`} className="text-text-secondary hover:text-white transition-colors text-sm font-medium uppercase tracking-wider">{aboutMe.phone}</a>
            </div>
          </div>
        </div>
      )}

      <div className="md:hidden bg-base-dark/95 backdrop-blur-md border-t border-base-light">
        <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex justify-center items-center">
          <div className="flex gap-4">
            <a href="#/" onClick={handleHomeClick} className={`relative px-3 py-2 text-sm font-medium uppercase tracking-wider ${path === '#/' || path === '' ? 'text-brand-primary' : 'text-text-secondary'}`}>Home</a>
            <a href="#/about" onClick={handleAboutClick} className={`relative px-3 py-2 text-sm font-medium uppercase tracking-wider ${path === '#/about' ? 'text-brand-primary' : 'text-text-secondary'}`}>About</a>
            <button ref={mobileContactButtonRef} onClick={() => setIsMobileContactOpen(prev => !prev)} className={`relative px-3 py-2 text-sm font-medium uppercase tracking-wider ${isMobileContactOpen ? 'text-brand-primary' : 'text-text-secondary'}`} aria-expanded={isMobileContactOpen}>Contact</button>
          </div>
        </div>
      </div>
    </header>
  );
};


const SectionHeader = ({ title, subtitle, titleClassName = 'text-text-primary' }) => (
  <div className="text-center mb-12 md:mb-16">
    {subtitle && <h2 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-2">{subtitle}</h2>}
    <p className={`text-3xl md:text-4xl font-bold tracking-tight ${titleClassName}`}>{title}</p>
  </div>
);

const HeroSection = () => {
  const { aboutMe } = useContent();
  return (
    <section className="relative py-12 md:py-16 text-center" style={{ backgroundColor: aboutMe.heroBackgroundColor }}>
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <h1 className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black text-text-primary tracking-tighter uppercase">{aboutMe.name}</h1>
        <p className="mt-4 text-lg sm:text-xl md:text-2xl text-brand-primary font-semibold">{aboutMe.title}</p>
        <p className="mt-6 max-w-2xl mx-auto text-base sm:text-lg text-text-secondary leading-relaxed">{aboutMe.heroIntro}</p>
      </div>
    </section>
  );
};

const PartnersSection = () => {
  const { clientLogos, brandLogos } = useContent();
  const Marquee = ({ logos, direction }) => {
    const { aboutMe } = useContent();
    if (!logos || logos.length === 0) return null;
    const allLogos = [...logos, ...logos]; 
    const animationClass = direction === 'left' ? 'animate-infinite-scroll-left' : 'animate-infinite-scroll-right';
    return (
      <div className="w-full inline-flex flex-nowrap overflow-hidden [mask-image:_linear_gradient(to_right,transparent_0,_black_128px,_black_calc(100%-128px),transparent_100%)]">
        <ul className={`flex items-center justify-center md:justify-start [&_img]:max-w-none ${animationClass}`}>
          {allLogos.map((logo, index) => (
            <li key={index} className={`flex-shrink-0 w-48 h-16 flex justify-center items-center px-4`} aria-hidden={true}>
              <img 
                src={logo} 
                alt="" 
                className="max-w-full max-h-full object-contain hover:scale-110 transition-all duration-300"
                style={aboutMe.useMonochromeLogos ? {
                    filter: 'grayscale(100%) contrast(0%) brightness(70%)',
                    opacity: 0.7,
                } : {}}
              />
            </li>
          ))}
        </ul>
      </div>
    );
  };
  return (
    <section className="pt-6 pb-12" style={{ backgroundColor: 'var(--page-background-color)' }}>
      <div className="flex flex-col items-center w-full">
        <h3 className="text-center text-xs font-bold text-body-text tracking-[0.25em] uppercase mb-6">CLIENTS</h3>
        <div className="w-full flex flex-col gap-3 mb-6">
           <Marquee logos={clientLogos} direction="left" />
           <Marquee logos={brandLogos} direction="right" />
        </div>
        <h3 className="text-center text-xs font-bold text-body-text tracking-[0.25em] uppercase">BRANDS</h3>
      </div>
    </section>
  );
};

const WorkOverviewSection = () => {
  const { heroProjects } = useContent();
  const allProjects = heroProjects.map(p => ({ 
      id: p.id, 
      title: p.homePageTitle || p.title, 
      description: p.homePageSubtitle || p.subtitle, 
      image: p.homePageImage || p.heroImage 
  })).filter(p => p.image);
  
  const WorkCard = ({ project, index }) => {
    const setHoverState = useContext(CursorHoverDispatchContext);
    const handleNavigation = (e) => { e.preventDefault(); window.location.hash = `#/project/${project.id}`; };
    
    const cardContent = (
      <>
        {project.image.url ? 
          <img src={project.image.url} alt={project.image.alt} className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" /> :
          <div className="w-full h-full bg-base-light"></div>
        }
        <div className="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent" />
        <div className="absolute bottom-0 left-0 p-4 md:p-6">
          <h3 className="text-lg md:text-xl font-bold text-text-primary">{project.title}</h3>
          <p className="text-text-secondary text-xs md:text-sm mt-1 max-w-sm">{project.description}</p>
        </div>
      </>
    );

    return (
      <a 
        href={`#/project/${project.id}`} 
        onClick={handleNavigation} 
        className="group block relative overflow-hidden rounded-lg bg-base-medium shadow-lg aspect-[4/3] sm:aspect-[16/9] opacity-0 animate-fade-in-up" 
        style={{ animationDelay: `${index * 100}ms` }} 
        onMouseEnter={() => setHoverState({ isHovering: true })} 
        onMouseLeave={() => setHoverState({ isHovering: false })}
      >
        {cardContent}
      </a>
    );
  };

  return (
    <section className="pt-16 pb-6" style={{ backgroundColor: 'var(--page-background-color)' }}>
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex flex-wrap justify-center -m-4">
          {allProjects.map((project, index) => (
            <div key={project.id} className="w-full md:w-1/2 lg:w-1/3 p-4">
              <WorkCard project={project} index={index} />
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

const HomePage = () => (
  <>
    <HeroSection />
    <WorkOverviewSection />
    <PartnersSection />
  </>
);

const AboutPage = () => {
  const { aboutMe } = useContent();
  const topRowImages = aboutMe.inspirationGrid ? aboutMe.inspirationGrid.slice(0, 3) : [];
  const bottomRowImages = aboutMe.inspirationGrid ? aboutMe.inspirationGrid.slice(3, 6) : [];
  const allInspirationImages = [...topRowImages, ...(aboutMe.panorama?.url ? [aboutMe.panorama] : []), ...bottomRowImages];

  return (
    <div className="text-body-text animate-fade-in-up pb-12" style={{ backgroundColor: 'var(--page-background-color)' }}>
      <section className="bg-base-dark py-12 md:py-16 overflow-hidden text-text-primary"><div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
          <h1 className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black tracking-tighter uppercase mb-8" dangerouslySetInnerHTML={{ __html: aboutMe.pageHeadings.aboutTitle }}></h1>
          <p className="text-base sm:text-lg text-text-secondary max-w-2xl leading-relaxed" dangerouslySetInnerHTML={{ __html: aboutMe.introStatement }}></p>
      </div></section>
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-5xl">
        <section className="py-12"><div className="flex flex-col md:flex-row gap-12 items-start">
              <div className="md:w-1/3 md:sticky top-24"><h2 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-4">My Philosophy</h2><p className="text-2xl sm:text-3xl md:text-4xl font-bold text-body-headings leading-tight tracking-tight" dangerouslySetInnerHTML={{ __html: aboutMe.pageHeadings.philosophySubtitle }}></p></div>
              <div className="md:w-2/3 grid gap-12">{aboutMe.philosophy.map((item, idx) => (<div key={idx}><h3 className="text-xl md:text-2xl font-bold mb-3 text-body-headings">{item.title}</h3><p className="text-base leading-relaxed" dangerouslySetInnerHTML={{ __html: item.text }}></p></div>))}</div>
        </div></section>
        <hr className="border-body-headings/10" />
        <section className="py-12">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-16">
                <div><h3 className="text-xl md:text-2xl font-bold text-body-headings mb-6">{aboutMe.pageHeadings.obsessionsTitle}</h3><ul className="grid grid-cols-1 sm:grid-cols-2 gap-4 list-none">{aboutMe.obsessions.map((item, i) => (<li key={i} className="text-base">{item}</li>))}</ul></div>
                <div><h3 className="text-xl md:text-2xl font-bold text-body-headings mb-6">{aboutMe.pageHeadings.bucketListTitle}</h3>
                    <ul className="grid grid-cols-2 gap-x-8 gap-y-3">
                        {(aboutMe.travelLog || []).map((item, i) => (
                            <li key={i} className="flex items-center text-base">
                                <span className={`w-5 h-5 border-2 ${item.completed ? 'bg-brand-primary border-brand-primary' : 'border-body-headings/20'} rounded-sm flex items-center justify-center mr-3 flex-shrink-0`}>
                                    {item.completed && <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7" /></svg>}
                                </span>
                                <span className={item.completed ? 'line-through text-body-text/50' : ''}>{item.text}</span>
                            </li>
                        ))}
                    </ul>
                </div>
            </div>
            <div className="mt-16"><h3 className="text-xl md:text-2xl font-bold text-body-headings mb-8">{aboutMe.pageHeadings.mediaDietTitle}</h3><div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-8">
                <div><h4 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-4">{aboutMe.pageHeadings.mediaDietMovies}</h4><ul className="space-y-2 text-base">{aboutMe.favorites.movies.map((item, i) => <li key={i}>{item}</li>)}</ul></div>
                <div><h4 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-4">{aboutMe.pageHeadings.mediaDietShows}</h4><ul className="space-y-2 text-base">{aboutMe.favorites.shows.map((item, i) => <li key={i}>{item}</li>)}</ul></div>
                <div><h4 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-4">{aboutMe.pageHeadings.mediaDietPodcasts}</h4><ul className="space-y-2 text-base">{aboutMe.favorites.podcasts.map((item, i) => <li key={i}>{item}</li>)}</ul></div>
                <div><h4 className="text-sm font-bold text-brand-primary uppercase tracking-widest mb-4">{aboutMe.pageHeadings.mediaDietAudiobooks}</h4><ul className="space-y-2 text-base">{aboutMe.favorites.audiobooks.map((item, i) => <li key={i}>{item}</li>)}</ul></div>
            </div></div>
        </section>
      </div>
      <section className="py-12">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl space-y-6">
          <div className="hidden md:grid grid-cols-1 md:grid-cols-3 gap-6">{topRowImages.map((img, index) => (<div key={`top-${index}`} className="aspect-video relative rounded-lg overflow-hidden shadow-sm bg-body-headings/5">{img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 w-full h-full bg-base-light"></div>}</div>))}</div>
          {aboutMe.panorama?.url && <div className="hidden md:block w-full aspect-video md:aspect-[16/3] overflow-hidden rounded-lg shadow-lg relative">{aboutMe.panorama.url ? <img src={aboutMe.panorama.url} alt={aboutMe.panorama.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 w-full h-full bg-base-light"></div>}</div>}
          <div className="hidden md:grid grid-cols-1 md:grid-cols-3 gap-6">{bottomRowImages.map((img, index) => (<div key={`bottom-${index}`} className="aspect-video relative rounded-lg overflow-hidden shadow-sm bg-body-headings/5">{img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 w-full h-full bg-base-light"></div>}</div>))}</div>
          <div className="md:hidden">
            <ProjectImageCarousel images={allInspirationImages} />
          </div>
        </div>
      </section>
    </div>
  );
};

// --- Inlined from components/pages/CaseStudyDetailPage.tsx ---
const ChevronIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>);
const ProjectNavigation = ({ currentProjectId, projects }) => {
  const currentIndex = projects.findIndex(p => p.id === currentProjectId);
  if (currentIndex === -1 || projects.length <= 1) return null;
  const prevProject = projects[(currentIndex - 1 + projects.length) % projects.length];
  const nextProject = projects[(currentIndex + 1) % projects.length];
  const handlePrev = (e) => { e.preventDefault(); window.location.hash = `#/project/${prevProject.id}`; };
  const handleNext = (e) => { e.preventDefault(); window.location.hash = `#/project/${nextProject.id}`; };
  const buttonClass = "absolute top-1/2 -translate-y-1/2 flex items-center justify-center w-12 h-24 md:w-16 md:h-32 bg-white/20 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-all duration-300 text-body-headings hover:bg-white/80 hover:scale-105 z-30";
  return (<><a href={`#/project/${prevProject.id}`} onClick={handlePrev} className={`${buttonClass} left-0 rounded-r-lg`} aria-label={`Previous project: ${prevProject.title}`}><ChevronIcon className="w-6 h-6 transform rotate-180" /></a><a href={`#/project/${nextProject.id}`} onClick={handleNext} className={`${buttonClass} right-0 rounded-l-lg`} aria-label={`Next project: ${nextProject.title}`}><ChevronIcon className="w-6 h-6" /></a></>);
};
const ProjectImageCarousel = ({ images }) => {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const setHoverState = useContext(CursorHoverDispatchContext);
  useEffect(() => {
    if (images.length <= 1 || isPaused) return;
    const timer = setInterval(() => { setCurrentIndex((prevIndex) => (prevIndex + 1) % images.length); }, 4000);
    return () => clearInterval(timer);
  }, [images.length, isPaused]);
  if (!images || images.length === 0) return null;
  return (
    <div className="relative w-full aspect-[16/9] overflow-hidden rounded-lg shadow-xl group" onMouseEnter={() => setIsPaused(true)} onMouseLeave={() => setIsPaused(false)}>
      {images.map((image, index) => (
        image.url ? 
        <img key={index} src={image.url} alt={image.alt} className={`absolute top-0 left-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out ${index === currentIndex ? 'opacity-100' : 'opacity-0'}`} /> :
        <div key={index} className={`absolute top-0 left-0 w-full h-full bg-base-light transition-opacity duration-1000 ease-in-out ${index === currentIndex ? 'opacity-100' : 'opacity-0'}`}></div>
     ))}
      {images.length > 1 && (<div className="absolute bottom-6 right-6 z-20 flex gap-3">{images.map((_, index) => (<button key={index} onClick={() => setCurrentIndex(index)} onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })} className={`w-3 h-3 rounded-full border border-white transition-all duration-300 ${index === currentIndex ? 'bg-white scale-125' : 'bg-transparent hover:bg-white/50'}`} aria-label={`Go to slide ${index + 1}`} />))}</div>)}
    </div>
  );
};
const ProjectTags = ({ tags }) => {
  if (!tags) return null;
  const tagList = Array.isArray(tags) ? tags : String(tags).split(/, ?/);
  return (<div className="mt-6 flex justify-center gap-2 flex-wrap">{tagList.map(tag => (<span key={tag} className="inline-block bg-tag-bg text-tag-text text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-sm">{tag}</span>))}</div>);
};

// --- Block Components ---
const HeroBlock = ({ data }) => {
  if (!data.images || data.images.length === 0) return null;
  const { images, style } = data;
  if (style === 'trio') {
    return <div className="hidden md:grid grid-cols-3 gap-4 md:gap-8">{images.slice(0,3).map((img, i) => (<div key={i} className="relative overflow-hidden rounded-lg shadow-xl aspect-[16/9] sm:aspect-[2/3]">{img.url ? <img src={img.url} alt={img.alt} className="absolute inset-0 w-full h-full object-cover" /> : <div className="absolute inset-0 w-full h-full bg-base-light" />}</div>))}</div>;
  }
  if (style === 'duo') {
    return <div className="hidden md:grid grid-cols-2 gap-4 md:gap-8 md:aspect-[16/9]">{images.slice(0,2).map((img, i) => (<div key={i} className="relative w-full aspect-[16/9] md:aspect-auto md:h-full overflow-hidden rounded-lg shadow-xl">{img.url ? <img src={img.url} alt={img.alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-base-light" />}</div>))}</div>;
  }
  return <div className="relative w-full aspect-[16/9] overflow-hidden rounded-lg shadow-xl">{images[0].url ? <img src={images[0].url} alt={images[0].alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-base-light" />}</div>;
};
const TitleBlock = ({ project }) => (
  <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-3xl mt-12 md:mt-16 text-center">
    <h1 className="text-3xl sm:text-4xl md:text-5xl font-black text-body-headings tracking-tighter uppercase whitespace-nowrap">{project.title}</h1>
    {project.client && <p className="mt-2 text-2xl md:text-4xl font-bold text-brand-primary">{project.client}</p>}
    <ProjectTags tags={project.tags} />
  </div>
);
const TextBlock = ({ data }) => {
  const isStandalone = !data.isPairedWithImage;
  const maxWidthClass = isStandalone ? 'max-w-3xl' : 'max-w-none';
  return (
    <div className={`container mx-auto px-4 sm:px-6 lg:px-8 ${maxWidthClass} my-8 md:my-10`}>
      <div className={`prose max-w-none mx-auto text-body-text ${isStandalone ? 'text-center' : ''}`}>
        {data.heading && <h2 className="text-xl md:text-2xl font-bold text-body-headings mb-2">{data.heading}</h2>}
        {data.body && <p dangerouslySetInnerHTML={{ __html: data.body }}></p>}
      </div>
    </div>
  );
};
const ImageBlock = ({ data }) => {
  const { image, size = 'full', caption } = data;
  if (!image) return null;
  const sizeClasses = {
    full: 'max-w-6xl',
    medium: 'max-w-4xl',
    small: 'max-w-xl'
  };
  return (
    <div className={`container mx-auto px-4 sm:px-6 lg:px-8 ${sizeClasses[size]} my-8 md:my-10`}>
      <figure>
        <div className="relative w-full aspect-[16/9] overflow-hidden rounded-lg shadow-xl">
          {image.url ? <img src={image.url} alt={image.alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-base-light"></div>}
        </div>
        {caption && <figcaption className="text-center text-sm text-body-text mt-3">{caption}</figcaption>}
      </figure>
    </div>
  );
};
const TextWithImagesBlock = ({ data }) => {
    const { heading, body, images, imagePosition = 'right', imageLayout, imageAspectRatio } = data;
    if (!body || !images || images.length === 0) return null;
    const textOrder = imagePosition === 'right' ? 'md:order-1' : 'md:order-2';
    const imageOrder = imagePosition === 'right' ? 'md:order-2' : 'md:order-1';

    // Backward compatibility for old `imageAspectRatio` property
    let finalLayout = imageLayout;
    if (!finalLayout) {
        switch (imageAspectRatio) {
            case 'tall': finalLayout = 'singleTall'; break;
            case 'extraTall': finalLayout = 'singleExtraTall'; break;
            case 'square': default: finalLayout = 'singleSquare'; break;
        }
    }
    
    const renderImages = () => {
        const ImageComponent = ({ img }) => (
            img.url ? 
            <img src={img.url} alt={img.alt} className="w-full h-full object-cover" /> :
            <div className="w-full h-full bg-base-light"></div>
        );

        switch (finalLayout) {
            case 'stackTwoSquare':
                return (
                    <div className="flex flex-col gap-4">
                        {images.slice(0, 2).map((img, i) => (
                            <div key={i} className="relative overflow-hidden rounded-lg shadow-md aspect-square">
                                <ImageComponent img={img} />
                            </div>
                        ))}
                    </div>
                );
            case 'stackThreeSquare':
                 return (
                    <div className="flex flex-col gap-4">
                        {images.slice(0, 3).map((img, i) => (
                            <div key={i} className="relative overflow-hidden rounded-lg shadow-md aspect-square">
                                <ImageComponent img={img} />
                            </div>
                        ))}
                    </div>
                );
            case 'singleTall':
                return (
                    <div className="relative overflow-hidden rounded-lg shadow-md aspect-[2/3]">
                        <ImageComponent img={images[0]} />
                    </div>
                );
            case 'singleExtraTall':
                return (
                    <div className="relative overflow-hidden rounded-lg shadow-md aspect-[1/2]">
                        <ImageComponent img={images[0]} />
                    </div>
                );
            case 'singleSquare':
            default:
                 return (
                    <div className="relative overflow-hidden rounded-lg shadow-md aspect-square">
                        <ImageComponent img={images[0]} />
                    </div>
                );
        }
    };

    return (
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl my-8 md:my-10">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-center">
                <div className={`prose max-w-none mx-auto text-body-text ${textOrder}`}>
                    {heading && <h2 className="text-xl md:text-2xl font-bold text-body-headings mb-2">{heading}</h2>}
                    <p dangerouslySetInnerHTML={{ __html: body }}></p>
                </div>
                <div className={`self-center ${imageOrder} w-full max-w-[20rem] mx-auto md:max-w-none md:mx-0`}>
                    {renderImages()}
                </div>
            </div>
        </div>
    );
};
const ImageGridBlock = ({ data }) => {
    if (!data.images || data.images.length === 0) return null;
    const gridClasses = {
        1: 'grid-cols-1',
        2: 'sm:grid-cols-2',
        3: 'sm:grid-cols-3',
        4: 'sm:grid-cols-2 md:grid-cols-4',
    };
    const numImages = Math.min(data.images.length, 4);
    const gridClass = gridClasses[numImages] || 'sm:grid-cols-3';

    return (
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl my-8 md:my-10">
            <div className={`grid grid-cols-1 ${gridClass} gap-4 md:gap-8`}>
                {data.images.slice(0,4).map((img, i) => (
                    <div key={i} className="overflow-hidden rounded-lg shadow-xl aspect-square">
                        {img.url ? <img src={img.url} alt={img.alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-base-light"></div>}
                    </div>
                ))}
            </div>
        </div>
    );
};
const CarouselBlock = ({ data }) => {
    if (!data.images || data.images.length === 0) return null;
    return (
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl my-8 md:my-10">
            <ProjectImageCarousel images={data.images} />
        </div>
    );
};
const ImageRowBlock = ({ data }) => {
    if (!data.images || data.images.length === 0) return null;
    const { images, style = 'threeSquare' } = data;
    
    const styleConfig = {
        singleWide: { grid: 'grid-cols-1', aspect: 'aspect-[16/9] sm:aspect-[21/9]', count: 1 },
        twoNarrow: { grid: 'grid-cols-1 sm:grid-cols-2', aspect: 'aspect-[3/4]', count: 2 },
        threeSquare: { grid: 'grid-cols-1 sm:grid-cols-3', aspect: 'aspect-square', count: 3 },
    };
    const config = styleConfig[style];

    return (
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl my-8 md:my-10">
            <div className={`grid ${config.grid} gap-4 md:gap-8`}>
                {images.slice(0, config.count).map((img, i) => (
                    <div key={i} className={`overflow-hidden rounded-lg shadow-xl ${config.aspect}`}>
                        {img.url ? <img src={img.url} alt={img.alt} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-base-light"></div>}
                    </div>
                ))}
            </div>
        </div>
    );
};
const QuoteBlock = ({ data }) => {
    if (!data.quotes || data.quotes.length === 0) return null;
    const { quotes, style = 'single' } = data;
    const isDuo = style === 'duo' && quotes.length > 1;

    return (
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl my-10 md:my-12">
            <div className={`grid gap-8 md:gap-12 ${isDuo ? 'md:grid-cols-2' : 'grid-cols-1'}`}>
                {quotes.slice(0, isDuo ? 2 : 1).map((quote, i) => (
                    <blockquote key={i} className="text-center">
                        <p className="text-2xl md:text-3xl font-medium text-body-headings leading-snug">“{quote.text}”</p>
                        {quote.author && <cite className="mt-4 block text-base text-body-text not-italic">— {quote.author}</cite>}
                    </blockquote>
                ))}
            </div>
        </div>
    );
};
const StatsBlock = ({ data }) => {
    if (!data.stats || data.stats.length === 0) return null;
    const gridCols = { 1: 'grid-cols-1', 2: 'sm:grid-cols-2', 3: 'sm:grid-cols-3' };
    const numStats = Math.min(data.stats.length, 3);

    return (
        <div className="my-8 md:my-10 bg-brand-secondary/50">
            <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl py-10 md:py-12">
                <div className={`grid ${gridCols[numStats]} gap-8 md:gap-12 text-center`}>
                    {data.stats.slice(0,3).map((stat, i) => (
                        <div key={i}>
                            <p className="text-5xl md:text-6xl font-black text-brand-primary tracking-tighter">{stat.value}</p>
                            <p className="mt-2 text-sm font-bold text-body-headings uppercase tracking-wider">{stat.label}</p>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
};

const CaseStudyDetailPage = ({ projectId }) => {
  const setHoverState = useContext(CursorHoverDispatchContext);
  const { heroProjects } = useContent();
  const [project, setProject] = useState(null);
  const [isPreview, setIsPreview] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    setIsLoading(true);
    const urlParams = new URLSearchParams(window.location.hash.split('?')[1] || '');
    const isPreviewMode = urlParams.get('preview') === 'true';
    setIsPreview(isPreviewMode);

    let projectData = null;
    if (isPreviewMode) {
      try {
        const draftData = localStorage.getItem('draft_project_preview');
        if (draftData) {
          const parsedData = JSON.parse(draftData);
          if (parsedData.id === projectId) {
            projectData = parsedData;
          }
        }
      } catch (e) {
        console.error("Failed to parse preview data from localStorage", e);
      }
    }
    
    if (!projectData) {
      projectData = heroProjects.find(p => p.id === projectId) || null;
    }

    setProject(projectData);
    setIsLoading(false);
  }, [projectId, heroProjects]);

  const handleHomeClick = (e) => { e.preventDefault(); window.location.hash = '#/'; };

  const PreviewBanner = () => (
    <div className="fixed top-0 left-0 w-full bg-yellow-400 text-yellow-900 text-center py-2 z-[100] text-sm font-bold shadow-lg">
        Preview Mode. This is not the published version. <a href="#" onClick={(e) => { e.preventDefault(); window.close(); }} className="underline hover:text-yellow-950">Close Preview</a>
    </div>
  );

  if (isLoading) {
    return <div className="text-body-text py-20 text-center" style={{ backgroundColor: 'var(--page-background-color)' }}>Loading Project...</div>;
  }

  if (!project) return (
    <div className="py-20" style={{ backgroundColor: 'var(--page-background-color)' }}><div className="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 className="text-4xl font-bold text-body-headings">Project Not Found</h1><p className="mt-4 text-body-text">Sorry, we couldn't find the project you were looking for.</p>
      <a href="#/" onClick={handleHomeClick} onMouseEnter={() => setHoverState({ isHovering: true })} onMouseLeave={() => setHoverState({ isHovering: false })} className="mt-8 inline-block bg-brand-primary text-white font-bold py-3 px-8 rounded-lg transition-transform duration-300 hover:scale-105">Back to Home</a>
    </div></div>
  );
  
  const renderBlock = (block, index) => {
    if (block.type === 'text') {
      block.data.isPairedWithImage = false;
    }

    switch (block.type) {
        case 'hero': return <header key={index} className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl mt-10 md:mt-20 relative group"><HeroBlock data={block.data} /><ProjectNavigation currentProjectId={project.id} projects={heroProjects} /></header>;
        case 'title': return <TitleBlock key={index} project={project} />;
        case 'text': return <TextBlock key={index} data={block.data} />;
        case 'image': return <ImageBlock key={index} data={block.data} />;
        case 'textWithImages': return <TextWithImagesBlock key={index} data={block.data} />;
        case 'imageGrid': return <ImageGridBlock key={index} data={block.data} />;
        case 'carousel': return <CarouselBlock key={index} data={block.data} />;
        case 'imageRow': return <ImageRowBlock key={index} data={block.data} />;
        case 'quote': return <QuoteBlock key={index} data={block.data} />;
        case 'stats': return <StatsBlock key={index} data={block.data} />;
        default: return <div key={index} className="text-red-500 text-center py-4">Unknown block type: {block.type}</div>;
    }
  }

  return (
    <article className="animate-fade-in-up pb-10" style={{ backgroundColor: 'var(--page-background-color)' }}>
      {isPreview && <PreviewBanner />}
      <div className={isPreview ? 'pt-10' : ''}>
        {(project.contentBlocks && project.contentBlocks.length > 0) 
          ? project.contentBlocks.map(renderBlock)
          : <div className="text-center py-20 text-body-text">This project has no content yet.</div>
        }
      </div>
    </article>
  );
};

const AdminPage = () => {
    const { 
        aboutMe, heroProjects, clientLogos, brandLogos, 
        updateAboutMe, updateHeroProjects, updateLogos,
        resetToDefaults, isFirebaseActive 
    } = useContent();
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [error, setError] = useState('');
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState('projects');

    useEffect(() => {
        document.body.style.cursor = 'default';
        return () => { document.body.style.cursor = ''; }
    }, []);

    useEffect(() => {
        if (auth) {
            const unsubscribe = onAuthStateChanged(auth, (user) => { setIsAuthenticated(!!user); setLoading(false); });
            return () => unsubscribe();
        } else { setLoading(false); }
    }, []);

    const handleLogin = async (e) => {
        e.preventDefault(); setError('');
        if (!auth) { setError("Firebase is not configured. Cannot log in."); return; }
        try { await signInWithEmailAndPassword(auth, email, password); } catch (err) { setError(err.message); }
    };
    const handleLogout = async () => { if (auth) await signOut(auth); };

    // --- Admin UI Components ---
    const inputClasses = "appearance-none border border-base-light rounded w-full py-2 px-3 bg-base-dark text-text-primary leading-tight focus:outline-none focus:ring-2 focus:ring-brand-primary";
    const labelClasses = "block text-text-secondary text-sm font-bold mb-2";
    const buttonClasses = "bg-brand-primary hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors disabled:opacity-50";
    const AdminInput = ({ label, name, value, onChange, recommendation, ...props }) => (
        <div><label htmlFor={name} className={labelClasses}>{label}</label>{recommendation && <p className="text-xs text-text-tertiary mb-1" dangerouslySetInnerHTML={{__html: recommendation}}></p>}<input id={name} name={name} value={value} onChange={onChange} className={inputClasses} {...props} /></div>
    );
    const AdminTextarea = ({ label, name, value, onChange, rows = 3, placeholder = '', recommendation }) => (
        <div><label htmlFor={name} className={labelClasses}>{label}</label>{recommendation && <p className="text-xs text-text-tertiary mb-1" dangerouslySetInnerHTML={{__html: recommendation}}></p>}<textarea id={name} name={name} value={value} onChange={onChange} rows={rows} className={inputClasses} placeholder={placeholder} /></div>
    );
    const AdminSelect = ({ label, name, value, onChange, children }) => (
        <div><label htmlFor={name} className={labelClasses}>{label}</label><select id={name} name={name} value={value} onChange={onChange} className={inputClasses}>{children}</select></div>
    );
    const AdminSection = ({ title, children, gridCols = 'md:grid-cols-2' }) => (
        <div className="bg-base-medium p-6 rounded-lg shadow-lg mb-8"><h3 className="text-xl font-bold text-text-primary border-b border-base-light pb-3 mb-4">{title}</h3><div className={`grid grid-cols-1 ${gridCols} gap-6`}>{children}</div></div>
    );
    const AdminImageInput = ({ label, name, value, onChange, recommendation }) => (
        <div className="space-y-2">
            <AdminInput label={`${label} URL`} name={`${name}-url`} value={value?.url || ''} onChange={e => onChange({ ...value, url: e.target.value })} placeholder="https://..." recommendation={recommendation} />
            <AdminInput label={`${label} SEO Text`} name={`${name}-alt`} value={value?.alt || ''} onChange={e => onChange({ ...value, alt: e.target.value })} placeholder="SEO-friendly description for the image" />
        </div>
    );
    const AdminImageArrayInput = ({ label, value, onChange, recommendation }) => {
        const handleItemChange = (index, newValue) => { const updated = [...value]; updated[index] = newValue; onChange(updated); };
        const handleAddItem = () => onChange([...(value || []), { url: '', alt: '' }]);
        const handleRemoveItem = (index) => onChange(value.filter((_, i) => i !== index));

        return (
            <div className="md:col-span-2 space-y-4">
                <label className={labelClasses}>{label}</label>
                {recommendation && <p className="text-xs text-text-tertiary mb-2" dangerouslySetInnerHTML={{__html: recommendation}}></p>}
                {(value || []).map((item, index) => (
                    <div key={index} className="grid grid-cols-1 md:grid-cols-[1fr_1fr_auto] gap-4 items-end bg-base-dark p-4 rounded-md">
                        <AdminInput label={`URL ${index + 1}`} value={item.url} onChange={e => handleItemChange(index, { ...item, url: e.target.value })} />
                        <AdminInput label={`SEO Text ${index + 1}`} value={item.alt} onChange={e => handleItemChange(index, { ...item, alt: e.target.value })} />
                        <button onClick={() => handleRemoveItem(index)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded h-10 mb-1">X</button>
                    </div>
                ))}
                <button onClick={handleAddItem} className={buttonClasses + " mt-2 w-full md:w-auto"}>Add Image</button>
            </div>
        );
    };
    
    const TabButton = ({ label, tabName, danger = false }) => (
        <button 
            onClick={() => setActiveTab(tabName)} 
            className={`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors focus:outline-none ${
                activeTab === tabName 
                    ? (danger ? 'bg-red-900/50 text-red-400' : 'bg-base-medium text-brand-primary') 
                    : (danger ? 'text-red-500 hover:text-red-400 hover:bg-red-900/30' : 'text-text-secondary hover:text-text-primary')
            }`}
        >
            {label}
        </button>
    );

    // --- Tab Content Components ---
    const ThemeGeneralSettings = () => {
        const [data, setData] = useState(aboutMe);
        useEffect(() => setData(aboutMe), [aboutMe]);
        const handleChange = (e) => { const { name, value } = e.target; setData(prev => ({ ...prev, [name]: value })); };
        const handleSave = () => { updateAboutMe(data); alert('Settings saved!'); };

        const handleSocialLinkChange = (index, field, value) => { const updated = [...(data.socialLinks || [])]; updated[index][field] = value; setData(prev => ({ ...prev, socialLinks: updated })); };
        const addSocialLink = () => setData(p => ({...p, socialLinks: [...(p.socialLinks || []), {iconUrl: '', linkUrl: ''}]}));
        const removeSocialLink = (index) => setData(p => ({...p, socialLinks: p.socialLinks.filter((_, i) => i !== index)}));

        const ColorInput = ({ label, name }) => (
            <div>
                <label htmlFor={name} className={labelClasses}>{label}</label>
                <div className="flex items-center gap-2">
                    <div className="w-10 h-10 rounded-md border border-base-light flex-shrink-0" style={{ backgroundColor: data[name] || '#000' }}></div>
                    <input id={name} name={name} type="text" value={data[name] || ''} onChange={handleChange} className={inputClasses} />
                </div>
            </div>
        );

        return (
            <div>
                <div className="sticky top-0 bg-base-dark/80 backdrop-blur-sm z-10 py-4 mb-4 flex justify-end"><button onClick={handleSave} className={buttonClasses}>Save Settings</button></div>
                <AdminSection title="General Information">
                    <AdminInput label="Header Logo Text" name="logoText" value={data.logoText} onChange={handleChange} />
                    <AdminImageInput label="Header Icon" name="headerIcon" value={data.headerIcon} onChange={value => setData(prev => ({...prev, headerIcon: value}))} />
                    <AdminInput label="Email" name="email" value={data.email} onChange={handleChange} />
                    <AdminInput label="Phone" name="phone" value={data.phone} onChange={handleChange} />
                </AdminSection>
                 <AdminSection title="Social Media Links" gridCols="md:grid-cols-1">
                    {(data.socialLinks || []).map((item, index) => (
                      <div key={index} className="grid grid-cols-1 md:grid-cols-[1fr_1fr_auto] gap-4 items-end bg-base-dark p-4 rounded-md">
                        <AdminInput label={`Icon URL ${index + 1}`} value={item.iconUrl} onChange={e => handleSocialLinkChange(index, 'iconUrl', e.target.value)} placeholder="URL or 'linkedin'" recommendation="Use 'linkedin' for the default icon, otherwise provide a full image URL." />
                        <AdminInput label={`Link URL ${index + 1}`} value={item.linkUrl} onChange={e => handleSocialLinkChange(index, 'linkUrl', e.target.value)} placeholder="https://..." />
                        <button onClick={() => removeSocialLink(index)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded h-10 mb-1">X</button>
                      </div>
                    ))}
                    <button onClick={addSocialLink} className={buttonClasses + " mt-2 w-full md:w-auto"}>Add Social Link</button>
                 </AdminSection>
                <AdminSection title="Color Palette" gridCols="md:grid-cols-2 lg:grid-cols-4">
                  <ColorInput label="Accent / Subhead" name="accentColor" />
                  <ColorInput label="Accent Secondary" name="accentSecondaryColor" />
                  <ColorInput label="Header Background" name="headerBackgroundColor" />
                  <ColorInput label="Hero Background" name="heroBackgroundColor" />
                  <ColorInput label="Hero Text" name="heroTextColor" />
                  <ColorInput label="Page Background" name="pageBackgroundColor" />
                  <ColorInput label="Body Headings" name="bodyHeadingsColor" />
                  <ColorInput label="Body Text" name="bodyTextColor" />
                </AdminSection>
                <AdminSection title="Project Page UI">
                  <ColorInput label="Project Tag Background" name="projectTagBackgroundColor" />
                </AdminSection>
                <AdminSection title="Monochrome Logo Settings">
                    <div className="md:col-span-2 flex items-center gap-4">
                        <input 
                            type="checkbox"
                            id="useMonochromeLogos"
                            name="useMonochromeLogos"
                            checked={!!data.useMonochromeLogos}
                            onChange={e => setData(prev => ({ ...prev, useMonochromeLogos: e.target.checked }))}
                            className="h-5 w-5 rounded text-brand-primary focus:ring-brand-primary bg-base-light border-base-light"
                        />
                        <label htmlFor="useMonochromeLogos" className="text-text-secondary">Display all partner logos in grayscale</label>
                    </div>
                </AdminSection>
            </div>
        );
    };

    const HomePageSettings = () => {
        const [data, setData] = useState(aboutMe);
        useEffect(() => setData(aboutMe), [aboutMe]);
        const handleChange = (e) => { const { name, value } = e.target; setData(prev => ({ ...prev, [name]: value })); };
        const handleSave = () => { updateAboutMe(data); alert('Home page saved!'); };
        return (
            <div>
                <div className="sticky top-0 bg-base-dark/80 backdrop-blur-sm z-10 py-4 mb-4 flex justify-end"><button onClick={handleSave} className={buttonClasses}>Save Home Page</button></div>
                <AdminSection title="Hero Content" gridCols="md:grid-cols-1">
                    <AdminInput label="Name" name="name" value={data.name} onChange={handleChange} />
                    <AdminInput label="Title" name="title" value={data.title} onChange={handleChange} />
                    <AdminTextarea label="Hero Intro" name="heroIntro" value={data.heroIntro} onChange={handleChange} rows={4} />
                </AdminSection>
            </div>
        );
    };

    const AboutPageSettings = () => {
        const [data, setData] = useState(aboutMe);
        useEffect(() => setData(aboutMe), [aboutMe]);

        const handleChange = (e) => { const { name, value } = e.target; setData(prev => ({ ...prev, [name]: value })); };
        const handleListChange = (e) => { const { name, value } = e.target; setData(prev => ({ ...prev, [name]: value.split('\n').map(s => s.trim()).filter(Boolean) })); };
        const handleSave = () => { updateAboutMe(data); alert('About page saved!'); };
        
        const handlePhilosophyChange = (index, field, value) => { const updated = [...data.philosophy]; updated[index][field] = value; setData(prev => ({ ...prev, philosophy: updated })); };
        const addPhilosophy = () => setData(p => ({...p, philosophy: [...p.philosophy, {title: '', text: ''}]}));
        const removePhilosophy = (index) => setData(p => ({...p, philosophy: p.philosophy.filter((_, i) => i !== index)}));

        const handleHeadingsChange = (e) => { const { name, value } = e.target; setData(prev => ({ ...prev, pageHeadings: { ...prev.pageHeadings, [name]: value } })); };
        const handleTravelLogChange = (index, field, value) => { const updated = [...data.travelLog]; updated[index][field] = value; setData(prev => ({ ...prev, travelLog: updated })); };
        const addTravelLogItem = () => setData(p => ({...p, travelLog: [...(p.travelLog || []), {text: '', completed: false}]}));
        const removeTravelLogItem = (index) => setData(p => ({...p, travelLog: p.travelLog.filter((_, i) => i !== index)}));
        const handleFavoritesChange = (e) => {
          const { name, value } = e.target;
          setData(prev => ({ ...prev, favorites: { ...prev.favorites, [name]: value.split('\n').map(s => s.trim()).filter(Boolean) } }));
        };

        return (
            <div>
                 <div className="sticky top-0 bg-base-dark/80 backdrop-blur-sm z-10 py-4 mb-4 flex justify-end"><button onClick={handleSave} className={buttonClasses}>Save About Page</button></div>
                 <AdminSection title="Intro Content" gridCols="md:grid-cols-1">
                    <AdminTextarea label="Intro Statement (About Page)" name="introStatement" value={data.introStatement} onChange={handleChange} rows={4} recommendation="Use <b>bold text</b> for emphasis." />
                 </AdminSection>
                  <AdminSection title="Page Titles & Subtitles">
                    <AdminInput label="Main Title" name="aboutTitle" value={data.pageHeadings.aboutTitle} onChange={handleHeadingsChange} recommendation="Use <br/> for line breaks and <span> for styling." />
                    <AdminInput label="Philosophy Subtitle" name="philosophySubtitle" value={data.pageHeadings.philosophySubtitle} onChange={handleHeadingsChange} recommendation="Use <br/> for line breaks."/>
                    <AdminInput label="'Obsessed With' Title" name="obsessionsTitle" value={data.pageHeadings.obsessionsTitle} onChange={handleHeadingsChange} />
                    <AdminInput label="'Bucket List' Title" name="bucketListTitle" value={data.pageHeadings.bucketListTitle} onChange={handleHeadingsChange} />
                    <AdminInput label="'Media Diet' Title" name="mediaDietTitle" value={data.pageHeadings.mediaDietTitle} onChange={handleHeadingsChange} />
                </AdminSection>
                <AdminSection title="Media Diet Categories">
                    <AdminInput label="Movies Title" name="mediaDietMovies" value={data.pageHeadings.mediaDietMovies} onChange={handleHeadingsChange} />
                    <AdminInput label="Shows Title" name="mediaDietShows" value={data.pageHeadings.mediaDietShows} onChange={handleHeadingsChange} />
                    <AdminInput label="Podcasts Title" name="mediaDietPodcasts" value={data.pageHeadings.mediaDietPodcasts} onChange={handleHeadingsChange} />
                    <AdminInput label="Audiobooks Title" name="mediaDietAudiobooks" value={data.pageHeadings.mediaDietAudiobooks} onChange={handleHeadingsChange} />
                </AdminSection>
                 <AdminSection title="Philosophy" gridCols="md:grid-cols-1">
                    {data.philosophy.map((item, index) => (
                      <div key={index} className="grid grid-cols-1 md:grid-cols-[1fr_2fr_auto] gap-4 items-end bg-base-dark p-4 rounded-md">
                        <AdminInput label={`Title ${index + 1}`} value={item.title} onChange={e => handlePhilosophyChange(index, 'title', e.target.value)} />
                        <AdminTextarea label={`Text ${index + 1}`} value={item.text} onChange={e => handlePhilosophyChange(index, 'text', e.target.value)} rows={2} recommendation="Use <b>bold text</b> for emphasis."/>
                        <button onClick={() => removePhilosophy(index)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded h-10 mb-1">X</button>
                      </div>
                    ))}
                    <button onClick={addPhilosophy} className={buttonClasses + " mt-2 w-full md:w-auto"}>Add Philosophy Point</button>
                 </AdminSection>
                 <AdminSection title="Obsessions List">
                    <AdminTextarea label="Obsessions (one item per line)" name="obsessions" value={(data.obsessions || []).join('\n')} onChange={handleListChange} rows={6} />
                 </AdminSection>
                 <AdminSection title="Bucket List" gridCols="md:grid-cols-1">
                    {(data.travelLog || []).map((item, index) => (
                      <div key={index} className="grid grid-cols-[1fr_auto_auto] gap-4 items-center bg-base-dark p-4 rounded-md">
                        <AdminInput label={`Item ${index + 1}`} value={item.text} onChange={e => handleTravelLogChange(index, 'text', e.target.value)} />
                        <div className="flex items-center h-full pt-8">
                          <input type="checkbox" checked={!!item.completed} onChange={e => handleTravelLogChange(index, 'completed', e.target.checked)} className="h-5 w-5 rounded text-brand-primary focus:ring-brand-primary bg-base-light border-base-light" />
                          <label className="ml-2 text-text-secondary">Completed</label>
                        </div>
                        <button onClick={() => removeTravelLogItem(index)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded h-10 self-end mb-1">X</button>
                      </div>
                    ))}
                    <button onClick={addTravelLogItem} className={buttonClasses + " mt-2 w-full md:w-auto"}>Add Bucket List Item</button>
                </AdminSection>
                <AdminSection title="Media Diet Lists">
                    <AdminTextarea label="Movies (one per line)" name="movies" value={(data.favorites.movies || []).join('\n')} onChange={handleFavoritesChange} rows={4} />
                    <AdminTextarea label="Shows (one per line)" name="shows" value={(data.favorites.shows || []).join('\n')} onChange={handleFavoritesChange} rows={4} />
                    <AdminTextarea label="Podcasts (one per line)" name="podcasts" value={(data.favorites.podcasts || []).join('\n')} onChange={handleFavoritesChange} rows={4} />
                    <AdminTextarea label="Audiobooks (one per line)" name="audiobooks" value={(data.favorites.audiobooks || []).join('\n')} onChange={handleFavoritesChange} rows={4} />
                </AdminSection>
                 <AdminSection title="Inspiration Images" gridCols="md:grid-cols-1">
                    <AdminImageInput label="Panorama Image" name="panorama" value={data.panorama} onChange={v => setData(p => ({...p, panorama: v}))} recommendation="Compress images with TinyPNG or Squoosh. Recommended size: 2000x600px." />
                    <AdminImageArrayInput label="Inspiration Grid Images (6 recommended)" value={data.inspirationGrid} onChange={v => setData(p => ({...p, inspirationGrid: v}))} recommendation="Compress images with TinyPNG or Squoosh. Recommended size: 1200x800px." />
                 </AdminSection>
            </div>
        );
    };

    const ProjectEditor = () => {
        const { heroProjects, updateHeroProjects } = useContent();
        const [editingProject, setEditingProject] = useState(null);
        
        const handleAddNew = () => setEditingProject({ id: `new-project-${Date.now()}`, title: 'New Project', client: '', tags: [], heroImage: {url:'', alt:''}, homePageTitle: '', homePageSubtitle: '', homePageImage: {url:'', alt:''}, contentBlocks: [] });
        const handleEdit = (project) => setEditingProject(JSON.parse(JSON.stringify(project)));
        
        const handleDelete = (id) => {
            if (confirm('Are you sure? This action cannot be undone.')) {
                const updated = heroProjects.filter(p => p.id !== id);
                updateHeroProjects(updated);
            }
        };
        
        const handleDuplicate = (projectToDuplicate) => {
            if (confirm(`Are you sure you want to duplicate "${projectToDuplicate.title}"?`)) {
                const newProject = JSON.parse(JSON.stringify(projectToDuplicate));
                newProject.id = `copy-of-${projectToDuplicate.id.replace('copy-of-','').split('-')[0]}-${Date.now()}`;
                newProject.title = `${projectToDuplicate.title} (Copy)`;
                if (!newProject.contentBlocks) {
                    newProject.contentBlocks = [];
                }
                const updatedProjects = [...heroProjects, newProject];
                updateHeroProjects(updatedProjects);
                handleEdit(newProject);
            }
        };

        const handleSave = (projectToSave) => {
            const index = heroProjects.findIndex(p => p.id === projectToSave.id);
            let updated;
            if (index > -1) {
                updated = [...heroProjects];
                updated[index] = projectToSave;
            } else {
                updated = [...heroProjects, projectToSave];
            }
            updateHeroProjects(updated);
            setEditingProject(null);
            alert('Project saved!');
        };
        
        if (editingProject) {
            return <ProjectBuilder initialProject={editingProject} onSave={handleSave} onCancel={() => setEditingProject(null)} />;
        }

        return (
            <div>
                <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold">Manage Projects</h2>
                    <button onClick={handleAddNew} className={buttonClasses}>Add New Project</button>
                </div>
                <div className="bg-base-medium rounded-lg shadow-lg">
                    <ul className="divide-y divide-base-light">{heroProjects.map(p => (
                        <li key={p.id} className="p-4 flex justify-between items-center">
                            <div><p className="font-bold text-text-primary">{p.title}</p><p className="text-sm text-text-tertiary">{p.id}</p></div>
                            <div className="flex gap-2">
                                <button onClick={() => handleEdit(p)} className="text-sm bg-base-light hover:bg-brand-primary text-white font-bold py-1 px-3 rounded">Edit</button>
                                <button onClick={() => handleDuplicate(p)} className="text-sm bg-cyan-700 hover:bg-cyan-600 text-white font-bold py-1 px-3 rounded">Duplicate</button>
                                <button onClick={() => handleDelete(p.id)} className="text-sm bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">Delete</button>
                            </div>
                        </li>
                    ))}</ul>
                </div>
            </div>
        );
    };

    const ProjectBuilder = ({ initialProject, onSave, onCancel }) => {
        const [project, setProject] = useState(initialProject);
        const [editingBlock, setEditingBlock] = useState({ block: null, index: -1 });
        const [rawTags, setRawTags] = useState((initialProject.tags || []).join('\n'));

        useEffect(() => {
            const tagsArray = rawTags.split(/[\n,]+/).map(s => s.trim()).filter(Boolean);
            setProject(p => {
                if (JSON.stringify(p.tags || []) === JSON.stringify(tagsArray)) {
                    return p;
                }
                return { ...p, tags: tagsArray };
            });
        }, [rawTags]);

        const handleProjectChange = (e) => { const { name, value } = e.target; setProject(p => ({ ...p, [name]: value })); };
        
        const handlePreview = () => {
            localStorage.setItem('draft_project_preview', JSON.stringify(project));
            const previewUrl = `${window.location.origin}${window.location.pathname}#/project/${project.id}?preview=true`;
            window.open(previewUrl, '_blank');
        };
        
        const addBlock = (type) => {
            const newBlock = { type, data: {} };
            // Set default data structures for block types
            switch(type) {
                case 'hero': newBlock.data = { images: [], style: 'single' }; break;
                case 'text': newBlock.data = { heading: '', body: '' }; break;
                case 'textWithImages': newBlock.data = { heading: '', body: '', images: [], imagePosition: 'right', imageLayout: 'singleSquare' }; break;
                case 'image': newBlock.data = { image: { url: '', alt: '' }, size: 'full', caption: '' }; break;
                case 'imageGrid': case 'carousel': newBlock.data = { images: [] }; break;
                case 'imageRow': newBlock.data = { images: [], style: 'threeSquare' }; break;
                case 'quote': newBlock.data = { quotes: [{ text: '', author: '' }], style: 'single' }; break;
                case 'stats': newBlock.data = { stats: [{ value: '0%', label: ''}] }; break;
            }
            setProject(p => ({ ...p, contentBlocks: [...(p.contentBlocks || []), newBlock] }));
        };
        
        const updateBlock = (index, updatedBlock) => {
            const updatedBlocks = [...project.contentBlocks];
            updatedBlocks[index] = updatedBlock;
            setProject(p => ({ ...p, contentBlocks: updatedBlocks }));
            setEditingBlock({ block: null, index: -1 });
        };
        
        const removeBlock = (index) => {
            if (confirm('Delete this content block?')) {
                setProject(p => ({...p, contentBlocks: p.contentBlocks.filter((_, i) => i !== index)}));
            }
        };

        const moveBlock = (index, direction) => {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= project.contentBlocks.length) return;
            const updatedBlocks = [...project.contentBlocks];
            const item = updatedBlocks.splice(index, 1)[0];
            updatedBlocks.splice(newIndex, 0, item);
            setProject(p => ({ ...p, contentBlocks: updatedBlocks }));
        };
        
        const BlockTypeIcon = ({ type }) => {
            const icons = {
                hero: 'M4 16l-2-2 8-8 8 8-2 2H4z',
                title: 'M3 12h3v7h3v-7h3V9H3v3zm10-5h-1v6h1V7zm3-2h-1v8h1V5zm3 2h-1v6h1V7z',
                text: 'M4 6h16M4 12h16M4 18h16',
                textWithImages: 'M4 4h7v7H4V4zm10 0h7v7h-7V4zM4 15h7v7H4v-7zm10 0h7v7h-7v-7z',
                image: 'M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z',
                imageGrid: 'M4 4h7v7H4V4zm10 0h7v7h-7V4zM4 15h7v7H4v-7zm10 0h7v7h-7v-7z',
                carousel: 'M6 5h2v14H6V5zm10 0h2v14h-2V5z',
                imageRow: 'M2 13h4v4H2v-4zm6 0h4v4H8v-4zm6 0h4v4h-4v-4z',
                quote: 'M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z',
                stats: 'M7 17v-4h3v4H7zm4 0v-8h3v8h-3zm4 0v-6h3v6h-3z',
            };
            return <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-3 text-text-tertiary" viewBox="0 0 24 24" fill="currentColor"><path d={icons[type] || 'M0 0h24v24H0z'} /></svg>;
        };

        return (
            <div className="bg-base-dark p-6 rounded-lg shadow-lg">
                 <div className="flex justify-between items-center mb-6">
                    <h3 className="text-xl font-bold">{project.id.startsWith('new') ? 'Add New Project' : 'Edit Project'}</h3>
                    <div className="flex gap-4">
                        <button onClick={handlePreview} className="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded transition-colors">Preview Changes</button>
                        <button onClick={() => onSave(project)} className={buttonClasses}>Save Project</button>
                        <button onClick={onCancel} className="bg-base-light hover:bg-base-medium text-text-primary font-bold py-2 px-4 rounded">Cancel</button>
                    </div>
                </div>
                <div className="flex flex-col lg:flex-row gap-8">
                    {/* Left Column: Core Info & Content Blocks */}
                    <div className="flex-grow lg:w-2/3">
                        <AdminSection title="Core Info">
                            <AdminInput label="ID (slug, no spaces)" name="id" value={project.id} onChange={handleProjectChange} />
                            <AdminInput label="Title" name="title" value={project.title} onChange={handleProjectChange} />
                            <AdminInput label="Client" name="client" value={project.client} onChange={handleProjectChange} />
                            <div className="md:col-span-2">
                               <AdminTextarea label="Project Types / Tags (one per line or comma-separated)" name="tags" value={rawTags} onChange={(e) => setRawTags(e.target.value)} rows={2} recommendation="e.g., Packaging, Broadcast TV, Retail, Brand Identity"/>
                            </div>
                        </AdminSection>
                        <AdminSection title="Homepage Display (Optional)">
                            <AdminInput label="Homepage Title" name="homePageTitle" value={project.homePageTitle || ''} onChange={handleProjectChange} placeholder="Defaults to main project title" />
                            <AdminInput label="Homepage Subtitle" name="homePageSubtitle" value={project.homePageSubtitle || ''} onChange={handleProjectChange} placeholder="Defaults to main project subtitle" />
                            <div className="md:col-span-2"><AdminImageInput label="Homepage Image" name="homePageImage" value={project.homePageImage} onChange={v => setProject(p => ({...p, homePageImage: v}))} /></div>
                        </AdminSection>
                        <AdminSection title="Content Blocks" gridCols="md:grid-cols-1">
                            <div className="space-y-2">
                                {(project.contentBlocks || []).map((block, index) => (
                                    <div key={index} className="flex items-center justify-between bg-base-dark p-2 rounded-md border border-base-light">
                                        <div className="flex items-center">
                                            <BlockTypeIcon type={block.type} />
                                            <span className="font-medium text-text-secondary capitalize">{block.type.replace(/([A-Z])/g, ' $1')}</span>
                                            <span className="text-sm text-text-tertiary ml-4 truncate">{block.data.heading || block.data.caption || ''}</span>
                                        </div>
                                        <div className="flex items-center gap-1">
                                            <button onClick={() => moveBlock(index, -1)} disabled={index === 0} className="p-1 disabled:opacity-30"><svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clipRule="evenodd" /></svg></button>
                                            <button onClick={() => moveBlock(index, 1)} disabled={index === project.contentBlocks.length - 1} className="p-1 disabled:opacity-30"><svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" /></svg></button>
                                            <button onClick={() => setEditingBlock({ block, index })} className="text-sm bg-base-light hover:bg-brand-primary text-white font-bold py-1 px-3 rounded">Edit</button>
                                            <button onClick={() => removeBlock(index)} className="text-sm bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">Del</button>
                                        </div>
                                    </div>
                                ))}
                                {(!project.contentBlocks || project.contentBlocks.length === 0) && <p className="text-center text-text-tertiary p-4">No content blocks yet. Add one from the right panel.</p>}
                            </div>
                        </AdminSection>
                    </div>
                     {/* Right Column: Add Block */}
                    <div className="lg:w-1/3">
                        <div className="sticky top-24 bg-base-medium p-4 rounded-lg shadow-lg">
                            <h3 className="font-bold mb-4">Add Content Block</h3>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => addBlock('hero')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Hero</button>
                                <button onClick={() => addBlock('title')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Title</button>
                                <button onClick={() => addBlock('text')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Text</button>
                                <button onClick={() => addBlock('textWithImages')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Text + Images</button>
                                <button onClick={() => addBlock('image')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Single Image</button>
                                <button onClick={() => addBlock('imageRow')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Image Row</button>
                                <button onClick={() => addBlock('imageGrid')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Image Grid</button>
                                <button onClick={() => addBlock('carousel')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Carousel</button>
                                <button onClick={() => addBlock('quote')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Quote</button>
                                <button onClick={() => addBlock('stats')} className="bg-base-light hover:bg-brand-primary p-2 rounded text-sm">Key Stats</button>
                            </div>
                        </div>
                    </div>
                </div>

                {editingBlock.block && (
                    <BlockEditorModal 
                        block={editingBlock.block} 
                        onSave={(updatedBlock) => updateBlock(editingBlock.index, updatedBlock)}
                        onClose={() => setEditingBlock({ block: null, index: -1 })}
                    />
                )}
            </div>
        );
    };

    const BlockEditorModal = ({ block, onSave, onClose }) => {
        const [editedBlock, setEditedBlock] = useState(JSON.parse(JSON.stringify(block)));

        const handleChange = (e) => {
            const { name, value } = e.target;
            setEditedBlock(b => ({ ...b, data: { ...b.data, [name]: value } }));
        };
        const handleImageChange = (value) => {
            setEditedBlock(b => ({ ...b, data: { ...b.data, image: value } }));
        };
        const handleImageArrayChange = (value) => {
            setEditedBlock(b => ({ ...b, data: { ...b.data, images: value } }));
        };
        const handleSave = () => onSave(editedBlock);

        const renderForm = () => {
            switch (block.type) {
                case 'hero': return (
                    <div className="space-y-4">
                        <AdminSelect label="Style" name="style" value={editedBlock.data.style} onChange={handleChange}>
                            <option value="single">Single Full Image</option><option value="duo">Two-Column</option><option value="trio">Three-Column</option>
                        </AdminSelect>
                        <AdminImageArrayInput label="Images" value={editedBlock.data.images} onChange={handleImageArrayChange} recommendation="1 image for Single, 2 for Duo, 3 for Trio."/>
                    </div>
                );
                case 'title': return <p className="text-text-tertiary">This block has no editable content. It automatically displays the project's title, client, and tags.</p>;
                case 'text': return (
                    <div className="space-y-4">
                        <AdminInput label="Heading (Optional)" name="heading" value={editedBlock.data.heading} onChange={handleChange} />
                        <AdminTextarea label="Body Text" name="body" value={editedBlock.data.body} onChange={handleChange} rows={8} recommendation="Use HTML for styling (e.g., &lt;b&gt; for bold)." />
                    </div>
                );
                case 'textWithImages': {
                    const recommendationTexts = {
                        singleSquare: "Upload 1 image.",
                        singleTall: "Upload 1 image.",
                        singleExtraTall: "Upload 1 image.",
                        stackTwoSquare: "Upload 2 images.",
                        stackThreeSquare: "Upload 3 images.",
                    };
                    const currentLayout = editedBlock.data.imageLayout || 'singleSquare';

                    return (
                        <div className="space-y-4">
                            <AdminInput label="Heading (Optional)" name="heading" value={editedBlock.data.heading} onChange={handleChange} />
                            <AdminTextarea label="Body Text" name="body" value={editedBlock.data.body} onChange={handleChange} rows={6} recommendation="Use HTML for styling." />
                            <AdminSelect label="Image Position" name="imagePosition" value={editedBlock.data.imagePosition} onChange={handleChange}>
                                <option value="right">Right</option><option value="left">Left</option>
                            </AdminSelect>
                             <AdminSelect label="Image Layout" name="imageLayout" value={currentLayout} onChange={handleChange}>
                                <option value="singleSquare">Single Square Image</option>
                                <option value="singleTall">Single Tall Image (1.5x height)</option>
                                <option value="singleExtraTall">Single Extra Tall Image (2x height)</option>
                                <option value="stackTwoSquare">Two Stacked Square Images</option>
                                <option value="stackThreeSquare">Three Stacked Square Images</option>
                            </AdminSelect>
                            <AdminImageArrayInput label="Images" value={editedBlock.data.images} onChange={handleImageArrayChange} recommendation={recommendationTexts[currentLayout] || "Recommended width: 600px."}/>
                        </div>
                    );
                }
                case 'image': return (
                     <div className="space-y-4">
                        <AdminImageInput label="Image" value={editedBlock.data.image} onChange={handleImageChange} />
                        <AdminSelect label="Size" name="size" value={editedBlock.data.size} onChange={handleChange}>
                            <option value="full">Full Width</option><option value="medium">Medium</option><option value="small">Small</option>
                        </AdminSelect>
                        <AdminInput label="Caption (Optional)" name="caption" value={editedBlock.data.caption} onChange={handleChange} />
                        <div className="text-xs text-text-tertiary p-3 bg-base-dark rounded-md"><b>Size Guide:</b><br/>Full: ~1920px wide, Medium: ~1200px wide, Small: ~800px wide. Use 16:9 aspect ratio.</div>
                    </div>
                );
                 case 'imageGrid': case 'carousel': return (
                    <div className="space-y-4">
                        <AdminImageArrayInput label="Images" value={editedBlock.data.images} onChange={handleImageArrayChange} recommendation="Grid: Use square images (e.g. 800x800). Carousel: use 16:9 images (e.g. 1200x675)." />
                    </div>
                );
                case 'imageRow': {
                    const guides = {
                        singleWide: "<b>1 image.</b> Recommended size: 1920x1080px (16:9).",
                        twoNarrow: "<b>2 images.</b> Recommended size: 800x1067px (3:4).",
                        threeSquare: "<b>3 images.</b> Recommended size: 800x800px (1:1)."
                    };
                    return (
                        <div className="space-y-4">
                            <AdminSelect label="Style" name="style" value={editedBlock.data.style} onChange={handleChange}>
                                <option value="singleWide">Single Wide Image</option>
                                <option value="twoNarrow">Two Narrow Images</option>
                                <option value="threeSquare">Three Square Images</option>
                            </AdminSelect>
                            <AdminImageArrayInput label="Images" value={editedBlock.data.images} onChange={handleImageArrayChange} recommendation={guides[editedBlock.data.style]} />
                        </div>
                    );
                }
                case 'quote': {
                    const handleQuoteChange = (index, field, value) => { const updated = [...editedBlock.data.quotes]; updated[index][field] = value; setEditedBlock(b => ({ ...b, data: { ...b.data, quotes: updated } })); };
                    const addQuote = () => setEditedBlock(b => ({ ...b, data: { ...b.data, quotes: [...b.data.quotes, {text: '', author: ''}] } }));
                    const removeQuote = (index) => setEditedBlock(b => ({ ...b, data: { ...b.data, quotes: b.data.quotes.filter((_, i) => i !== index) } }));
                    const maxQuotes = editedBlock.data.style === 'duo' ? 2 : 1;
                    return (
                        <div className="space-y-4">
                            <AdminSelect label="Layout" name="style" value={editedBlock.data.style} onChange={handleChange}>
                                <option value="single">Single Centered Quote</option><option value="duo">Two Quotes Side-by-Side</option>
                            </AdminSelect>
                            {(editedBlock.data.quotes || []).slice(0, maxQuotes).map((q, i) => (
                                <div key={i} className="bg-base-dark p-4 rounded-md space-y-3 relative">
                                    <AdminTextarea label={`Quote Text ${i+1}`} value={q.text} onChange={e => handleQuoteChange(i, 'text', e.target.value)} rows={3} />
                                    <AdminInput label={`Author ${i+1}`} value={q.author} onChange={e => handleQuoteChange(i, 'author', e.target.value)} />
                                    {editedBlock.data.quotes.length > 1 && <button onClick={() => removeQuote(i)} className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 text-sm">X</button>}
                                </div>
                            ))}
                            {editedBlock.data.style === 'duo' && editedBlock.data.quotes.length < 2 && <button onClick={addQuote} className={buttonClasses}>Add Second Quote</button>}
                        </div>
                    );
                }
                case 'stats': {
                    const handleStatChange = (index, field, value) => { const updated = [...editedBlock.data.stats]; updated[index][field] = value; setEditedBlock(b => ({ ...b, data: { ...b.data, stats: updated } })); };
                    const addStat = () => setEditedBlock(b => ({ ...b, data: { ...b.data, stats: [...b.data.stats, {value: '', label: ''}] } }));
                    const removeStat = (index) => setEditedBlock(b => ({ ...b, data: { ...b.data, stats: b.data.stats.filter((_, i) => i !== index) } }));
                    return (
                        <div className="space-y-4">
                             <p className="text-xs text-text-tertiary">Showcase up to 3 key metrics or achievements.</p>
                            {(editedBlock.data.stats || []).slice(0, 3).map((s, i) => (
                                <div key={i} className="bg-base-dark p-4 rounded-md grid grid-cols-1 md:grid-cols-[1fr_2fr_auto] gap-4 items-end">
                                    <AdminInput label={`Value ${i+1}`} value={s.value} onChange={e => handleStatChange(i, 'value', e.target.value)} placeholder="e.g., 40%" />
                                    <AdminInput label={`Label ${i+1}`} value={s.label} onChange={e => handleStatChange(i, 'label', e.target.value)} placeholder="e.g., Increase in Sales" />
                                    <button onClick={() => removeStat(i)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded h-10 mb-1">X</button>
                                </div>
                            ))}
                            {editedBlock.data.stats.length < 3 && <button onClick={addStat} className={buttonClasses}>Add Stat</button>}
                        </div>
                    )
                }
                default: return <p>Unknown block type.</p>
            }
        };

        return (
            <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in-up" style={{animationDuration: '300ms'}}>
                <div className="bg-base-medium rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
                    <header className="p-4 border-b border-base-light flex justify-between items-center">
                        <h3 className="text-xl font-bold">Edit: <span className="capitalize">{block.type.replace(/([A-Z])/g, ' $1')}</span></h3>
                        <button onClick={onClose} className="text-2xl">&times;</button>
                    </header>
                    <main className="p-6 overflow-y-auto">{renderForm()}</main>
                    <footer className="p-4 border-t border-base-light flex justify-end gap-4">
                        <button onClick={onClose} className="bg-base-light hover:bg-base-medium text-text-primary font-bold py-2 px-4 rounded">Cancel</button>
                        <button onClick={handleSave} className={buttonClasses}>Save Block</button>
                    </footer>
                </div>
            </div>
        );
    };

    const DraggableLogoGrid = ({ logos, onUpdate, onRemove }) => {
        const [dragging, setDragging] = useState(false);
        const dragItem = useRef();
        const dragOverItem = useRef();

        const handleDragStart = (e, index) => { dragItem.current = index; setDragging(true); e.dataTransfer.effectAllowed = 'move'; e.currentTarget.classList.add('logo-dragging'); };
        const handleDragEnter = (e, index) => { dragOverItem.current = index; };
        const handleDragEnd = (e) => {
            const newList = [...logos];
            const draggedItemContent = newList[dragItem.current];
            newList.splice(dragItem.current, 1);
            newList.splice(dragOverItem.current, 0, draggedItemContent);
            dragItem.current = null;
            dragOverItem.current = null;
            onUpdate(newList);
            setDragging(false);
            e.currentTarget.classList.remove('logo-dragging');
        };

        return (
            <div className="flex flex-wrap gap-4">
                {logos.map((logo, index) => (
                    <div key={index} draggable onDragStart={(e) => handleDragStart(e, index)} onDragEnter={(e) => handleDragEnter(e, index)} onDragEnd={handleDragEnd} onDragOver={e => e.preventDefault()} className="group relative w-48 h-16 bg-white p-2 rounded-md flex items-center justify-center cursor-move transition-all duration-300 border border-base-light">
                        <img src={logo} alt={`logo ${index}`} className="max-w-full max-h-full object-contain" />
                        <button onClick={() => onRemove(index)} className="absolute -top-2 -right-2 w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-sm font-bold">X</button>
                    </div>
                ))}
            </div>
        );
    };

    const LogoEditor = () => {
        const [localClientLogos, setLocalClientLogos] = useState(clientLogos);
        const [localBrandLogos, setLocalBrandLogos] = useState(brandLogos);
        const [newClientLogo, setNewClientLogo] = useState('');
        const [newBrandLogo, setNewNewBrandLogo] = useState('');

        useEffect(() => { setLocalClientLogos(clientLogos); setLocalBrandLogos(brandLogos); }, [clientLogos, brandLogos]);

        const handleSave = () => { 
            updateLogos(localClientLogos, localBrandLogos); 
            alert('Logos saved!'); 
        };
        const addLogo = (type) => {
            if (type === 'client' && newClientLogo) { setLocalClientLogos([...localClientLogos, newClientLogo]); setNewClientLogo(''); }
            if (type === 'brand' && newBrandLogo) { setLocalBrandLogos([...localBrandLogos, newBrandLogo]); setNewNewBrandLogo(''); }
        };
        const removeLogo = (type, index) => {
            if (type === 'client') { setLocalClientLogos(localClientLogos.filter((_, i) => i !== index)); }
            if (type === 'brand') { setLocalBrandLogos(localBrandLogos.filter((_, i) => i !== index)); }
        };

        return (
            <div>
                 <div className="sticky top-0 bg-base-dark/80 backdrop-blur-sm z-10 py-4 mb-4 flex justify-end"><button onClick={handleSave} className={buttonClasses}>Save Logos</button></div>
                 <AdminSection title="Client Logos" gridCols="md:grid-cols-1">
                    <DraggableLogoGrid logos={localClientLogos} onUpdate={setLocalClientLogos} onRemove={(index) => removeLogo('client', index)} />
                    <div className="flex gap-2 mt-4"><AdminInput label="Add New Client Logo URL" value={newClientLogo} onChange={(e) => setNewClientLogo(e.target.value)} placeholder="https://firebasestorage.googleapis.com/v0/b/your-project.appspot.com/o/file.jpg?alt=media&token=..." recommendation="In Firebase Storage, click the file, then copy the full 'Download URL' from the 'File location' panel. It must start with `https://firebasestorage.googleapis.com/...` and include an access token. A `gs://` link will not work." /><button onClick={() => addLogo('client')} className={buttonClasses + " self-end"}>Add</button></div>
                 </AdminSection>
                 <AdminSection title="Brand Logos" gridCols="md:grid-cols-1">
                    <DraggableLogoGrid logos={localBrandLogos} onUpdate={setLocalBrandLogos} onRemove={(index) => removeLogo('brand', index)} />
                    <div className="flex gap-2 mt-4"><AdminInput label="Add New Brand Logo URL" value={newBrandLogo} onChange={(e) => setNewNewBrandLogo(e.target.value)} placeholder="https://firebasestorage.googleapis.com/v0/b/your-project.appspot.com/o/file.jpg?alt=media&token=..." recommendation="In Firebase Storage, click the file, then copy the full 'Download URL' from the 'File location' panel. It must start with `https://firebasestorage.googleapis.com/...` and include an access token. A `gs://` link will not work." /><button onClick={() => addLogo('brand')} className={buttonClasses + " self-end"}>Add</button></div>
                 </AdminSection>
            </div>
        );
    };

    const EditingGuide = () => {
        const [playgroundText, setPlaygroundText] = useState('<b>Hello world!</b>\n\nTry editing me.\n<span class="text-brand-primary">I am using the brand primary color.</span>\n\nUse <br/> for line breaks.');
        return (
            <div className="space-y-8">
                <AdminSection title="Text Formatting Guide" gridCols="md:grid-cols-1">
                    <div className="prose prose-invert max-w-none text-text-secondary leading-relaxed">
                        <p>You can use basic HTML tags to format text in most multi-line text areas (like project descriptions or the 'About Me' intro). This allows for more dynamic content styling.</p>
                        <h4 className="text-lg font-bold text-text-primary">Commonly Used Tags:</h4>
                        <ul>
                            <li>For <strong>bold text</strong>, wrap your text in <code>&lt;b&gt;</code> tags. Example: <code>&lt;b&gt;Important&lt;/b&gt;</code></li>
                            <li>For <span className="text-brand-primary">brand-colored text</span>, use a span with a special class. Example: <code>&lt;span class="text-brand-primary"&gt;Highlight&lt;/span&gt;</code></li>
                            <li>For a line break,<br/>use the self-closing <code>&lt;br/&gt;</code> tag where you want the line to end.</li>
                        </ul>
                        <p>Feel free to experiment in the playground below to see how your text will look before saving it.</p>
                    </div>
                </AdminSection>
                <AdminSection title="Live Preview Playground" gridCols="md:grid-cols-1">
                    <AdminTextarea label="Enter your text with HTML here:" value={playgroundText} onChange={(e) => setPlaygroundText(e.target.value)} rows={8} />
                    <div>
                        <label className={labelClasses}>Live Preview:</label>
                        <div className="border border-base-light rounded p-4 bg-base-dark min-h-[100px] text-text-secondary">
                            <p className="leading-relaxed" dangerouslySetInnerHTML={{ __html: playgroundText.replace(/\n/g, '<br/>') }} />
                        </div>
                    </div>
                </AdminSection>
            </div>
        );
    };
    
    const SEOOptimizer = () => {
        const { aboutMe, heroProjects, updateAboutMe } = useContent();
        const [isLoading, setIsLoading] = useState(false);
        const [result, setResult] = useState(null);
        const [seoTitle, setSeoTitle] = useState(aboutMe.seoTitle || '');
        const [seoDescription, setSeoDescription] = useState(aboutMe.seoDescription || '');

        const cleanHtml = (html) => {
            if (!html) return '';
            const doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || "";
        };

        const analyzeContent = () => {
            setIsLoading(true);
            setResult(null);

            setTimeout(() => {
                let allText = [
                    aboutMe.name, aboutMe.title, cleanHtml(aboutMe.heroIntro), cleanHtml(aboutMe.introStatement),
                    ...aboutMe.philosophy.flatMap(p => [p.title, cleanHtml(p.text)])
                ].join(' ');

                heroProjects.forEach(p => {
                    allText += ` ${p.title} ${p.subtitle} ${(p.tags || []).join(' ')}`;
                    (p.contentBlocks || []).forEach(block => {
                        if (block.type === 'text' || block.type === 'textWithImages') {
                            allText += ` ${cleanHtml(block.data.heading)} ${cleanHtml(block.data.body)}`;
                        }
                    });
                });

                const words = allText.toLowerCase().replace(/[^a-z\s-]/g, '').split(/\s+/).filter(Boolean);
                const stopWords = new Set(['a', 'an', 'and', 'the', 'is', 'in', 'it', 'of', 'for', 'on', 'with', 'as', 'by', 'to', 'i', 'my', 'me', 'we', 'our', 'you', 'your']);
                const wordFreq = words.reduce((acc, word) => {
                    if (!stopWords.has(word) && word.length > 2) {
                        acc[word] = (acc[word] || 0) + 1;
                    }
                    return acc;
                }, {});

                const sortedKeywords = Object.entries(wordFreq).sort((a, b) => b[1] - a[1]).map(e => e[0]);
                const topKeywords = sortedKeywords.slice(0, 5);
                
                const generatedTitle = `${aboutMe.name} | ${aboutMe.title} | ${topKeywords.slice(0, 2).map(k => k.charAt(0).toUpperCase() + k.slice(1)).join(' & ')} Portfolio`;

                let generatedDescription = cleanHtml(aboutMe.introStatement);
                if (generatedDescription.length > 160) {
                    generatedDescription = generatedDescription.substring(0, 157) + '...';
                }

                setSeoTitle(generatedTitle);
                setSeoDescription(generatedDescription);

                const recommendations = [
                    "Review the generated Title and Meta Description, edit if necessary, then click 'Save SEO Settings'.",
                    "Review your project tags. They are important for defining the skills you want to be known for.",
                    "Ensure all images have descriptive SEO text via the other admin tabs. This is crucial for accessibility and image search.",
                    "The tool will now automatically add Open Graph (OG) and Twitter tags to your site's header when you save.",
                    "Periodically re-run this analysis after updating your content to keep your SEO strategy fresh."
                ];

                setResult({
                    keywords: sortedKeywords.slice(0, 15),
                    recommendations: recommendations,
                });
                setIsLoading(false);
            }, 1500);
        };
        
        const handleSave = () => {
          updateAboutMe({ ...aboutMe, seoTitle, seoDescription });
          alert('SEO Settings have been saved and applied!');
        };

        return (
            <div className="space-y-8">
                <AdminSection title="SEO & Metadata Optimizer" gridCols="md:grid-cols-1">
                    <p className="text-text-secondary leading-relaxed">
                        This tool analyzes all the text content from your 'About Me' and 'Projects' pages to generate SEO-friendly recommendations. Click the button below to start the analysis. The results will help you improve your site's visibility on search engines.
                    </p>
                    <div className="pt-2">
                        <button onClick={analyzeContent} className={buttonClasses} disabled={isLoading}>
                            {isLoading ? 'Analyzing...' : 'Analyze Site Content'}
                        </button>
                    </div>
                </AdminSection>

                {isLoading && (
                    <div className="flex items-center justify-center p-8 bg-base-medium rounded-lg">
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span className="text-text-secondary">Performing analysis, please wait...</span>
                    </div>
                )}
                
                {result && (
                  <div className="animate-fade-in-up" style={{animationDuration: '500ms'}}>
                    <AdminSection title="Analysis Results" gridCols="md:grid-cols-1">
                        <AdminInput label="Generated Page Title" value={seoTitle} onChange={e => setSeoTitle(e.target.value)} />
                        <p className="text-xs text-text-tertiary -mt-4">Recommended length: 50-60 characters. Current: {seoTitle.length}</p>
                        
                        <AdminTextarea label="Generated Meta Description" value={seoDescription} onChange={e => setSeoDescription(e.target.value)} rows={4} />
                        <p className="text-xs text-text-tertiary -mt-4">Recommended length: 150-160 characters. Current: {seoDescription.length}</p>

                        <div>
                            <label className={labelClasses}>Top Keywords</label>
                            <div className="flex flex-wrap gap-2 p-3 bg-base-dark border border-base-light rounded">
                                {result.keywords.map(kw => <span key={kw} className="bg-base-light text-text-secondary text-xs font-medium px-2.5 py-1 rounded-full">{kw}</span>)}
                            </div>
                        </div>
                        <div className="pt-2">
                           <button onClick={handleSave} className={buttonClasses}>Save SEO Settings</button>
                        </div>
                    </AdminSection>
                    <AdminSection title="Actionable Recommendations" gridCols="md:grid-cols-1">
                        <ul className="list-disc list-inside space-y-2 text-text-secondary">
                          {result.recommendations.map((rec, i) => <li key={i}>{rec}</li>)}
                        </ul>
                    </AdminSection>
                  </div>
                )}
            </div>
        );
    };

    const DangerZone = () => (
      <div className="bg-red-900/20 border border-red-700 p-6 rounded-lg">
        <h2 className="text-2xl font-bold text-red-400 mb-4">Danger Zone</h2>
        <h3 className="text-lg font-bold text-red-300">Reset All Content</h3>
        <p className="text-red-300 my-4">This is a powerful action that will completely overwrite all your current content (projects, about page, logos, etc.) with the latest default template from the codebase. This is useful for starting over or fixing data sync issues, like the one you're seeing now.</p>
        <p className="text-red-200 font-bold mb-4">Warning: If you are logged in, this will permanently overwrite the data on your Firebase server. This action cannot be undone.</p>
        <button onClick={resetToDefaults} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Reset Content to Template Defaults</button>
      </div>
    );


    if (loading) return <div className="bg-base-dark text-text-primary min-h-screen flex items-center justify-center">Loading...</div>;
    if (!isFirebaseActive) return (<div className="bg-base-dark text-text-primary min-h-screen p-8"><div className="max-w-4xl mx-auto"><h1 className="text-3xl font-bold mb-4">Admin Panel</h1><div className="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded relative" role="alert"><strong className="font-bold">Firebase Not Configured!</strong><span className="block sm:inline"> The admin panel is disabled because Firebase credentials are not set up.</span></div></div></div>);

    if (!isAuthenticated) return (
      <div className="bg-base-dark text-text-primary min-h-screen flex items-center justify-center"><div className="max-w-md w-full p-8 bg-base-medium rounded-lg shadow-2xl border border-base-light">
          <h2 className="text-2xl font-bold text-center mb-6 text-text-primary">Admin Login</h2>
          <form onSubmit={handleLogin}>
            <div className="mb-4"><label className={labelClasses} htmlFor="email">Email</label><input type="email" id="email" value={email} onChange={(e) => setEmail(e.target.value)} className={inputClasses} required /></div>
            <div className="mb-6"><label className={labelClasses} htmlFor="password">Password</label><input type="password" id="password" value={password} onChange={(e) => setPassword(e.target.value)} className={inputClasses} required /></div>
            {error && <p className="text-red-500 text-xs italic mb-4">{error}</p>}
            <div className="flex flex-col items-center justify-center">
              <button type="submit" className="w-full bg-brand-primary hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">Sign In</button>
              <a href="#/" onClick={(e) => { e.preventDefault(); window.location.hash = '#/'; }} className="mt-4 text-sm text-text-tertiary hover:text-text-primary transition-colors">Cancel</a>
            </div>
          </form>
      </div></div>
    );

    return (
        <div className="bg-base-dark text-text-primary min-h-screen p-4 md:p-8">
            <div className="max-w-7xl mx-auto">
                <header className="flex justify-between items-center mb-8 pb-4 border-b border-base-light">
                    <h1 className="text-3xl font-bold">Content Management</h1>
                    <div className="flex items-center gap-4">
                        <a href="#/" onClick={(e) => { e.preventDefault(); window.location.hash = '#/'; }} className="bg-base-light hover:bg-base-medium text-text-primary font-bold py-2 px-4 rounded transition-colors">View Site</a>
                        <button onClick={handleLogout} className="bg-base-light hover:bg-base-medium text-text-primary font-bold py-2 px-4 rounded">Logout</button>
                    </div>
                </header>
                <nav className="flex justify-between items-end border-b border-base-light mb-8">
                    <div className="flex space-x-1 sm:space-x-2 overflow-x-auto">
                        <TabButton label="Projects" tabName="projects" />
                        <TabButton label="Theme & General" tabName="theme" />
                        <TabButton label="Home Page" tabName="home" />
                        <TabButton label="About Page" tabName="about" />
                        <TabButton label="Logos" tabName="logos" />
                        <TabButton label="SEO & Metadata" tabName="seo" />
                        <TabButton label="Editing Guide" tabName="editing" />
                    </div>
                    <div>
                        <TabButton label="Danger Zone" tabName="danger" danger={true} />
                    </div>
                </nav>
                <main>
                    {activeTab === 'theme' && <ThemeGeneralSettings />}
                    {activeTab === 'home' && <HomePageSettings />}
                    {activeTab === 'about' && <AboutPageSettings />}
                    {activeTab === 'projects' && <ProjectEditor />}
                    {activeTab === 'logos' && <LogoEditor />}
                    {activeTab === 'seo' && <SEOOptimizer />}
                    {activeTab === 'editing' && <EditingGuide />}
                    {activeTab === 'danger' && <DangerZone />}
                </main>
            </div>
        </div>
    );
};

const Footer = () => {
  const { aboutMe } = useContent();
  const setHoverState = useContext(CursorHoverDispatchContext);
  const handleAdminClick = (e) => { e.preventDefault(); window.location.hash = '#/admin'; };
  return (
    <footer className="bg-base-medium border-t border-base-light">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="flex flex-row justify-between items-start gap-4">
          <div className="text-text-tertiary text-xs">
            <p>&copy; {new Date().getFullYear()} David Gaines. All rights reserved.</p>
            <div className="mt-1">
              <a href="#/admin" onClick={handleAdminClick} className="text-base-medium hover:text-text-tertiary transition-colors">Admin</a>
            </div>
          </div>
          <div className="flex items-start gap-4">
             {(aboutMe.socialLinks || []).map((social, index) => (
                <a 
                  key={index} 
                  href={social.linkUrl} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  className="text-text-secondary hover:text-brand-primary transition-colors duration-300" 
                  onMouseEnter={() => setHoverState({ isHovering: true })} 
                  onMouseLeave={() => setHoverState({ isHovering: false })} 
                  aria-label={`Social media link ${index + 1}`}
                >
                  {social.iconUrl === 'linkedin' ? (
                    <LinkedInIcon className="w-6 h-6"/>
                  ) : (
                    <img src={social.iconUrl} alt="" className="w-6 h-6 object-contain" />
                  )}
                </a>
             ))}
          </div>
        </div>
      </div>
    </footer>
  );
};

// --- Inlined from App.tsx ---
const MainApp = () => {
  const { path } = useRouter();
  
  const renderPage = () => {
    if (path === '#/about') return <AboutPage />;
    if (path.startsWith('#/project/')) {
      const projectId = path.split('/')[2]?.split('?')[0] || '';
      return <CaseStudyDetailPage key={projectId} projectId={projectId} />;
    }
    return <HomePage />;
  };

  return (
    <div className="min-h-screen flex flex-col bg-base-dark">
      <CustomCursor />
      <Header />
      <main className="flex-grow">{renderPage()}</main>
      <Footer />
    </div>
  );
};

const AppContent = () => {
  const { path } = useRouter();
  const isAdminPage = path === '#/admin';

  useEffect(() => {
    if (isAdminPage) {
      document.body.classList.remove('hide-cursor');
    } else {
      document.body.classList.add('hide-cursor');
    }
  }, [isAdminPage]);

  // Render both components but hide the inactive one. This ensures Tailwind's JIT compiler
  // sees all classes on initial page load, fixing styling issues with client-side routing.
  return (
    <>
      <div className={isAdminPage ? 'hidden' : ''}>
        <MainApp />
      </div>
      <div className={isAdminPage ? '' : 'hidden'}>
        <AdminPage />
      </div>
    </>
  );
};

const App = () => (
  <ContentProvider><AppContent /></ContentProvider>
);

// --- Inlined from components/ErrorBoundary.tsx ---
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null, errorInfo: null };
  static getDerivedStateFromError(error) { return { hasError: true, error, errorInfo: null }; }
  componentDidCatch(error, errorInfo) {
    this.setState({ error, errorInfo });
    console.error("Uncaught error:", error, errorInfo);
  }
  render() {
    if (this.state.hasError) {
      return (
        <div style={{ position: 'fixed', inset: '0', backgroundColor: '#0f172a', color: '#f8fafc', padding: '2rem', fontFamily: 'monospace', zIndex: 99999, overflow: 'auto', cursor: 'auto' }}>
          <h1 style={{ color: '#ef4444', fontSize: '1.5rem', marginBottom: '1rem' }}>Application Error</h1>
          <p style={{ color: '#fca5a5', marginBottom: '1rem' }}>Something went wrong.</p>
          <pre style={{ backgroundColor: '#1e293b', padding: '1rem', borderRadius: '0.5rem', whiteSpace: 'pre-wrap', wordBreak: 'break-all', color: '#cbd5e1' }}>
            <strong>Error:</strong> {this.state.error?.toString()}<br /><br />
            <strong>Stack Trace:</strong><br />
            {this.state.errorInfo?.componentStack || this.state.error?.stack}
          </pre>
        </div>
      );
    }
    return this.props.children;
  }
}

// --- Inlined from index.tsx ---
const showErrorOverlay = (message) => {
  const appRoot = document.getElementById('root');
  if (appRoot) appRoot.style.display = 'none';
  let overlay = document.getElementById('error-overlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'error-overlay';
    Object.assign(overlay.style, { position: 'fixed', inset: '0', backgroundColor: '#0f172a', color: '#f8fafc', padding: '2rem', fontFamily: 'monospace', zIndex: '99999', overflow: 'auto', cursor: 'auto' });
    document.body.appendChild(overlay);
  }
  overlay.innerHTML = `<h1 style="color: #ef4444; font-size: 1.5rem; margin-bottom: 1rem;">A critical error occurred</h1><p style="color: #fca5a5; margin-bottom: 1rem;">The application could not start.</p><pre style="background-color: #1e293b; padding: 1rem; border-radius: 0.5rem; white-space: pre-wrap; word-break: 'break-all'; color: '#cbd5e1';">${message}</pre>`;
};
window.addEventListener('error', (event) => { showErrorOverlay(`Error: ${event.message}\nSource: ${event.filename}\nLine: ${event.lineno}, Col: ${event.colno}`); });
window.addEventListener('unhandledrejection', (event) => { let reason = event.reason; if (reason instanceof Error) { reason = `${reason.message}\n${reason.stack}`; } showErrorOverlay(`Unhandled Promise Rejection:\nReason: ${reason}`); });

const rootElement = document.getElementById('root');
if (!rootElement) {
  showErrorOverlay('Fatal Error: The root HTML element with ID "root" was not found.');
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <ErrorBoundary>
      <CursorHoverProvider><App /></CursorHoverProvider>
    </ErrorBoundary>
  </React.StrictMode>
);
    </script>
  </body>
</html>